"use strict";var G=Object.defineProperty,B=Object.getOwnPropertySymbols,K=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable,L=(U,O,y)=>O in U?G(U,O,{enumerable:!0,configurable:!0,writable:!0,value:y}):U[O]=y,W=(U,O)=>{for(var y in O||(O={}))K.call(O,y)&&L(U,y,O[y]);if(B)for(var y of B(O))Y.call(O,y)&&L(U,y,O[y]);return U};(self.webpackChunkchasse_pwa_front=self.webpackChunkchasse_pwa_front||[]).push([[9091,5994],{15994:(U,O,y)=>{y.d(O,{N:()=>A});const A={convertToGEGeometry:function P(p,x){return null==x?null:p.convertJSONToGeometry(x)},exportPoint:function c(p,x,S){const M=new d(p.getPointX(x),p.getPointY(x),S),a=p.hasZ(x),f=p.hasM(x);return a&&(M.z=p.getPointZ(x)),f&&(M.m=p.getPointM(x)),M},exportPolygon:function I(p,x,S){return new T(p.exportPaths(x),S,p.hasZ(x),p.hasM(x))},exportPolyline:function s(p,x,S){return new _(p.exportPaths(x),S,p.hasZ(x),p.hasM(x))},exportMultipoint:function n(p,x,S){return new h(p.exportPoints(x),S,p.hasZ(x),p.hasM(x))},exportExtent:function b(p,x,S){const M=p.hasZ(x),a=p.hasM(x),f=new E(p.getXMin(x),p.getYMin(x),p.getXMax(x),p.getYMax(x),S);if(M){const l=p.getZExtent(x);f.zmin=l.vmin,f.zmax=l.vmax}if(a){const l=p.getMExtent(x);f.mmin=l.vmin,f.mmax=l.vmax}return f}};class d{constructor(x,S,M){this.x=x,this.y=S,this.spatialReference=M,this.z=void 0,this.m=void 0}}class T{constructor(x,S,M,a){this.rings=x,this.spatialReference=S,this.hasZ=void 0,this.hasM=void 0,M&&(this.hasZ=M),a&&(this.hasM=a)}}class _{constructor(x,S,M,a){this.paths=x,this.spatialReference=S,this.hasZ=void 0,this.hasM=void 0,M&&(this.hasZ=M),a&&(this.hasM=a)}}class h{constructor(x,S,M,a){this.points=x,this.spatialReference=S,this.hasZ=void 0,this.hasM=void 0,M&&(this.hasZ=M),a&&(this.hasM=a)}}class E{constructor(x,S,M,a,f){this.xmin=x,this.ymin=S,this.xmax=M,this.ymax=a,this.spatialReference=f,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},77044:(U,O,y)=>{y.d(O,{Y:()=>d});var A=y(62208);function P(n,E){return n?E?4:3:E?3:2}function d(n,E,b,p,x){if((0,A.Wi)(E)||!E.lengths.length)return null;const S="upperLeft"===(null==x?void 0:x.originPosition)?-1:1;n.lengths.length&&(n.lengths.length=0),n.coords.length&&(n.coords.length=0);const M=n.coords,a=[],f=b?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:l,coords:r}=E,g=P(b,p);let D=0;for(const t of l){const i=c(f,r,D,t,b,p,S);i&&a.push(i),D+=t*g}if(a.sort((t,i)=>{let o=S*t[2]-S*i[2];return 0===o&&b&&(o=t[4]-i[4]),o}),a.length){let t=6*a[0][2];M[0]=a[0][0]/t,M[1]=a[0][1]/t,b&&(t=6*a[0][4],M[2]=0!==t?a[0][3]/t:0),(M[0]<f[0]||M[0]>f[1]||M[1]<f[2]||M[1]>f[3]||b&&(M[2]<f[4]||M[2]>f[5]))&&(M.length=0)}if(!M.length){const t=E.lengths[0]?function T(n,E,b,p,x){const S=P(p,x);let M=E,a=E+S,f=0,l=0,r=0,g=0;for(let D=0,t=b-1;D<t;D++,M+=S,a+=S){const i=n[M],o=n[M+1],e=n[M+2],u=n[a],m=n[a+1],v=n[a+2],C=p?_(i,o,e,u,m,v):I(i,o,u,m);if(C)if(f+=C,p){const z=h(i,o,e,u,m,v);l+=C*z[0],r+=C*z[1],g+=C*z[2]}else{const z=s(i,o,u,m);l+=C*z[0],r+=C*z[1]}}return f>0?p?[l/f,r/f,g/f]:[l/f,r/f]:b>0?p?[n[E],n[E+1],n[E+2]]:[n[E],n[E+1]]:null}(r,0,l[0],b,p):null;if(!t)return null;M[0]=t[0],M[1]=t[1],b&&t.length>2&&(M[2]=t[2])}return n}function c(n,E,b,p,x,S,M=1){const a=P(x,S);let f=b,l=b+a,r=0,g=0,D=0,t=0,i=0;for(let e=0,u=p-1;e<u;e++,f+=a,l+=a){const m=E[f],v=E[f+1],C=E[f+2],z=E[l],j=E[l+1],F=E[l+2];let R=m*j-z*v;t+=R,r+=(m+z)*R,g+=(v+j)*R,x&&(R=m*F-z*C,D+=(C+F)*R,i+=R),m<n[0]&&(n[0]=m),m>n[1]&&(n[1]=m),v<n[2]&&(n[2]=v),v>n[3]&&(n[3]=v),x&&(C<n[4]&&(n[4]=C),C>n[5]&&(n[5]=C))}if(t*M>0&&(t*=-1),i*M>0&&(i*=-1),!t)return null;const o=[r,g,.5*t];return x&&(o[3]=D,o[4]=.5*i),o}function I(n,E,b,p){const x=b-n,S=p-E;return Math.sqrt(x*x+S*S)}function _(n,E,b,p,x,S){const M=p-n,a=x-E,f=S-b;return Math.sqrt(M*M+a*a+f*f)}function s(n,E,b,p){return[n+.5*(b-n),E+.5*(p-E)]}function h(n,E,b,p,x,S){return[n+.5*(p-n),E+.5*(x-E),b+.5*(S-b)]}},82959:(U,O,y)=>{y.d(O,{_W:()=>E,iV:()=>S,oj:()=>f});var A=y(15861),P=y(62208),d=y(55915),c=y(15994),T=y(37053),I=y(46367);const _=[0,0];function s(l,r){if(!r)return null;if("x"in r){const g={x:0,y:0};return[g.x,g.y]=l(r.x,r.y,_),null!=r.z&&(g.z=r.z),null!=r.m&&(g.m=r.m),g}if("xmin"in r){const g={xmin:0,ymin:0,xmax:0,ymax:0};return[g.xmin,g.ymin]=l(r.xmin,r.ymin,_),[g.xmax,g.ymax]=l(r.xmax,r.ymax,_),r.hasZ&&(g.zmin=r.zmin,g.zmax=r.zmax,g.hasZ=!0),r.hasM&&(g.mmin=r.mmin,g.mmax=r.mmax,g.hasM=!0),g}return"rings"in r?{rings:h(r.rings,l),hasM:r.hasM,hasZ:r.hasZ}:"paths"in r?{paths:h(r.paths,l),hasM:r.hasM,hasZ:r.hasZ}:"points"in r?{points:n(r.points,l),hasM:r.hasM,hasZ:r.hasZ}:void 0}function h(l,r){const g=[];for(const D of l)g.push(n(D,r));return g}function n(l,r){const g=[];for(const D of l){const t=r(D[0],D[1],[0,0]);g.push(t),D.length>2&&t.push(D[2]),D.length>3&&t.push(D[3])}return g}function E(l,r){return b.apply(this,arguments)}function b(){return(b=(0,A.Z)(function*(l,r){if(!r)return;const g=Array.isArray(l)?l.map(D=>(0,P.pC)(D.geometry)&&D.geometry.spatialReference):[l];yield(0,d.iQ)(g.map(D=>({source:D,dest:r})))})).apply(this,arguments)}const p=s.bind(null,I.hG),x=s.bind(null,I.R6);function S(l,r,g,D){if(!l||(g||(g=r,r=l.spatialReference),!(0,T.JY)(r)||!(0,T.JY)(g)||(0,T.fS)(r,g)))return l;if((0,I.Q8)(r,g)){const t=(0,T.sS)(g)?p(l):x(l);return t.spatialReference=g,t}return(0,d.oj)(c.N,[l],r,g,null,D)[0]}const a=new class M{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}push(r,g,D){var t=this;return(0,A.Z)(function*(){if(!r||!r.length||!g||!D||(0,T.fS)(g,D))return r;const i={geometries:r,inSpatialReference:g,outSpatialReference:D,resolve:null};return t._jobs.push(i),new Promise(o=>{i.resolve=o,null===t._timer&&(t._timer=setTimeout(t._process,10))})})()}_process(){this._timer=null;const r=this._jobs.shift();if(!r)return;const{geometries:g,inSpatialReference:D,outSpatialReference:t,resolve:i}=r;(0,I.Q8)(D,t)?(0,T.sS)(t)?i(g.map(p)):i(g.map(x)):i((0,d.oj)(c.N,g,D,t,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function f(l,r,g){return a.push(l,r,g)}},99666:(U,O,y)=>{y.d(O,{KS:()=>h,PX:()=>T,QS:()=>E,_I:()=>A,jL:()=>s,nE:()=>n,vs:()=>_,xp:()=>I});const A=8388607,P=8388608,T=0,I=1,_=b=>(b&P)>>>23,s=b=>b&A,h=b=>_(b)===I?254:255;function n(b){return _(b)===I}function E(b,p){return((p?P:0)|b)>>>0}},31982:(U,O,y)=>{y.d(O,{J:()=>P,g:()=>A});const A=(d,c)=>d&&((...T)=>c.warn("DEBUG:",...T))||(()=>null),P=!1},36682:(U,O,y)=>{y.d(O,{Z:()=>g});var A=y(15861),P=y(26584),d=y(8314),c=y(63290),T=y(21286),I=y(62208),_=y(10699),s=y(84682),h=y(60466),n=y(39351),E=y(99666),b=y(64288),p=y(31982),x=y(6257),S=y(67969);const M=c.Z.getLogger("esri.views.layers.2d.features.support.AttributeStore"),a=(0,p.g)(p.J,M),f={sharedArrayBuffer:(0,d.Z)("esri-shared-array-buffer"),atomics:(0,d.Z)("esri-atomics")};function l(D,t){return i=>t(D(i))}class r{constructor(t,i,o,e){this.size=0,this.texelSize=4;const{pixelType:u,layout:m,textureOnly:v}=e;this.textureOnly=v||!1,this.pixelType=u,this._ctype=i,this.layout=m,this._resetRange(),this._shared=t,this.size=o,v||(this.data=this._initData(u,o,t,i))}get buffer(){return(0,I.yw)(this.data,t=>t.buffer)}unsetComponentAllTexels(t,i){const o=(0,I.Wg)(this.data);for(let e=0;e<this.size*this.size;e++)o[e*this.texelSize+t]&=~i;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(t,i){const o=(0,I.Wg)(this.data);for(let e=0;e<this.size*this.size;e++)o[e*this.texelSize+t]|=255&i;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(t,i,o){const e=(0,I.Wg)(this.data);for(const u of o)e[u*this.texelSize+t]|=i,this.dirtyStart=Math.min(this.dirtyStart,u),this.dirtyEnd=Math.max(this.dirtyEnd,u)}setComponentTexel(t,i,o){(0,I.Wg)(this.data)[o*this.texelSize+t]|=i,this.dirtyStart=Math.min(this.dirtyStart,o),this.dirtyEnd=Math.max(this.dirtyEnd,o)}unsetComponentTexel(t,i,o){(0,I.Wg)(this.data)[o*this.texelSize+t]&=~i,this.dirtyStart=Math.min(this.dirtyStart,o),this.dirtyEnd=Math.max(this.dirtyEnd,o)}getData(t,i){const o=(0,E.jL)(t);return(0,I.Wg)(this.data)[o*this.texelSize+i]}setData(t,i,o){const e=(0,E.jL)(t);0!=(this.layout&1<<i)?(this.data[e*this.texelSize+i]=o,this.dirtyStart=Math.min(this.dirtyStart,e),this.dirtyEnd=Math.max(this.dirtyEnd,e)):M.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}lock(){this.pixelType===S.Br.UNSIGNED_BYTE&&this._shared&&f.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1)}unlock(){this.pixelType===S.Br.UNSIGNED_BYTE&&this._shared&&f.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0)}expand(t){if(this.size=t,!this.textureOnly){const i=this._initData(this.pixelType,t,this._shared,this._ctype),o=(0,I.Wg)(this.data);i.set(o),this.data=i}}toMessage(){const t=this.dirtyStart,i=this.dirtyEnd,o=this.texelSize;if(t>i)return null;this._resetRange();const e=!(this._shared||"local"===this._ctype),u=this.pixelType,m=this.layout,v=(0,I.Wg)(this.data);return{start:t,end:i,data:e&&v.slice(t*o,(i+1)*o)||null,pixelType:u,layout:m}}_initData(t,i,o,e){const u=o&&"local"!==e?SharedArrayBuffer:ArrayBuffer,m=(0,b.UK)(t),v=new m(new u(i*i*4*m.BYTES_PER_ELEMENT));for(let C=0;C<v.length;C+=4)v[C+1]=255;return v}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}class g{constructor(t,i,o=(()=>{})){this._client=t,this.config=i,this._notifyChange=o,this._attributeComputeMap=new Map,this._blocks=new Array,this._filters=new Array(n.m4),this._targetType=0,this._abortController=new AbortController,this._hasScaleExpr=!1,this._size=32,this._idsToHighlight=new Set;const e=i.supportsTextureFloat?S.Br.FLOAT:S.Br.UNSIGNED_BYTE;a(`Creating AttributeStore ${f.sharedArrayBuffer?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:S.Br.UNSIGNED_BYTE,layout:1},{pixelType:S.Br.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:S.Br.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:e,layout:15},{pixelType:e,layout:15},{pixelType:e,layout:15},{pixelType:e,layout:15}],this._blocks=this._blockDescriptors.map(()=>null)}destroy(){this._abortController.abort()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}get hasHighlight(){return this._idsToHighlight.size>0}isUpdating(){return!!this._currUpdate||!!this._nextUpdate}update(t,i){this.config=i;const o=i.schema.processors[0].storage,e=(0,s.Hg)(this._schema,o);if((t.targets.feature||t.targets.aggregate)&&(t.storage.data=!0),e&&((0,d.Z)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:",e),t.storage.data=!0,this._schema=o,this._attributeComputeMap.clear(),!(0,I.Wi)(o))){switch(o.target){case"feature":this._targetType=E.PX;break;case"aggregate":this._targetType=E.xp}if("subtype"===o.type)for(const u in o.mapping){const m=o.mapping[u];if((0,I.pC)(m)&&(0,I.pC)(m.vvMapping))for(const v of m.vvMapping)this._bindAttribute(v)}else{if((0,I.pC)(o.vvMapping))for(const u of o.vvMapping)this._bindAttribute(u);if((0,I.pC)(o.attributeMapping))for(const u of o.attributeMapping)this._bindAttribute(u)}}}onTileData(t,i){if((0,I.Wi)(i.addOrUpdate))return;const o=i.addOrUpdate.getCursor();for(;o.next();){const e=o.getDisplayId();this.setAttributeData(e,o)}}invalidateResources(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=new AbortController}setHighlight(t,i){var o=this;return(0,A.Z)(function*(){const u=o._getBlock(0),m=i.map(v=>(0,E.jL)(v));u.lock(),u.unsetComponentAllTexels(0,1),u.setComponent(0,1,m),u.unlock(),o._idsToHighlight.clear();for(const v of t)o._idsToHighlight.add(v);yield o.sendUpdates()})()}updateFilters(t,i,o){var e=this;return(0,A.Z)(function*(){const{service:u,spatialReference:m}=o,{filters:v}=i,C=v.map((z,j)=>e._updateFilter(z,j,u,m));(yield Promise.all(C)).some(z=>z)&&(t.storage.filters=!0,(0,d.Z)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:","Filters changed"))})()}setData(t,i,o,e){const u=(0,E.jL)(t);this._ensureSizeForTexel(u),this._getBlock(i).setData(t,o,e)}getData(t,i,o){return this._getBlock(i).getData(t,o)}getHighlightFlag(t){return this._idsToHighlight.has(t)?n.uG:0}unsetAttributeData(t){const i=(0,E.jL)(t);this._getBlock(0).setData(i,0,0)}setAttributeData(t,i){const o=(0,E.jL)(t);if(this._ensureSizeForTexel(o),this._getBlock(0).setData(o,0,this.getFilterFlags(i)),this._targetType!==(0,E.vs)(t))return;const e=this._attributeComputeMap,u=this.config.supportsTextureFloat?1:2;e.size&&e.forEach((v,C)=>{const z=C*u%4,j=Math.floor(C*u/4),F=this._getBlock(j+n.aK),R=v(i);if(this.config.supportsTextureFloat)F.setData(o,z,R);else if(R===n.AI)F.setData(o,z,255),F.setData(o,z+1,255);else{const N=(0,T.uZ)(Math.round(R),-32767,32766)+32768,Z=(65280&N)>>8;F.setData(o,z,255&N),F.setData(o,z+1,Z)}})}sendUpdates(){if((0,d.Z)("esri-2d-update-debug")&&console.debug("AttributeStore::sendUpdate"),this._notifyChange(),this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=(0,_.hh)(),this._nextUpdate.promise;const t={blocks:this._blocks.map(i=>(0,I.pC)(i)?i.toMessage():null)};return this._currUpdate=this._createResources().then(()=>{const i=()=>{if(this._currUpdate=null,this._nextUpdate){const e=this._nextUpdate;this._nextUpdate=null,this.sendUpdates().then(()=>e.resolve())}else(0,d.Z)("esri-2d-update-debug")&&console.debug("AttributeStore::sendUpdate::No additional updates queued");this._notifyChange()};(0,d.Z)("esri-2d-update-debug")&&console.debug("AttributeStore::sendUpdate::client.update");const o=this._client.update(t,this._signal).then(i).catch(i);return this._client.render(this._signal),o}).catch(i=>{if((0,_.D_)(i))return this._createResourcesPromise=null,this._createResources();this._notifyChange(),M.error(new P.Z("mapview-attribute-store","Encountered an error during client update",i))}),this._currUpdate}_ensureSizeForTexel(t){for(;t>=this._size*this._size;)if(this._expand())return}_bindAttribute(t){let e;if(null!=t.fieldIndex)e=function o(){return t.normalizationField&&M.warn("mapview-arcade","Ignoring normalizationField specified with an arcade expression which is not supported."),m=>m.getComputedNumericAtIndex(t.fieldIndex)}();else{if(!t.field)return;e=function i(){return t.normalizationField?m=>{const v=m.readAttribute(t.normalizationField);return v?m.readAttribute(t.field)/v:null}:m=>m.readAttribute(t.field)}()}t.valueRepresentation&&(e=l(e,m=>(0,x.qc)(m,t.valueRepresentation))),this._attributeComputeMap.set(t.binding,l(e,m=>null===m||isNaN(m)||m===1/0?n.AI:m))}_createResources(){if((0,I.pC)(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(n.xl),this._getBlock(n.pU),a("Initializing AttributeStore");const t={shared:f.sharedArrayBuffer&&"local"!==this._client.type,size:this._size,blocks:(0,I.Fd)(this._blocks,o=>({textureOnly:o.textureOnly,buffer:o.buffer,pixelType:o.pixelType}))},i=this._client.initialize(t,this._signal).catch(o=>{(0,_.D_)(o)?this._createResourcesPromise=null:M.error(new P.Z("mapview-attribute-store","Encountered an error during client initialization",o))});return this._createResourcesPromise=i,i.then(()=>(0,I.Wi)(this._createResourcesPromise)?this._createResources():void 0),i}_getBlock(t){const i=this._blocks[t];if((0,I.pC)(i))return i;a(`Initializing AttributeBlock at index ${t}`);const u=new r(f.sharedArrayBuffer,this._client.type,this._size,this._blockDescriptors[t]);return this._blocks[t]=u,this._createResourcesPromise=null,u}_expand(){if(this._size<this.config.maxTextureSize){const t=this._size<<=1;return a("Expanding block size to",t,this._blocks),(0,I.JR)(this._blocks,i=>i.expand(t)),this._createResourcesPromise=null,this._size=t,0}return M.error(new P.Z("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}_updateFilter(t,i,o,e){var u=this;return(0,A.Z)(function*(){const m=u._filters[i],v=(0,I.pC)(m)&&m.hash;if(!m&&!t||v===JSON.stringify(t))return!1;if((0,I.Wi)(t)){if(!m)return!1;const z=1<<i+1,j=u._getBlock(0);return u._filters[i]=null,j.setComponentAllTexels(0,z),u.sendUpdates(),!0}return yield(yield u._getFilter(i,o)).update(t,e),!0})()}_getFilter(t,i){var o=this;return(0,A.Z)(function*(){const e=o._filters[t];if((0,I.pC)(e))return e;const{default:u}=yield Promise.all([y.e(8592),y.e(8967)]).then(y.bind(y,8967)),m=new u({geometryType:i.geometryType,hasM:!1,hasZ:!1,timeInfo:i.timeInfo,fieldsIndex:new h.Z(i.fields)});return o._filters[t]=m,m})()}isVisible(t){return!!(2&this._getBlock(0).getData(t,0))}getFilterFlags(t){let i=0;const o=(0,E.KS)(t.getDisplayId());for(let u=0;u<this._filters.length;u++){const v=this._filters[u];i|=(o&1<<u&&!(0,I.Wi)(v)&&!v.check(t)?0:1)<<u}let e=0;if(this._idsToHighlight.size){const u=t.getObjectId();e=this.getHighlightFlag(u)}return i<<1|e}}},93872:(U,O,y)=>{y.d(O,{O:()=>T});var A=y(99666);class P{constructor(){this._freeIds=[],this._idCounter=1}createId(_=!1){return(0,A.QS)(this._getFreeId(),_)}releaseId(_){this._freeIds.push(_)}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}var d=y(42797);function c(I,_,s){if(!(I.length>_))for(;I.length<=_;)I.push(s)}class T{constructor(){this._numerics=[],this._strings=[],this._idGenerator=new P,this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[]}createBitset(){const _=this._bitsets.length;return this._bitsets.push(d.p.create(this._allocatedSize,A._I)),_+1}getBitset(_){return this._bitsets[_-1]}_expand(){this._allocatedSize<<=1;for(const _ of this._bitsets)_.resize(this._allocatedSize)}_ensureNumeric(_,s){this._numerics[_]||(this._numerics[_]=[]),c(this._numerics[_],s,0)}_ensureInstanceId(_){c(this._instanceIds,_,0)}_ensureString(_,s){this._strings[_]||(this._strings[_]=[]),c(this._strings[_],s,null)}createDisplayId(_=!1){const s=this._idGenerator.createId();return s>this._allocatedSize&&this._expand(),(0,A.QS)(s,_)}releaseDisplayId(_){for(const s of this._bitsets)s.unset(_);return this._idGenerator.releaseId(_&A._I)}getComputedNumeric(_,s){return this.getComputedNumericAtIndex(_&A._I,0)}setComputedNumeric(_,s,h){return this.setComputedNumericAtIndex(_&A._I,h,0)}getComputedString(_,s){return this.getComputedStringAtIndex(_&A._I,0)}setComputedString(_,s,h){return this.setComputedStringAtIndex(_&A._I,0,h)}getComputedNumericAtIndex(_,s){const h=_&A._I;return this._ensureNumeric(s,h),this._numerics[s][h]}setComputedNumericAtIndex(_,s,h){const n=_&A._I;this._ensureNumeric(s,n),this._numerics[s][n]=h}getInstanceId(_){const s=_&A._I;return this._ensureInstanceId(s),this._instanceIds[s]}setInstanceId(_,s){const h=_&A._I;this._ensureInstanceId(h),this._instanceIds[h]=s}getComputedStringAtIndex(_,s){const h=_&A._I;return this._ensureString(s,h),this._strings[s][h]}setComputedStringAtIndex(_,s,h){const n=_&A._I;this._ensureString(s,n),this._strings[s][n]=h}getXMin(_){return this._bounds[4*(_&A._I)]}getYMin(_){return this._bounds[4*(_&A._I)+1]}getXMax(_){return this._bounds[4*(_&A._I)+2]}getYMax(_){return this._bounds[4*(_&A._I)+3]}setBounds(_,s){const h=s.readHydratedGeometry();if(!h||!h.coords.length)return!1;let n=1/0,E=1/0,b=-1/0,p=-1/0;h.forEachVertex((S,M)=>{n=Math.min(n,S),E=Math.min(E,M),b=Math.max(b,S),p=Math.max(p,M)});const x=_&A._I;return c(this._bounds,4*x+4,0),this._bounds[4*x]=n,this._bounds[4*x+1]=E,this._bounds[4*x+2]=b,this._bounds[4*x+3]=p,!0}}},25208:(U,O,y)=>{var D,t,i;y.d(O,{s:()=>g}),y(29132);var P=y(8314),d=y(62208),c=y(77044),T=y(82054),I=y(88071),_=y(42797),s=y(91179);let h=0;const n=null!=(D=(0,P.Z)("featurelayer-simplify-thresholds"))?D:[.5,.5,.5,.5],E=n[0],b=n[1],p=n[2],x=n[3],S=null!=(t=(0,P.Z)("featurelayer-simplify-payload-size-factors"))?t:[1,2,4],M=S[0],a=S[1],f=S[2],l=null!=(i=(0,P.Z)("featurelayer-simplify-mobile-factor"))?i:2,r=(0,P.Z)("esri-mobile");class g{constructor(e,u){this.type="FeatureSetReader",this.arcadeDeclaredClass="esri.arcade.Feature",this.seen=!1,this.instance=0,this._tx=0,this._ty=0,this._sx=1,this._sy=1,this._deleted=null,this._joined=[],this._objectIdToIndex=null,this._level=0,this.instance=e,this._layerSchema=u}static createInstance(){return h++,h=h>65535?0:h,h}get isEmpty(){return(0,d.pC)(this._deleted)&&this._deleted.countSet()===this.getSize()}set level(e){this._level=e}getAreaSimplificationThreshold(e,u){let m=1;const v=r?l:1;u>4e6?m=f*v:u>1e6?m=a*v:u>5e5?m=M*v:u>1e5&&(m=v);let C=0;e>4e3?C=x*m:e>2e3?C=p*m:e>100?C=b:e>15&&(C=E);let z=8;return this._level<4?z=1:this._level<5?z=2:this._level<6&&(z=4),C*z}setArcadeSpatialReference(e){this._arcadeSpatialReference=e}attachStorage(e){this._storage=e}getQuantizationTransform(){throw new Error("Unable to find transform for featureSet")}getStorage(){return this._storage}getComputedNumeric(e){return this.getComputedNumericAtIndex(0)}setComputedNumeric(e,u){return this.setComputedNumericAtIndex(u,0)}getComputedString(e){return this.getComputedStringAtIndex(0)}setComputedString(e,u){return this.setComputedStringAtIndex(0,u)}getComputedNumericAtIndex(e){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),e)}setComputedNumericAtIndex(e,u){this._storage.setComputedNumericAtIndex(this.getDisplayId(),e,u)}getComputedStringAtIndex(e){return this._storage.getComputedStringAtIndex(this.getDisplayId(),e)}setComputedStringAtIndex(e,u){return this._storage.setComputedStringAtIndex(this.getDisplayId(),e,u)}transform(e,u,m,v){const C=this.copy();return C._tx+=e,C._ty+=u,C._sx*=m,C._sy*=v,C}readAttribute(e,u=!1){const m=this._readAttribute(e,u);if(void 0!==m)return m;for(const v of this._joined){v.setIndex(this.getIndex());const C=v._readAttribute(e,u);if(void 0!==C)return C}}readAttributes(){const e=this._readAttributes();for(const u of this._joined){u.setIndex(this.getIndex());const m=u._readAttributes();for(const v of Object.keys(m))e[v]=m[v]}return e}joinAttributes(e){this._joined.push(e)}readArcadeFeature(){return this}geometry(){const e=this.readHydratedGeometry(),u=(0,T.di)(e,this.geometryType,this.hasZ,this.hasM),m=(0,s.im)(u);return m&&(m.spatialReference=this._arcadeSpatialReference),m}field(e){if(this.hasField(e))return this.readAttribute(e,!0);for(const u of this._joined)if(u.setIndex(this.getIndex()),u.hasField(e))return u._readAttribute(e,!0);throw new Error(`Field ${e} does not exist`)}setField(e,u){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this.getFieldNames()}castToText(){return JSON.stringify(this.readLegacyFeature())}gdbVersion(){return null}fullSchema(){return this._layerSchema}castAsJson(e=null){return{attributes:this._readAttributes(),geometry:!0===(null==e?void 0:e.keepGeometryType)?this.geometry():this.geometry().toJSON()}}castAsJsonAsync(e=null,u=null){return Promise.resolve(this.castAsJson(u))}removeIds(e){if((0,d.Wi)(this._objectIdToIndex)){const m=new Map,v=this.getCursor();for(;v.next();)m.set(v.getObjectId(),v.getIndex());this._objectIdToIndex=m}const u=this._objectIdToIndex;for(const m of e)u.has(m)&&this.removeAtIndex(u.get(m))}removeAtIndex(e){(0,d.Wi)(this._deleted)&&(this._deleted=_.p.create(this.getSize())),this._deleted.set(e)}readGeometryForDisplay(){return this.readUnquantizedGeometry(!0)}readLegacyGeometryForDisplay(){return this.readLegacyGeometry(!0)}*features(){const e=this.getCursor();for(;e.next();)yield e.readOptimizedFeature()}_getExists(){return(0,d.Wi)(this._deleted)||!this._deleted.has(this.getIndex())}_computeCentroid(){if("esriGeometryPolygon"!==this.geometryType)return null;const e=this.readUnquantizedGeometry();if(!e||e.hasIndeterminateRingOrder)return null;const u=(0,d.Pt)(this.getQuantizationTransform(),null);return(0,c.Y)(new I.Z,e,this.hasM,this.hasZ,u)}copyInto(e){e.seen=this.seen,e._storage=this._storage,e._arcadeSpatialReference=this._arcadeSpatialReference,e._joined=this._joined,e._tx=this._tx,e._ty=this._ty,e._sx=this._sx,e._sy=this._sy,e._deleted=this._deleted,e._objectIdToIndex=this._objectIdToIndex}}},64822:(U,O,y)=>{y.d(O,{i:()=>I});var A=y(62208),P=y(82054),d=y(66385),c=y(25208);class I extends c.s{constructor(s,h,n){super(s,n),this._featureIndex=-1,this._dateFields=new Set,this._geometryType=null==n?void 0:n.geometryType,this._features=h}static fromFeatures(s,h){const{objectIdField:n,geometryType:E}=h,b=(0,P.Yn)([],s,E,!1,!1,n);for(let p=0;p<b.length;p++)b[p].displayId=s[p].displayId;return I.fromOptimizedFeatures(b,h)}static fromFeatureSet(s,h){const n=(0,P.h_)(s,h.objectIdField);return I.fromOptimizedFeatureSet(n,h)}static fromOptimizedFeatureSet(s,h){const{features:n}=s,E=I.fromOptimizedFeatures(n,h);E._exceededTransferLimit=s.exceededTransferLimit,E._transform=s.transform;for(const b of s.fields)"esriFieldTypeDate"===b.type&&E._dateFields.add(b.name);return E}static fromOptimizedFeatures(s,h,n){const E=c.s.createInstance(),b=new I(E,s,h);return b._transform=n,b}get _current(){return this._features[this._featureIndex]}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}removeIds(s){const h=new Set(s);this._features=this._features.filter(n=>!h.has(n.objectId))}append(s){for(const h of s)this._features.push(h)}getSize(){return this._features.length}getCursor(){return this.copy()}getQuantizationTransform(){return this._transform}getAttributeHash(){let s="";for(const h in this._current.attributes)s+=this._current.attributes[h];return s}getIndex(){return this._featureIndex}setIndex(s){this._featureIndex=s}getObjectId(){return this._current.objectId}getDisplayId(){return this._current.displayId}setDisplayId(s){this._current.displayId=s}getGroupId(){return this._current.groupId}setGroupId(s){this._current.groupId=s}copy(){const s=new I(this.instance,this._features,this.fullSchema());return this.copyInto(s),s}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readLegacyFeature(){return(0,P.EI)(this._current,this.geometryType,this.hasZ,this.hasM)}readOptimizedFeature(){return this._current}readLegacyPointGeometry(){return this.readGeometry()?{x:this.getX(),y:this.getY()}:null}readLegacyGeometry(){const s=this.readGeometry();return(0,P.di)(s,this.geometryType,this.hasZ,this.hasM)}readLegacyCentroid(){const s=this.readCentroid();return(0,A.Wi)(s)?null:{x:s.coords[0]*this._sx+this._tx,y:s.coords[1]*this._sy+this._ty}}readGeometryArea(){return(0,d.S6)(this._current)?(0,P.lz)(this._current.geometry,2):0}readUnquantizedGeometry(){const s=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!s)return s;const h=s.clone();return function T({coords:_,lengths:s}){let h=0;for(const n of s){for(let E=1;E<n;E++)_[2*(h+E)]+=_[2*(h+E)-2],_[2*(h+E)+1]+=_[2*(h+E)-1];h+=n}}(h),h}readHydratedGeometry(){const s=this._current.geometry;if((0,A.Wi)(s))return null;const h=s.clone();return(0,A.pC)(this._transform)&&(0,P.$g)(h,h,this.hasZ,this.hasM,this._transform),h}getXHydrated(){if(!(0,d.S6)(this._current))return 0;const s=this._current.geometry.coords[0],h=this.getQuantizationTransform();return(0,A.Wi)(h)?s:s*h.scale[0]+h.translate[0]}getYHydrated(){if(!(0,d.S6)(this._current))return 0;const s=this._current.geometry.coords[1],h=this.getQuantizationTransform();return(0,A.Wi)(h)?s:h.translate[1]-s*h.scale[1]}getX(){return(0,d.S6)(this._current)?this._current.geometry.coords[0]*this._sx+this._tx:0}getY(){return(0,d.S6)(this._current)?this._current.geometry.coords[1]*this._sy+this._ty:0}readGeometry(){if(!(0,d.S6)(this._current))return null;const s=this._current.geometry.clone();if(s.isPoint)return s.coords[0]=s.coords[0]*this._sx+this._tx,s.coords[1]=s.coords[1]*this._sy+this._ty,s;let h=0;for(const n of s.lengths)s.coords[2*h]=s.coords[2*h]*this._sx+this._tx,s.coords[2*h+1]=s.coords[2*h+1]*this._sy+this._ty,h+=n;return s}readCentroid(){if(!(0,d.S6)(this._current))return null;if((0,A.Wi)(this._current.centroid)){const h=this._computeCentroid();if((0,A.Wi)(h))return null;h.coords[0]=(h.coords[0]-this._tx)/this._sx,h.coords[1]=(h.coords[1]-this._ty)/this._sy,this._current.centroid=h}const s=this._current.centroid.clone();return s.coords[0]=s.coords[0]*this._sx+this._tx,s.coords[1]=s.coords[1]*this._sx+this._ty,s}hasField(s){return s in this._current.attributes||this.getFieldNames().map(h=>h.toLowerCase()).includes(s.toLowerCase())}getFieldNames(){return Object.keys(this._current.attributes)}_readAttribute(s,h){const n=this._current.attributes[s];if(void 0!==n)return null!=n&&h&&this._dateFields.has(s)?new Date(n):n;const E=this.readAttributes(),b=s.toLocaleLowerCase().trim();for(const p in E)if(p.toLocaleLowerCase().trim()===b){const x=this._current.attributes[p];return null!=x&&h&&this._dateFields.has(p)?new Date(x):x}}copyInto(s){super.copyInto(s),s._featureIndex=this._featureIndex,s._transform=this._transform,s._dateFields=this._dateFields}_readAttributes(){return this._current.attributes}}},42797:(U,O,y)=>{y.d(O,{p:()=>A});class A{constructor(d,c){this._mask=0,this._buf=d,this._mask=c}static fromBuffer(d,c){return new A(d,c)}static create(d,c=4294967295){const T=new Uint32Array(Math.ceil(d/32));return new A(T,c)}_getIndex(d){return Math.floor(d/32)}has(d){const c=this._mask&d;return!!(this._buf[this._getIndex(c)]&1<<c%32)}hasRange(d,c){let T=d,I=c;for(;T%32&&T!==I;){if(this.has(T))return!0;T++}for(;I%32&&T!==I;){if(this.has(T))return!0;I--}if(T===I)return!1;for(let _=T/32;_!==I/32;_++)if(this._buf[_])return!0;return!1}set(d){const c=this._mask&d,T=this._getIndex(c);this._buf[T]|=1<<c%32}setRange(d,c){let T=d,I=c;for(;T%32&&T!==I;)this.set(T++);for(;I%32&&T!==I;)this.set(I--);if(T!==I)for(let _=T/32;_!==I/32;_++)this._buf[_]=4294967295}unset(d){const c=this._mask&d,T=this._getIndex(c);this._buf[T]&=4294967295^1<<c%32}resize(d){const c=this._buf,T=new Uint32Array(Math.ceil(d/32));T.set(c),this._buf=T}or(d){for(let c=0;c<this._buf.length;c++)this._buf[c]|=d._buf[c];return this}and(d){for(let c=0;c<this._buf.length;c++)this._buf[c]&=d._buf[c];return this}xor(d){for(let c=0;c<this._buf.length;c++)this._buf[c]^=d._buf[c];return this}ior(d){for(let c=0;c<this._buf.length;c++)this._buf[c]|=~d._buf[c];return this}iand(d){for(let c=0;c<this._buf.length;c++)this._buf[c]&=~d._buf[c];return this}ixor(d){for(let c=0;c<this._buf.length;c++)this._buf[c]^=~d._buf[c];return this}any(){for(let d=0;d<this._buf.length;d++)if(this._buf[d])return!0;return!1}copy(d){for(let c=0;c<this._buf.length;c++)this._buf[c]=d._buf[c];return this}clone(){return new A(this._buf.slice(),this._mask)}clear(){for(let d=0;d<this._buf.length;d++)this._buf[d]=0}forEachSet(d){for(let c=0;c<this._buf.length;c++){let T=this._buf[c],I=32*c;if(T)for(;T;)1&T&&d(I),T>>>=1,I++}}countSet(){let d=0;return this.forEachSet(c=>{d++}),d}}},6257:(U,O,y)=>{y.d(O,{I:()=>p,qc:()=>_});var A=y(62208),P=y(23841),d=y(81295),c=y(39351),T=y(39406),I=y(25310);function _(a,f){if(!a||!f)return a;switch(f){case"radius":case"distance":return 2*a;case"diameter":case"width":return a;case"area":return Math.sqrt(a)}return a}function h(a){return a.map(f=>function s(a){return{value:a.value,size:(0,P.t_)(a.size)}}(f))}function n(a){return"string"==typeof a||"number"==typeof a?(0,P.t_)(a):{type:"size",expression:a.expression,stops:h(a.stops)}}const b=a=>{const f=[],l=[],r=h(a),g=r.length;for(let D=0;D<6;D++){const t=r[Math.min(D,g-1)];f.push(t.value),l.push(null==t.size?c.AI:(0,P.F2)(t.size))}return{values:new Float32Array(f),sizes:new Float32Array(l)}};function p(a){const f=a&&a.length>0?{}:null,l=f?{}:null;if(!f)return{vvFields:f,vvRanges:l};for(const r of a)if(r.field&&(f[r.type]=r.field),"size"===r.type){l.size||(l.size={});const g=r;switch((0,I.a)(g)){case T.X.SIZE_MINMAX_VALUE:l.size.minMaxValue={minDataValue:g.minDataValue,maxDataValue:g.maxDataValue,minSize:n(g.minSize),maxSize:n(g.maxSize)};break;case T.X.SIZE_SCALE_STOPS:l.size.scaleStops={stops:h(g.stops)};break;case T.X.SIZE_FIELD_STOPS:if(g.levels){const D={};for(const t in g.levels)D[t]=b(g.levels[t]);l.size.fieldStops={type:"level-dependent",levels:D}}else l.size.fieldStops=W({type:"static"},b(g.stops));break;case T.X.SIZE_UNIT_VALUE:l.size.unitValue={unit:g.valueUnit,valueRepresentation:g.valueRepresentation}}}else"color"===r.type?l.color=M(r):"opacity"===r.type?l.opacity=x(r):"rotation"===r.type&&(l.rotation={type:r.rotationType});return{vvFields:f,vvRanges:l}}function x(a){const f={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof a.field){if(!a.stops)return null;{if(a.stops.length>8)return null;const l=a.stops;for(let r=0;r<8;++r){const g=l[Math.min(r,l.length-1)];f.values[r]=g.value,f.opacities[r]=g.opacity}}}else{if(!(a.stops&&a.stops.length>=0))return null;{const l=a.stops&&a.stops.length>=0&&a.stops[0].opacity;for(let r=0;r<8;r++)f.values[r]=1/0,f.opacities[r]=l}}return f}function S(a,f,l){a[4*f+0]=l.r/255,a[4*f+1]=l.g/255,a[4*f+2]=l.b/255,a[4*f+3]=l.a}function M(a){if((0,A.Wi)(a)||a.normalizationField)return null;const f={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof a.field){if(!a.stops)return null;{if(a.stops.length>8)return null;f.field=a.field;const l=a.stops;for(let r=0;r<8;++r){const g=l[Math.min(r,l.length-1)];f.values[r]=g.value,S(f.colors,r,g.color)}}}else{if(!(a.stops&&a.stops.length>=0))return null;{const l=a.stops&&a.stops.length>=0&&a.stops[0].color;for(let r=0;r<8;r++)f.values[r]=1/0,S(f.colors,r,l)}}for(let l=0;l<32;l+=4)(0,d.pr)(f.colors,l,!0);return f}}}]);