!function(et){"object"==typeof exports&&"undefined"!=typeof module?module.exports=et():"function"==typeof define&&define.amd?define([],et):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PouchDB=et()}(function(){return function et(yt,Q,M){function V(E,P){if(!Q[E]){if(!yt[E]){var X="function"==typeof require&&require;if(!P&&X)return X(E,!0);if(L)return L(E,!0);var ct=new Error("Cannot find module '"+E+"'");throw ct.code="MODULE_NOT_FOUND",ct}var H=Q[E]={exports:{}};yt[E][0].call(H.exports,function(O){return V(yt[E][1][O]||O)},H,H.exports,et,yt,Q,M)}return Q[E].exports}for(var L="function"==typeof require&&require,C=0;C<M.length;C++)V(M[C]);return V}({1:[function(et,yt,Q){"use strict";yt.exports=function(M){return function(){var V=arguments.length;if(V){for(var L=[],C=-1;++C<V;)L[C]=arguments[C];return M.call(this,L)}return M.call(this,[])}}},{}],2:[function(et,yt,Q){},{}],3:[function(et,yt,Q){var M=Object.create||function(T){var W=function(){};return W.prototype=T,new W},V=Object.keys||function(T){var W=[];for(var Y in T)Object.prototype.hasOwnProperty.call(T,Y)&&W.push(Y);return Y},L=Function.prototype.bind||function(T){var W=this;return function(){return W.apply(T,arguments)}};function C(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=M(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}yt.exports=C,C.EventEmitter=C,C.prototype._events=void 0,C.prototype._maxListeners=void 0;var E,P=10;try{var X={};Object.defineProperty&&Object.defineProperty(X,"x",{value:0}),E=0===X.x}catch(T){E=!1}function ct(T){return void 0===T._maxListeners?C.defaultMaxListeners:T._maxListeners}function H(T,W,Y){if(W)T.call(Y);else for(var at=T.length,dt=lt(T,at),ht=0;ht<at;++ht)dt[ht].call(Y)}function O(T,W,Y,at){if(W)T.call(Y,at);else for(var dt=T.length,ht=lt(T,dt),gt=0;gt<dt;++gt)ht[gt].call(Y,at)}function F(T,W,Y,at,dt){if(W)T.call(Y,at,dt);else for(var ht=T.length,gt=lt(T,ht),wt=0;wt<ht;++wt)gt[wt].call(Y,at,dt)}function g(T,W,Y,at,dt,ht){if(W)T.call(Y,at,dt,ht);else for(var gt=T.length,wt=lt(T,gt),It=0;It<gt;++It)wt[It].call(Y,at,dt,ht)}function a(T,W,Y,at){if(W)T.apply(Y,at);else for(var dt=T.length,ht=lt(T,dt),gt=0;gt<dt;++gt)ht[gt].apply(Y,at)}function u(T,W,Y,at){var dt,ht,gt;if("function"!=typeof Y)throw new TypeError('"listener" argument must be a function');if((ht=T._events)?(ht.newListener&&(T.emit("newListener",W,Y.listener?Y.listener:Y),ht=T._events),gt=ht[W]):(ht=T._events=M(null),T._eventsCount=0),gt){if("function"==typeof gt?gt=ht[W]=at?[Y,gt]:[gt,Y]:at?gt.unshift(Y):gt.push(Y),!gt.warned&&(dt=ct(T))&&dt>0&&gt.length>dt){gt.warned=!0;var wt=new Error("Possible EventEmitter memory leak detected. "+gt.length+' "'+String(W)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');wt.name="MaxListenersExceededWarning",wt.emitter=T,wt.type=W,wt.count=gt.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",wt.name,wt.message)}}else gt=ht[W]=Y,++T._eventsCount;return T}function f(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var T=new Array(arguments.length),W=0;W<T.length;++W)T[W]=arguments[W];this.listener.apply(this.target,T)}}function v(T,W,Y){var at={fired:!1,wrapFn:void 0,target:T,type:W,listener:Y},dt=L.call(f,at);return dt.listener=Y,at.wrapFn=dt,dt}function k(T,W,Y){var at=T._events;if(!at)return[];var dt=at[W];return dt?"function"==typeof dt?Y?[dt.listener||dt]:[dt]:Y?function(ht){for(var gt=new Array(ht.length),wt=0;wt<gt.length;++wt)gt[wt]=ht[wt].listener||ht[wt];return gt}(dt):lt(dt,dt.length):[]}function mt(T){var W=this._events;if(W){var Y=W[T];if("function"==typeof Y)return 1;if(Y)return Y.length}return 0}function lt(T,W){for(var Y=new Array(W),at=0;at<W;++at)Y[at]=T[at];return Y}E?Object.defineProperty(C,"defaultMaxListeners",{enumerable:!0,get:function(){return P},set:function(T){if("number"!=typeof T||T<0||T!=T)throw new TypeError('"defaultMaxListeners" must be a positive number');P=T}}):C.defaultMaxListeners=P,C.prototype.setMaxListeners=function(T){if("number"!=typeof T||T<0||isNaN(T))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=T,this},C.prototype.getMaxListeners=function(){return ct(this)},C.prototype.emit=function(T){var W,Y,at,dt,ht,gt,wt="error"===T;if(gt=this._events)wt=wt&&null==gt.error;else if(!wt)return!1;if(wt){if(arguments.length>1&&(W=arguments[1]),W instanceof Error)throw W;var It=new Error('Unhandled "error" event. ('+W+")");throw It.context=W,It}if(!(Y=gt[T]))return!1;var Pt="function"==typeof Y;switch(at=arguments.length){case 1:H(Y,Pt,this);break;case 2:O(Y,Pt,this,arguments[1]);break;case 3:F(Y,Pt,this,arguments[1],arguments[2]);break;case 4:g(Y,Pt,this,arguments[1],arguments[2],arguments[3]);break;default:for(dt=new Array(at-1),ht=1;ht<at;ht++)dt[ht-1]=arguments[ht];a(Y,Pt,this,dt)}return!0},C.prototype.on=C.prototype.addListener=function(T,W){return u(this,T,W,!1)},C.prototype.prependListener=function(T,W){return u(this,T,W,!0)},C.prototype.once=function(T,W){if("function"!=typeof W)throw new TypeError('"listener" argument must be a function');return this.on(T,v(this,T,W)),this},C.prototype.prependOnceListener=function(T,W){if("function"!=typeof W)throw new TypeError('"listener" argument must be a function');return this.prependListener(T,v(this,T,W)),this},C.prototype.removeListener=function(T,W){var Y,at,dt,ht,gt;if("function"!=typeof W)throw new TypeError('"listener" argument must be a function');if(!(at=this._events))return this;if(!(Y=at[T]))return this;if(Y===W||Y.listener===W)0==--this._eventsCount?this._events=M(null):(delete at[T],at.removeListener&&this.emit("removeListener",T,Y.listener||W));else if("function"!=typeof Y){for(dt=-1,ht=Y.length-1;ht>=0;ht--)if(Y[ht]===W||Y[ht].listener===W){gt=Y[ht].listener,dt=ht;break}if(dt<0)return this;0===dt?Y.shift():function(wt,It){for(var Pt=It,Ct=Pt+1,Ae=wt.length;Ct<Ae;Pt+=1,Ct+=1)wt[Pt]=wt[Ct];wt.pop()}(Y,dt),1===Y.length&&(at[T]=Y[0]),at.removeListener&&this.emit("removeListener",T,gt||W)}return this},C.prototype.removeAllListeners=function(T){var W,Y,at;if(!(Y=this._events))return this;if(!Y.removeListener)return 0===arguments.length?(this._events=M(null),this._eventsCount=0):Y[T]&&(0==--this._eventsCount?this._events=M(null):delete Y[T]),this;if(0===arguments.length){var dt,ht=V(Y);for(at=0;at<ht.length;++at)"removeListener"!==(dt=ht[at])&&this.removeAllListeners(dt);return this.removeAllListeners("removeListener"),this._events=M(null),this._eventsCount=0,this}if("function"==typeof(W=Y[T]))this.removeListener(T,W);else if(W)for(at=W.length-1;at>=0;at--)this.removeListener(T,W[at]);return this},C.prototype.listeners=function(T){return k(this,T,!0)},C.prototype.rawListeners=function(T){return k(this,T,!1)},C.listenerCount=function(T,W){return"function"==typeof T.listenerCount?T.listenerCount(W):mt.call(T,W)},C.prototype.listenerCount=mt,C.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],4:[function(et,yt,Q){"use strict";var M,V,L,C=[et(2),et(7),et(6),et(5),et(8),et(9)],E=-1,P=[],X=!1;function ct(){M&&V&&(M=!1,V.length?P=V.concat(P):E=-1,P.length&&H())}function H(){if(!M){X=!1,M=!0;for(var a=P.length,u=setTimeout(ct);a;){for(V=P,P=[];V&&++E<a;)V[E].run();E=-1,a=P.length}V=null,E=-1,M=!1,clearTimeout(u)}}for(var O=-1,F=C.length;++O<F;)if(C[O]&&C[O].test&&C[O].test()){L=C[O].install(H);break}function g(a,u){this.fun=a,this.array=u}g.prototype.run=function(){var a=this.fun,u=this.array;switch(u.length){case 0:return a();case 1:return a(u[0]);case 2:return a(u[0],u[1]);case 3:return a(u[0],u[1],u[2]);default:return a.apply(null,u)}},yt.exports=function(a){var u=new Array(arguments.length-1);if(arguments.length>1)for(var f=1;f<arguments.length;f++)u[f-1]=arguments[f];P.push(new g(a,u)),X||M||(X=!0,L())}},{2:2,5:5,6:6,7:7,8:8,9:9}],5:[function(et,yt,Q){(function(M){(function(){"use strict";Q.test=function(){return!M.setImmediate&&void 0!==M.MessageChannel},Q.install=function(V){var L=new M.MessageChannel;return L.port1.onmessage=V,function(){L.port2.postMessage(0)}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(et,yt,Q){(function(M){(function(){"use strict";var V=M.MutationObserver||M.WebKitMutationObserver;Q.test=function(){return V},Q.install=function(L){var C=0,E=new V(L),P=M.document.createTextNode("");return E.observe(P,{characterData:!0}),function(){P.data=C=++C%2}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(et,yt,Q){(function(M){(function(){"use strict";Q.test=function(){return"function"==typeof M.queueMicrotask},Q.install=function(V){return function(){M.queueMicrotask(V)}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(et,yt,Q){(function(M){(function(){"use strict";Q.test=function(){return"document"in M&&"onreadystatechange"in M.document.createElement("script")},Q.install=function(V){return function(){var L=M.document.createElement("script");return L.onreadystatechange=function(){V(),L.onreadystatechange=null,L.parentNode.removeChild(L),L=null},M.document.documentElement.appendChild(L),V}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(et,yt,Q){"use strict";Q.test=function(){return!0},Q.install=function(M){return function(){setTimeout(M,0)}}},{}],10:[function(et,yt,Q){yt.exports="function"==typeof Object.create?function(M,V){V&&(M.super_=V,M.prototype=Object.create(V.prototype,{constructor:{value:M,enumerable:!1,writable:!0,configurable:!0}}))}:function(M,V){if(V){M.super_=V;var L=function(){};L.prototype=V.prototype,M.prototype=new L,M.prototype.constructor=M}}},{}],11:[function(et,yt,Q){var M,V,L=yt.exports={};function C(){throw new Error("setTimeout has not been defined")}function E(){throw new Error("clearTimeout has not been defined")}function P(f){if(M===setTimeout)return setTimeout(f,0);if((M===C||!M)&&setTimeout)return M=setTimeout,setTimeout(f,0);try{return M(f,0)}catch(v){try{return M.call(null,f,0)}catch(k){return M.call(this,f,0)}}}!function(){try{M="function"==typeof setTimeout?setTimeout:C}catch(f){M=C}try{V="function"==typeof clearTimeout?clearTimeout:E}catch(f){V=E}}();var X,ct=[],H=!1,O=-1;function F(){H&&X&&(H=!1,X.length?ct=X.concat(ct):O=-1,ct.length&&g())}function g(){if(!H){var f=P(F);H=!0;for(var v=ct.length;v;){for(X=ct,ct=[];++O<v;)X&&X[O].run();O=-1,v=ct.length}X=null,H=!1,function(k){if(V===clearTimeout)return clearTimeout(k);if((V===E||!V)&&clearTimeout)return V=clearTimeout,clearTimeout(k);try{V(k)}catch(mt){try{return V.call(null,k)}catch(lt){return V.call(this,k)}}}(f)}}function a(f,v){this.fun=f,this.array=v}function u(){}L.nextTick=function(f){var v=new Array(arguments.length-1);if(arguments.length>1)for(var k=1;k<arguments.length;k++)v[k-1]=arguments[k];ct.push(new a(f,v)),1!==ct.length||H||P(g)},a.prototype.run=function(){this.fun.apply(null,this.array)},L.title="browser",L.browser=!0,L.env={},L.argv=[],L.version="",L.versions={},L.on=u,L.addListener=u,L.once=u,L.off=u,L.removeListener=u,L.removeAllListeners=u,L.emit=u,L.prependListener=u,L.prependOnceListener=u,L.listeners=function(f){return[]},L.binding=function(f){throw new Error("process.binding is not supported")},L.cwd=function(){return"/"},L.chdir=function(f){throw new Error("process.chdir is not supported")},L.umask=function(){return 0}},{}],12:[function(et,yt,Q){!function(M){if("object"==typeof Q)yt.exports=M();else{var V;try{V=window}catch(L){V=self}V.SparkMD5=M()}}(function(M){"use strict";var V=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function L(g,a){var u=g[0],f=g[1],v=g[2],k=g[3];f=((f+=((v=((v+=((k=((k+=((u=((u+=(f&v|~f&k)+a[0]-680876936|0)<<7|u>>>25)+f|0)&f|~u&v)+a[1]-389564586|0)<<12|k>>>20)+u|0)&u|~k&f)+a[2]+606105819|0)<<17|v>>>15)+k|0)&k|~v&u)+a[3]-1044525330|0)<<22|f>>>10)+v|0,f=((f+=((v=((v+=((k=((k+=((u=((u+=(f&v|~f&k)+a[4]-176418897|0)<<7|u>>>25)+f|0)&f|~u&v)+a[5]+1200080426|0)<<12|k>>>20)+u|0)&u|~k&f)+a[6]-1473231341|0)<<17|v>>>15)+k|0)&k|~v&u)+a[7]-45705983|0)<<22|f>>>10)+v|0,f=((f+=((v=((v+=((k=((k+=((u=((u+=(f&v|~f&k)+a[8]+1770035416|0)<<7|u>>>25)+f|0)&f|~u&v)+a[9]-1958414417|0)<<12|k>>>20)+u|0)&u|~k&f)+a[10]-42063|0)<<17|v>>>15)+k|0)&k|~v&u)+a[11]-1990404162|0)<<22|f>>>10)+v|0,f=((f+=((v=((v+=((k=((k+=((u=((u+=(f&v|~f&k)+a[12]+1804603682|0)<<7|u>>>25)+f|0)&f|~u&v)+a[13]-40341101|0)<<12|k>>>20)+u|0)&u|~k&f)+a[14]-1502002290|0)<<17|v>>>15)+k|0)&k|~v&u)+a[15]+1236535329|0)<<22|f>>>10)+v|0,f=((f+=((v=((v+=((k=((k+=((u=((u+=(f&k|v&~k)+a[1]-165796510|0)<<5|u>>>27)+f|0)&v|f&~v)+a[6]-1069501632|0)<<9|k>>>23)+u|0)&f|u&~f)+a[11]+643717713|0)<<14|v>>>18)+k|0)&u|k&~u)+a[0]-373897302|0)<<20|f>>>12)+v|0,f=((f+=((v=((v+=((k=((k+=((u=((u+=(f&k|v&~k)+a[5]-701558691|0)<<5|u>>>27)+f|0)&v|f&~v)+a[10]+38016083|0)<<9|k>>>23)+u|0)&f|u&~f)+a[15]-660478335|0)<<14|v>>>18)+k|0)&u|k&~u)+a[4]-405537848|0)<<20|f>>>12)+v|0,f=((f+=((v=((v+=((k=((k+=((u=((u+=(f&k|v&~k)+a[9]+568446438|0)<<5|u>>>27)+f|0)&v|f&~v)+a[14]-1019803690|0)<<9|k>>>23)+u|0)&f|u&~f)+a[3]-187363961|0)<<14|v>>>18)+k|0)&u|k&~u)+a[8]+1163531501|0)<<20|f>>>12)+v|0,f=((f+=((v=((v+=((k=((k+=((u=((u+=(f&k|v&~k)+a[13]-1444681467|0)<<5|u>>>27)+f|0)&v|f&~v)+a[2]-51403784|0)<<9|k>>>23)+u|0)&f|u&~f)+a[7]+1735328473|0)<<14|v>>>18)+k|0)&u|k&~u)+a[12]-1926607734|0)<<20|f>>>12)+v|0,f=((f+=((v=((v+=((k=((k+=((u=((u+=(f^v^k)+a[5]-378558|0)<<4|u>>>28)+f|0)^f^v)+a[8]-2022574463|0)<<11|k>>>21)+u|0)^u^f)+a[11]+1839030562|0)<<16|v>>>16)+k|0)^k^u)+a[14]-35309556|0)<<23|f>>>9)+v|0,f=((f+=((v=((v+=((k=((k+=((u=((u+=(f^v^k)+a[1]-1530992060|0)<<4|u>>>28)+f|0)^f^v)+a[4]+1272893353|0)<<11|k>>>21)+u|0)^u^f)+a[7]-155497632|0)<<16|v>>>16)+k|0)^k^u)+a[10]-1094730640|0)<<23|f>>>9)+v|0,f=((f+=((v=((v+=((k=((k+=((u=((u+=(f^v^k)+a[13]+681279174|0)<<4|u>>>28)+f|0)^f^v)+a[0]-358537222|0)<<11|k>>>21)+u|0)^u^f)+a[3]-722521979|0)<<16|v>>>16)+k|0)^k^u)+a[6]+76029189|0)<<23|f>>>9)+v|0,f=((f+=((v=((v+=((k=((k+=((u=((u+=(f^v^k)+a[9]-640364487|0)<<4|u>>>28)+f|0)^f^v)+a[12]-421815835|0)<<11|k>>>21)+u|0)^u^f)+a[15]+530742520|0)<<16|v>>>16)+k|0)^k^u)+a[2]-995338651|0)<<23|f>>>9)+v|0,f=((f+=((k=((k+=(f^((u=((u+=(v^(f|~k))+a[0]-198630844|0)<<6|u>>>26)+f|0)|~v))+a[7]+1126891415|0)<<10|k>>>22)+u|0)^((v=((v+=(u^(k|~f))+a[14]-1416354905|0)<<15|v>>>17)+k|0)|~u))+a[5]-57434055|0)<<21|f>>>11)+v|0,f=((f+=((k=((k+=(f^((u=((u+=(v^(f|~k))+a[12]+1700485571|0)<<6|u>>>26)+f|0)|~v))+a[3]-1894986606|0)<<10|k>>>22)+u|0)^((v=((v+=(u^(k|~f))+a[10]-1051523|0)<<15|v>>>17)+k|0)|~u))+a[1]-2054922799|0)<<21|f>>>11)+v|0,f=((f+=((k=((k+=(f^((u=((u+=(v^(f|~k))+a[8]+1873313359|0)<<6|u>>>26)+f|0)|~v))+a[15]-30611744|0)<<10|k>>>22)+u|0)^((v=((v+=(u^(k|~f))+a[6]-1560198380|0)<<15|v>>>17)+k|0)|~u))+a[13]+1309151649|0)<<21|f>>>11)+v|0,f=((f+=((k=((k+=(f^((u=((u+=(v^(f|~k))+a[4]-145523070|0)<<6|u>>>26)+f|0)|~v))+a[11]-1120210379|0)<<10|k>>>22)+u|0)^((v=((v+=(u^(k|~f))+a[2]+718787259|0)<<15|v>>>17)+k|0)|~u))+a[9]-343485551|0)<<21|f>>>11)+v|0,g[0]=u+g[0]|0,g[1]=f+g[1]|0,g[2]=v+g[2]|0,g[3]=k+g[3]|0}function C(g){var a,u=[];for(a=0;a<64;a+=4)u[a>>2]=g.charCodeAt(a)+(g.charCodeAt(a+1)<<8)+(g.charCodeAt(a+2)<<16)+(g.charCodeAt(a+3)<<24);return u}function E(g){var a,u=[];for(a=0;a<64;a+=4)u[a>>2]=g[a]+(g[a+1]<<8)+(g[a+2]<<16)+(g[a+3]<<24);return u}function P(g){var a,u,f,v,k,mt,lt=g.length,T=[1732584193,-271733879,-1732584194,271733878];for(a=64;a<=lt;a+=64)L(T,C(g.substring(a-64,a)));for(u=(g=g.substring(a-64)).length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<u;a+=1)f[a>>2]|=g.charCodeAt(a)<<(a%4<<3);if(f[a>>2]|=128<<(a%4<<3),a>55)for(L(T,f),a=0;a<16;a+=1)f[a]=0;return v=(v=8*lt).toString(16).match(/(.*?)(.{0,8})$/),k=parseInt(v[2],16),mt=parseInt(v[1],16)||0,f[14]=k,f[15]=mt,L(T,f),T}function X(g){var a,u="";for(a=0;a<4;a+=1)u+=V[g>>8*a+4&15]+V[g>>8*a&15];return u}function ct(g){var a;for(a=0;a<g.length;a+=1)g[a]=X(g[a]);return g.join("")}function H(g){return/[\u0080-\uFFFF]/.test(g)&&(g=unescape(encodeURIComponent(g))),g}function O(g){var a,u=[],f=g.length;for(a=0;a<f-1;a+=2)u.push(parseInt(g.substr(a,2),16));return String.fromCharCode.apply(String,u)}function F(){this.reset()}return ct(P("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function g(a,u){return(a=0|a||0)<0?Math.max(a+u,0):Math.min(a,u)}ArrayBuffer.prototype.slice=function(a,u){var f,v,k,mt,lt=this.byteLength,T=g(a,lt),W=lt;return u!==M&&(W=g(u,lt)),T>W?new ArrayBuffer(0):(f=W-T,v=new ArrayBuffer(f),k=new Uint8Array(v),mt=new Uint8Array(this,T,f),k.set(mt),v)}}(),F.prototype.append=function(g){return this.appendBinary(H(g)),this},F.prototype.appendBinary=function(g){this._buff+=g,this._length+=g.length;var a,u=this._buff.length;for(a=64;a<=u;a+=64)L(this._hash,C(this._buff.substring(a-64,a)));return this._buff=this._buff.substring(a-64),this},F.prototype.end=function(g){var a,u,f=this._buff,v=f.length,k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(a=0;a<v;a+=1)k[a>>2]|=f.charCodeAt(a)<<(a%4<<3);return this._finish(k,v),u=ct(this._hash),g&&(u=O(u)),this.reset(),u},F.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},F.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},F.prototype.setState=function(g){return this._buff=g.buff,this._length=g.length,this._hash=g.hash,this},F.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},F.prototype._finish=function(g,a){var u,f,v,k=a;if(g[k>>2]|=128<<(k%4<<3),k>55)for(L(this._hash,g),k=0;k<16;k+=1)g[k]=0;u=(u=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(u[2],16),v=parseInt(u[1],16)||0,g[14]=f,g[15]=v,L(this._hash,g)},F.hash=function(g,a){return F.hashBinary(H(g),a)},F.hashBinary=function(g,a){var u=ct(P(g));return a?O(u):u},(F.ArrayBuffer=function(){this.reset()}).prototype.append=function(g){var a,u,f,k,mt=(u=this._buff.buffer,f=g,(k=new Uint8Array(u.byteLength+f.byteLength)).set(new Uint8Array(u)),k.set(new Uint8Array(f),u.byteLength),k),lt=mt.length;for(this._length+=g.byteLength,a=64;a<=lt;a+=64)L(this._hash,E(mt.subarray(a-64,a)));return this._buff=a-64<lt?new Uint8Array(mt.buffer.slice(a-64)):new Uint8Array(0),this},F.ArrayBuffer.prototype.end=function(g){var a,u,f=this._buff,v=f.length,k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(a=0;a<v;a+=1)k[a>>2]|=f[a]<<(a%4<<3);return this._finish(k,v),u=ct(this._hash),g&&(u=O(u)),this.reset(),u},F.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},F.ArrayBuffer.prototype.getState=function(){var a=F.prototype.getState.call(this);return a.buff=String.fromCharCode.apply(null,new Uint8Array(a.buff)),a},F.ArrayBuffer.prototype.setState=function(g){return g.buff=function(a,u){var f,v=a.length,k=new ArrayBuffer(v),mt=new Uint8Array(k);for(f=0;f<v;f+=1)mt[f]=a.charCodeAt(f);return mt}(g.buff),F.prototype.setState.call(this,g)},F.ArrayBuffer.prototype.destroy=F.prototype.destroy,F.ArrayBuffer.prototype._finish=F.prototype._finish,F.ArrayBuffer.hash=function(g,a){var u=ct(function(f){var v,k,mt,lt,T,W,Y=f.length,at=[1732584193,-271733879,-1732584194,271733878];for(v=64;v<=Y;v+=64)L(at,E(f.subarray(v-64,v)));for(k=(f=v-64<Y?f.subarray(v-64):new Uint8Array(0)).length,mt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],v=0;v<k;v+=1)mt[v>>2]|=f[v]<<(v%4<<3);if(mt[v>>2]|=128<<(v%4<<3),v>55)for(L(at,mt),v=0;v<16;v+=1)mt[v]=0;return lt=(lt=8*Y).toString(16).match(/(.*?)(.{0,8})$/),T=parseInt(lt[2],16),W=parseInt(lt[1],16)||0,mt[14]=T,mt[15]=W,L(at,mt),at}(new Uint8Array(g)));return a?O(u):u},F})},{}],13:[function(et,yt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Object.defineProperty(Q,"v1",{enumerable:!0,get:function(){return M.default}}),Object.defineProperty(Q,"v3",{enumerable:!0,get:function(){return V.default}}),Object.defineProperty(Q,"v4",{enumerable:!0,get:function(){return L.default}}),Object.defineProperty(Q,"v5",{enumerable:!0,get:function(){return C.default}}),Object.defineProperty(Q,"NIL",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(Q,"version",{enumerable:!0,get:function(){return P.default}}),Object.defineProperty(Q,"validate",{enumerable:!0,get:function(){return X.default}}),Object.defineProperty(Q,"stringify",{enumerable:!0,get:function(){return ct.default}}),Object.defineProperty(Q,"parse",{enumerable:!0,get:function(){return H.default}});var M=O(et(21)),V=O(et(22)),L=O(et(24)),C=O(et(25)),E=O(et(15)),P=O(et(27)),X=O(et(26)),ct=O(et(20)),H=O(et(16));function O(F){return F&&F.__esModule?F:{default:F}}},{15:15,16:16,20:20,21:21,22:22,24:24,25:25,26:26,27:27}],14:[function(et,yt,Q){"use strict";function M(H){return 14+(H+64>>>9<<4)+1}function V(H,O){const F=(65535&H)+(65535&O);return(H>>16)+(O>>16)+(F>>16)<<16|65535&F}function L(H,O,F,g,a,u){return V((f=V(V(O,H),V(g,u)))<<(v=a)|f>>>32-v,F);var f,v}function C(H,O,F,g,a,u,f){return L(O&F|~O&g,H,O,a,u,f)}function E(H,O,F,g,a,u,f){return L(O&g|F&~g,H,O,a,u,f)}function P(H,O,F,g,a,u,f){return L(O^F^g,H,O,a,u,f)}function X(H,O,F,g,a,u,f){return L(F^(O|~g),H,O,a,u,f)}Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=void 0,Q.default=function(H){if("string"==typeof H){const O=unescape(encodeURIComponent(H));H=new Uint8Array(O.length);for(let F=0;F<O.length;++F)H[F]=O.charCodeAt(F)}return function(O){const F=[],g=32*O.length;for(let a=0;a<g;a+=8){const u=O[a>>5]>>>a%32&255,f=parseInt("0123456789abcdef".charAt(u>>>4&15)+"0123456789abcdef".charAt(15&u),16);F.push(f)}return F}(function(O,F){O[F>>5]|=128<<F%32,O[M(F)-1]=F;let g=1732584193,a=-271733879,u=-1732584194,f=271733878;for(let v=0;v<O.length;v+=16){const k=g,mt=a,lt=u,T=f;g=C(g,a,u,f,O[v],7,-680876936),f=C(f,g,a,u,O[v+1],12,-389564586),u=C(u,f,g,a,O[v+2],17,606105819),a=C(a,u,f,g,O[v+3],22,-1044525330),g=C(g,a,u,f,O[v+4],7,-176418897),f=C(f,g,a,u,O[v+5],12,1200080426),u=C(u,f,g,a,O[v+6],17,-1473231341),a=C(a,u,f,g,O[v+7],22,-45705983),g=C(g,a,u,f,O[v+8],7,1770035416),f=C(f,g,a,u,O[v+9],12,-1958414417),u=C(u,f,g,a,O[v+10],17,-42063),a=C(a,u,f,g,O[v+11],22,-1990404162),g=C(g,a,u,f,O[v+12],7,1804603682),f=C(f,g,a,u,O[v+13],12,-40341101),u=C(u,f,g,a,O[v+14],17,-1502002290),a=C(a,u,f,g,O[v+15],22,1236535329),g=E(g,a,u,f,O[v+1],5,-165796510),f=E(f,g,a,u,O[v+6],9,-1069501632),u=E(u,f,g,a,O[v+11],14,643717713),a=E(a,u,f,g,O[v],20,-373897302),g=E(g,a,u,f,O[v+5],5,-701558691),f=E(f,g,a,u,O[v+10],9,38016083),u=E(u,f,g,a,O[v+15],14,-660478335),a=E(a,u,f,g,O[v+4],20,-405537848),g=E(g,a,u,f,O[v+9],5,568446438),f=E(f,g,a,u,O[v+14],9,-1019803690),u=E(u,f,g,a,O[v+3],14,-187363961),a=E(a,u,f,g,O[v+8],20,1163531501),g=E(g,a,u,f,O[v+13],5,-1444681467),f=E(f,g,a,u,O[v+2],9,-51403784),u=E(u,f,g,a,O[v+7],14,1735328473),a=E(a,u,f,g,O[v+12],20,-1926607734),g=P(g,a,u,f,O[v+5],4,-378558),f=P(f,g,a,u,O[v+8],11,-2022574463),u=P(u,f,g,a,O[v+11],16,1839030562),a=P(a,u,f,g,O[v+14],23,-35309556),g=P(g,a,u,f,O[v+1],4,-1530992060),f=P(f,g,a,u,O[v+4],11,1272893353),u=P(u,f,g,a,O[v+7],16,-155497632),a=P(a,u,f,g,O[v+10],23,-1094730640),g=P(g,a,u,f,O[v+13],4,681279174),f=P(f,g,a,u,O[v],11,-358537222),u=P(u,f,g,a,O[v+3],16,-722521979),a=P(a,u,f,g,O[v+6],23,76029189),g=P(g,a,u,f,O[v+9],4,-640364487),f=P(f,g,a,u,O[v+12],11,-421815835),u=P(u,f,g,a,O[v+15],16,530742520),a=P(a,u,f,g,O[v+2],23,-995338651),g=X(g,a,u,f,O[v],6,-198630844),f=X(f,g,a,u,O[v+7],10,1126891415),u=X(u,f,g,a,O[v+14],15,-1416354905),a=X(a,u,f,g,O[v+5],21,-57434055),g=X(g,a,u,f,O[v+12],6,1700485571),f=X(f,g,a,u,O[v+3],10,-1894986606),u=X(u,f,g,a,O[v+10],15,-1051523),a=X(a,u,f,g,O[v+1],21,-2054922799),g=X(g,a,u,f,O[v+8],6,1873313359),f=X(f,g,a,u,O[v+15],10,-30611744),u=X(u,f,g,a,O[v+6],15,-1560198380),a=X(a,u,f,g,O[v+13],21,1309151649),g=X(g,a,u,f,O[v+4],6,-145523070),f=X(f,g,a,u,O[v+11],10,-1120210379),u=X(u,f,g,a,O[v+2],15,718787259),a=X(a,u,f,g,O[v+9],21,-343485551),g=V(g,k),a=V(a,mt),u=V(u,lt),f=V(f,T)}return[g,a,u,f]}(function(O){if(0===O.length)return[];const F=8*O.length,g=new Uint32Array(M(F));for(let a=0;a<F;a+=8)g[a>>5]|=(255&O[a/8])<<a%32;return g}(H),8*H.length))}},{}],15:[function(et,yt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=void 0,Q.default="00000000-0000-0000-0000-000000000000"},{}],16:[function(et,yt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=void 0;var M,V=(M=et(26))&&M.__esModule?M:{default:M};Q.default=function(C){if(!(0,V.default)(C))throw TypeError("Invalid UUID");let E;const P=new Uint8Array(16);return P[0]=(E=parseInt(C.slice(0,8),16))>>>24,P[1]=E>>>16&255,P[2]=E>>>8&255,P[3]=255&E,P[4]=(E=parseInt(C.slice(9,13),16))>>>8,P[5]=255&E,P[6]=(E=parseInt(C.slice(14,18),16))>>>8,P[7]=255&E,P[8]=(E=parseInt(C.slice(19,23),16))>>>8,P[9]=255&E,P[10]=(E=parseInt(C.slice(24,36),16))/1099511627776&255,P[11]=E/4294967296&255,P[12]=E>>>24&255,P[13]=E>>>16&255,P[14]=E>>>8&255,P[15]=255&E,P}},{26:26}],17:[function(et,yt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=void 0,Q.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},{}],18:[function(et,yt,Q){"use strict";let M;Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=function(){if(!M&&(M="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),!M))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return M(V)};const V=new Uint8Array(16)},{}],19:[function(et,yt,Q){"use strict";function M(C,E,P,X){switch(C){case 0:return E&P^~E&X;case 1:case 3:return E^P^X;case 2:return E&P^E&X^P&X}}function V(C,E){return C<<E|C>>>32-E}Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=void 0,Q.default=function(C){const E=[1518500249,1859775393,2400959708,3395469782],P=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof C){const O=unescape(encodeURIComponent(C));C=[];for(let F=0;F<O.length;++F)C.push(O.charCodeAt(F))}else Array.isArray(C)||(C=Array.prototype.slice.call(C));C.push(128);const ct=Math.ceil((C.length/4+2)/16),H=new Array(ct);for(let O=0;O<ct;++O){const F=new Uint32Array(16);for(let g=0;g<16;++g)F[g]=C[64*O+4*g]<<24|C[64*O+4*g+1]<<16|C[64*O+4*g+2]<<8|C[64*O+4*g+3];H[O]=F}H[ct-1][14]=8*(C.length-1)/Math.pow(2,32),H[ct-1][14]=Math.floor(H[ct-1][14]),H[ct-1][15]=8*(C.length-1)&4294967295;for(let O=0;O<ct;++O){const F=new Uint32Array(80);for(let k=0;k<16;++k)F[k]=H[O][k];for(let k=16;k<80;++k)F[k]=V(F[k-3]^F[k-8]^F[k-14]^F[k-16],1);let g=P[0],a=P[1],u=P[2],f=P[3],v=P[4];for(let k=0;k<80;++k){const mt=Math.floor(k/20),lt=V(g,5)+M(mt,a,u,f)+v+E[mt]+F[k]>>>0;v=f,f=u,u=V(a,30)>>>0,a=g,g=lt}P[0]=P[0]+g>>>0,P[1]=P[1]+a>>>0,P[2]=P[2]+u>>>0,P[3]=P[3]+f>>>0,P[4]=P[4]+v>>>0}return[P[0]>>24&255,P[0]>>16&255,P[0]>>8&255,255&P[0],P[1]>>24&255,P[1]>>16&255,P[1]>>8&255,255&P[1],P[2]>>24&255,P[2]>>16&255,P[2]>>8&255,255&P[2],P[3]>>24&255,P[3]>>16&255,P[3]>>8&255,255&P[3],P[4]>>24&255,P[4]>>16&255,P[4]>>8&255,255&P[4]]}},{}],20:[function(et,yt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=void 0;var M,V=(M=et(26))&&M.__esModule?M:{default:M};const L=[];for(let E=0;E<256;++E)L.push((E+256).toString(16).substr(1));Q.default=function(E,P=0){const X=(L[E[P+0]]+L[E[P+1]]+L[E[P+2]]+L[E[P+3]]+"-"+L[E[P+4]]+L[E[P+5]]+"-"+L[E[P+6]]+L[E[P+7]]+"-"+L[E[P+8]]+L[E[P+9]]+"-"+L[E[P+10]]+L[E[P+11]]+L[E[P+12]]+L[E[P+13]]+L[E[P+14]]+L[E[P+15]]).toLowerCase();if(!(0,V.default)(X))throw TypeError("Stringified UUID is invalid");return X}},{26:26}],21:[function(et,yt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=void 0;var M=L(et(18)),V=L(et(20));function L(H){return H&&H.__esModule?H:{default:H}}let C,E,P=0,X=0;Q.default=function(H,O,F){let g=O&&F||0;const a=O||new Array(16);let u=(H=H||{}).node||C,f=void 0!==H.clockseq?H.clockseq:E;if(null==u||null==f){const W=H.random||(H.rng||M.default)();null==u&&(u=C=[1|W[0],W[1],W[2],W[3],W[4],W[5]]),null==f&&(f=E=16383&(W[6]<<8|W[7]))}let v=void 0!==H.msecs?H.msecs:Date.now(),k=void 0!==H.nsecs?H.nsecs:X+1;const mt=v-P+(k-X)/1e4;if(mt<0&&void 0===H.clockseq&&(f=f+1&16383),(mt<0||v>P)&&void 0===H.nsecs&&(k=0),k>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");P=v,X=k,E=f,v+=122192928e5;const lt=(1e4*(268435455&v)+k)%4294967296;a[g++]=lt>>>24&255,a[g++]=lt>>>16&255,a[g++]=lt>>>8&255,a[g++]=255&lt;const T=v/4294967296*1e4&268435455;a[g++]=T>>>8&255,a[g++]=255&T,a[g++]=T>>>24&15|16,a[g++]=T>>>16&255,a[g++]=f>>>8|128,a[g++]=255&f;for(let W=0;W<6;++W)a[g+W]=u[W];return O||(0,V.default)(a)}},{18:18,20:20}],22:[function(et,yt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=void 0;var M=L(et(23)),V=L(et(14));function L(E){return E&&E.__esModule?E:{default:E}}var C=(0,M.default)("v3",48,V.default);Q.default=C},{14:14,23:23}],23:[function(et,yt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=function(P,X,ct){function H(O,F,g,a){if("string"==typeof O&&(O=function(f){f=unescape(encodeURIComponent(f));const v=[];for(let k=0;k<f.length;++k)v.push(f.charCodeAt(k));return v}(O)),"string"==typeof F&&(F=(0,V.default)(F)),16!==F.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+O.length);if(u.set(F),u.set(O,F.length),u=ct(u),u[6]=15&u[6]|X,u[8]=63&u[8]|128,g){a=a||0;for(let f=0;f<16;++f)g[a+f]=u[f];return g}return(0,M.default)(u)}try{H.name=P}catch(O){}return H.DNS=C,H.URL=E,H},Q.URL=Q.DNS=void 0;var M=L(et(20)),V=L(et(16));function L(P){return P&&P.__esModule?P:{default:P}}const C="6ba7b810-9dad-11d1-80b4-00c04fd430c8";Q.DNS=C;const E="6ba7b811-9dad-11d1-80b4-00c04fd430c8";Q.URL=E},{16:16,20:20}],24:[function(et,yt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=void 0;var M=L(et(18)),V=L(et(20));function L(E){return E&&E.__esModule?E:{default:E}}Q.default=function(E,P,X){const ct=(E=E||{}).random||(E.rng||M.default)();if(ct[6]=15&ct[6]|64,ct[8]=63&ct[8]|128,P){X=X||0;for(let H=0;H<16;++H)P[X+H]=ct[H];return P}return(0,V.default)(ct)}},{18:18,20:20}],25:[function(et,yt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=void 0;var M=L(et(23)),V=L(et(19));function L(E){return E&&E.__esModule?E:{default:E}}var C=(0,M.default)("v5",80,V.default);Q.default=C},{19:19,23:23}],26:[function(et,yt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=void 0;var M,V=(M=et(17))&&M.__esModule?M:{default:M};Q.default=function(C){return"string"==typeof C&&V.default.test(C)}},{17:17}],27:[function(et,yt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=void 0;var M,V=(M=et(26))&&M.__esModule?M:{default:M};Q.default=function(C){if(!(0,V.default)(C))throw TypeError("Invalid UUID");return parseInt(C.substr(14,1),16)}},{26:26}],28:[function(et,yt,Q){"use strict";function M(V,L,C){var E=C[C.length-1];V===E.element&&(C.pop(),E=C[C.length-1]);var P=E.element,X=E.index;Array.isArray(P)?P.push(V):X===L.length-2?P[L.pop()]=V:L.push(V)}Q.stringify=function(V){var L=[];L.push({obj:V});for(var C,E,P,X,H,O,F,g,a,u="";C=L.pop();)if(E=C.obj,u+=C.prefix||"",P=C.val||"")u+=P;else if("object"!=typeof E)u+=void 0===E?null:JSON.stringify(E);else if(null===E)u+="null";else if(Array.isArray(E)){for(L.push({val:"]"}),X=E.length-1;X>=0;X--)L.push({obj:E[X],prefix:0===X?"":","});L.push({val:"["})}else{for(O in H=[],E)E.hasOwnProperty(O)&&H.push(O);for(L.push({val:"}"}),X=H.length-1;X>=0;X--)g=E[F=H[X]],a=X>0?",":"",a+=JSON.stringify(F)+":",L.push({obj:g,prefix:a});L.push({val:"{"})}return u},Q.parse=function(V){for(var L,C,E,P,X,ct,H,O,F,g=[],a=[],u=0;;)if("}"!==(L=V[u++])&&"]"!==L&&void 0!==L)switch(L){case" ":case"\t":case"\n":case":":case",":break;case"n":u+=3,M(null,g,a);break;case"t":u+=3,M(!0,g,a);break;case"f":u+=4,M(!1,g,a);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(C="",u--;;){if(E=V[u++],!/[\d\.\-e\+]/.test(E)){u--;break}C+=E}M(parseFloat(C),g,a);break;case'"':for(P="",X=void 0,ct=0;'"'!==(H=V[u++])||"\\"===X&&ct%2==1;)P+=H,"\\"===(X=H)?ct++:ct=0;M(JSON.parse('"'+P+'"'),g,a);break;case"[":g.push((O={element:[],index:g.length}).element),a.push(O);break;case"{":g.push((F={element:{},index:g.length}).element),a.push(F);break;default:throw new Error("unexpectedly reached end of input: "+L)}else{if(1===g.length)return g.pop();M(g.pop(),g,a)}}},{}],29:[function(et,yt,Q){(function(M){(function(){"use strict";function V(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var L,C,E=V(et(4)),P=et(13),X=V(et(12)),ct=V(et(28)),H=V(et(1)),O=V(et(10)),F=V(et(3));function g(t){return"$"+t}function a(t){return t.substring(1)}function u(){this._store={}}function f(t){if(this._store=new u,t&&Array.isArray(t))for(var e=0,n=t.length;e<n;e++)this.add(t[e])}u.prototype.get=function(t){var e=g(t);return this._store[e]},u.prototype.set=function(t,e){var n=g(t);return this._store[n]=e,!0},u.prototype.has=function(t){return g(t)in this._store},u.prototype.keys=function(){return Object.keys(this._store).map(t=>a(t))},u.prototype.delete=function(t){var e=g(t),n=e in this._store;return delete this._store[e],n},u.prototype.forEach=function(t){for(var e=Object.keys(this._store),n=0,r=e.length;n<r;n++){var o=e[n];t(this._store[o],o=a(o))}},Object.defineProperty(u.prototype,"size",{get:function(){return Object.keys(this._store).length}}),f.prototype.add=function(t){return this._store.set(t,!0)},f.prototype.has=function(t){return this._store.has(t)},f.prototype.forEach=function(t){this._store.forEach(function(e,n){t(n)})},Object.defineProperty(f.prototype,"size",{get:function(){return this._store.size}}),function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var t=Object.getOwnPropertyDescriptor(Map,Symbol.species);return t&&"get"in t&&Map[Symbol.species]===Map}()?(L=Set,C=Map):(L=f,C=u);var dt,k=Function.prototype.toString,mt=k.call(Object);function lt(t){var e,n,r,i;if(!t||"object"!=typeof t)return t;if(Array.isArray(t)){for(e=[],n=0,r=t.length;n<r;n++)e[n]=lt(t[n]);return e}if(t instanceof Date&&isFinite(t))return t.toISOString();if(i=t,"undefined"!=typeof ArrayBuffer&&i instanceof ArrayBuffer||"undefined"!=typeof Blob&&i instanceof Blob)return function v(t){if(t instanceof ArrayBuffer)return function(r){if("function"==typeof r.slice)return r.slice(0);var o=new ArrayBuffer(r.byteLength),i=new Uint8Array(o),d=new Uint8Array(r);return i.set(d),o}(t);var e=t.size,n=t.type;return"function"==typeof t.slice?t.slice(0,e,n):t.webkitSlice(0,e,n)}(t);if(!function(i){var d=Object.getPrototypeOf(i);if(null===d)return!0;var c=d.constructor;return"function"==typeof c&&c instanceof c&&k.call(c)==mt}(t))return t;for(n in e={},t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=lt(t[n]);void 0!==o&&(e[n]=o)}return e}function T(t){var e=!1;return H(function(n){if(e)throw new Error("once called more than once");e=!0,t.apply(this,n)})}function W(t){return H(function(e){e=lt(e);var n=this,r="function"==typeof e[e.length-1]&&e.pop(),o=new Promise(function(i,d){var c;try{var l=T(function(p,y){p?d(p):i(y)});e.push(l),(c=t.apply(n,e))&&"function"==typeof c.then&&i(c)}catch(p){d(p)}});return r&&o.then(function(i){r(null,i)},r),o})}function Y(t,e){return W(H(function(n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return function(o,i,d){if(o.constructor.listeners("debug").length){for(var c=["api",o.name,i],l=0;l<d.length-1;l++)c.push(d[l]);o.constructor.emit("debug",c);var p=d[d.length-1];d[d.length-1]=function(y,s){var h=["api",o.name,i];h=h.concat(y?["error",y]:["success",s]),o.constructor.emit("debug",h),p(y,s)}}}(r,t,n),this.taskqueue.isReady?e.apply(this,n):new Promise(function(o,i){r.taskqueue.addTask(function(d){d?i(d):o(r[t].apply(r,n))})})}))}function at(t,e){for(var n={},r=0,o=e.length;r<o;r++){var i=e[r];i in t&&(n[i]=t[i])}return n}function ht(t){return t}function gt(t){return[{ok:t}]}function wt(t,e,n){var r=e.docs,o=new C;r.forEach(function(h){o.has(h.id)?o.get(h.id).push(h):o.set(h.id,[h])});var i=o.size,d=0,c=new Array(i),p=[];o.forEach(function(h,q){p.push(q)});var y=0;!function s(){if(!(y>=p.length)){var h=Math.min(y+6,p.length),q=p.slice(y,h);R=y,q.forEach(function(J,x){var A=R+x,S=o.get(J),_=at(S[0],["atts_since","attachments"]);_.open_revs=S.map(function(b){return b.rev}),_.open_revs=_.open_revs.filter(ht);var j=ht;0===_.open_revs.length&&(delete _.open_revs,j=gt),["revs","attachments","binary","ajax","latest"].forEach(function(b){b in e&&(_[b]=e[b])}),t.get(J,_,function(b,w){var z;z=b?[{error:b}]:j(w),c[A]={id:J,docs:z},function l(){var h;++d===i&&(h=[],c.forEach(function(q){q.docs.forEach(function(m){h.push({id:q.id,docs:[m]})})}),n(null,{results:h}))}(),s()})}),y+=q.length}var R}()}try{localStorage.setItem("_pouch_check_localstorage",1),dt=!!localStorage.getItem("_pouch_check_localstorage")}catch(t){dt=!1}function It(){return dt}function Pt(){var t;F.call(this),this._listeners={},t=this,It()&&addEventListener("storage",function(e){t.emit(e.key)})}function Ct(t){if("undefined"!=typeof console&&"function"==typeof console[t]){var e=Array.prototype.slice.call(arguments,1);console[t].apply(console,e)}}function Ae(t){var n,r,e=0;return t||(e=2e3),n=t,r=e,n=parseInt(n,10)||0,(r=parseInt(r,10))!=r||r<=n?r=(n||1)<<1:r+=1,r>6e5&&(n=3e5,r=6e5),~~((r-n)*Math.random()+n)}function Se(t,e){Ct("info","The above "+t+" is totally normal. "+e)}O(Pt,F),Pt.prototype.addListener=function(t,e,n,r){if(!this._listeners[e]){var o=this,i=!1;this._listeners[e]=d,this.on(t,d)}function d(){if(o._listeners[e])if(i)i="waiting";else{i=!0;var c=at(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);n.changes(c).on("change",function(l){l.seq>r.since&&!r.cancelled&&(r.since=l.seq,r.onChange(l))}).on("complete",function(){"waiting"===i&&E(d),i=!1}).on("error",function(){i=!1})}}},Pt.prototype.removeListener=function(t,e){e in this._listeners&&(F.prototype.removeListener.call(this,t,this._listeners[e]),delete this._listeners[e])},Pt.prototype.notifyLocalWindows=function(t){It()&&(localStorage[t]="a"===localStorage[t]?"b":"a")},Pt.prototype.notify=function(t){this.emit(t),this.notifyLocalWindows(t)};var Vt="function"==typeof Object.assign?Object.assign:function(t){for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e};function jt(t,e,n){Error.call(this,n),this.status=t,this.name=e,this.message=n,this.error=!0}O(jt,Error),jt.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})},new jt(401,"unauthorized","Name or password is incorrect.");var ar=new jt(400,"bad_request","Missing JSON list of 'docs'"),Rt=new jt(404,"not_found","missing"),ee=new jt(409,"conflict","Document update conflict"),cn=new jt(400,"bad_request","_id field must contain a string"),ur=new jt(412,"missing_id","_id is required for puts"),cr=new jt(400,"bad_request","Only reserved document ids may start with underscore."),fn=(new jt(412,"precondition_failed","Database not open"),new jt(500,"unknown_error","Database encountered an unknown error")),ln=new jt(500,"badarg","Some query argument is invalid"),fr=(new jt(400,"invalid_request","Request was invalid"),new jt(400,"query_parse_error","Some query parameter is invalid")),dn=new jt(500,"doc_validation","Bad special document member"),pe=new jt(400,"bad_request","Something wrong with the request"),xe=new jt(400,"bad_request","Document must be a JSON object"),Ee=(new jt(404,"not_found","Database not found"),new jt(500,"indexed_db_went_bad","unknown")),hn=(new jt(500,"web_sql_went_bad","unknown"),new jt(500,"levelDB_went_went_bad","unknown"),new jt(403,"forbidden","Forbidden by design doc validate_doc_update function"),new jt(400,"bad_request","Invalid rev format")),lr=(new jt(412,"file_exists","The database could not be created, the file already exists."),new jt(412,"missing_stub","A pre-existing attachment stub wasn't found"));function _t(t,e){function n(r){for(var o=Object.getOwnPropertyNames(t),i=0,d=o.length;i<d;i++)"function"!=typeof t[o[i]]&&(this[o[i]]=t[o[i]]);void 0===this.stack&&(this.stack=(new Error).stack),void 0!==r&&(this.reason=r)}return n.prototype=jt.prototype,new n(e)}function ne(t){if("object"!=typeof t){var e=t;(t=fn).data=e}return"error"in t&&"conflict"===t.error&&(t.name="conflict",t.status=409),"name"in t||(t.name=t.error||"unknown"),"status"in t||(t.status=500),"message"in t||(t.message=t.message||t.reason),"stack"in t||(t.stack=(new Error).stack),t}function Pe(t){var e={},n=t.filter&&"function"==typeof t.filter;return e.query=t.query_params,function(r){r.doc||(r.doc={});var o=n&&function(d,c,l){try{return!d(c,l)}catch(y){var p="Filter function threw: "+y.toString();return _t(pe,p)}}(t.filter,r.doc,e);if("object"==typeof o)return o;if(o)return!1;if(t.include_docs){if(!t.attachments)for(var i in r.doc._attachments)Object.prototype.hasOwnProperty.call(r.doc._attachments,i)&&(r.doc._attachments[i].stub=!0)}else delete r.doc;return!0}}function ve(t){for(var e=[],n=0,r=t.length;n<r;n++)e=e.concat(t[n]);return e}function pn(t){var e;if(t?"string"!=typeof t?e=_t(cn):/^_/.test(t)&&!/^_(design|local)/.test(t)&&(e=_t(cr)):e=_t(ur),e)throw e}function Ft(t){return"boolean"==typeof t._remote?t._remote:"function"==typeof t.type&&(Ct("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===t.type())}function Ce(t){if(!t)return null;var e=t.split("/");return 2===e.length?e:1===e.length?[t,t]:null}function vn(t){var e=Ce(t);return e?e.join("/"):null}new jt(413,"invalid_url","Provided URL is invalid");var yn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],dr=/(?:^|&)([^&=]*)=?([^&]*)/g,hr=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function gn(t){for(var e=hr.exec(t),n={},r=14;r--;){var o=yn[r],i=e[r]||"",d=-1!==["user","password"].indexOf(o);n[o]=d?decodeURIComponent(i):i}return n.queryKey={},n[yn[12]].replace(dr,function(c,l,p){l&&(n.queryKey[l]=p)}),n}function Le(t,e){var n=[],r=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n.push(o),r.push(e[o]));return n.push(t),Function.apply(null,n).apply(null,r)}function ye(t,e,n){return t.get(e).catch(function(r){if(404!==r.status)throw r;return{}}).then(function(r){var d,c,l,o=r._rev,i=n(r);return i?(i._id=e,i._rev=o,l=n,(d=t).put(c=i).then(function(p){return{updated:!0,rev:p.rev}},function(p){if(409!==p.status)throw p;return ye(d,c._id,l)})):{updated:!1,rev:o}})}var $e=function(t){return atob(t)},se=function(t){return btoa(t)};function De(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(o){if("TypeError"!==o.name)throw o;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<t.length;r+=1)n.append(t[r]);return n.getBlob(e.type)}}function pr(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),o=0;o<e;o++)r[o]=t.charCodeAt(o);return n}function Ie(t,e){return De([pr(t)],{type:e})}function Be(t,e){return Ie($e(t),e)}function _n(t,e){var n=new FileReader,r="function"==typeof n.readAsBinaryString;n.onloadend=function(o){var i=o.target.result||"";if(r)return e(i);e(function(d){for(var c="",l=new Uint8Array(d),p=l.byteLength,y=0;y<p;y++)c+=String.fromCharCode(l[y]);return c}(i))},r?n.readAsBinaryString(t):n.readAsArrayBuffer(t)}function mn(t,e){_n(t,function(n){e(n)})}function Te(t,e){mn(t,function(n){e(se(n))})}var vr=self.setImmediate||self.setTimeout;function yr(t,e,n,r,o){var i,d,c;(n>0||r<e.size)&&(d=n,c=r,e=(i=e).webkitSlice?i.webkitSlice(d,c):i.slice(d,c)),function(i,d){var c=new FileReader;c.onloadend=function(l){!function(i){t.append(i),o()}(l.target.result||new ArrayBuffer(0))},c.readAsArrayBuffer(i)}(e)}function gr(t,e,n,r,o){(n>0||r<e.length)&&(e=e.substring(n,r)),t.appendBinary(e),o()}function Me(t,e){var n="string"==typeof t,r=n?t.length:t.size,o=Math.min(32768,r),i=Math.ceil(r/o),d=0,c=n?new X:new X.ArrayBuffer,l=n?gr:yr;function p(){vr(s)}function y(){var q,h=(q=c.end(!0),se(q));e(h),c.destroy()}function s(){var h=d*o;d++,l(c,t,h,h+o,d<i?p:y)}s()}function bn(t){return X.hash(t)}function wn(t,e){if(!e)return P.v4().replace(/-/g,"").toLowerCase();var n=Vt({},t);return delete n._rev_tree,bn(JSON.stringify(n))}var ge=P.v4;function Gt(t){for(var e,n,r,o,i=t.rev_tree.slice();o=i.pop();){var d=o.ids,c=d[2],l=o.pos;if(c.length)for(var p=0,y=c.length;p<y;p++)i.push({pos:l+1,ids:c[p]});else{var s=!!d[1].deleted,h=d[0];e&&!(r!==s?r:n!==l?n<l:e<h)||(e=h,n=l,r=s)}}return n+"-"+e}function Qt(t,e){for(var n,r=t.slice();n=r.pop();)for(var o=n.pos,i=n.ids,d=i[2],c=e(0===d.length,o,i[0],n.ctx,i[1]),l=0,p=d.length;l<p;l++)r.push({pos:o+1,ids:d[l],ctx:c})}function _r(t,e){return t.pos-e.pos}function Re(t){var e=[];Qt(t,function(o,i,d,c,l){o&&e.push({rev:i+"-"+d,pos:i,opts:l})}),e.sort(_r).reverse();for(var n=0,r=e.length;n<r;n++)delete e[n].pos;return e}function Ne(t){for(var e=Gt(t),n=Re(t.rev_tree),r=[],o=0,i=n.length;o<i;o++){var d=n[o];d.rev===e||d.opts.deleted||r.push(d.rev)}return r}function kn(t){for(var e,n=[],r=t.slice();e=r.pop();){var o=e.pos,i=e.ids,d=i[0],c=i[1],l=i[2],p=0===l.length,y=e.history?e.history.slice():[];y.push({id:d,opts:c}),p&&n.push({pos:o+1-y.length,ids:y});for(var s=0,h=l.length;s<h;s++)r.push({pos:o+1,ids:l[s],history:y})}return n.reverse()}function mr(t,e){return t.pos-e.pos}function br(t,e,n){var r=function(o,i,d){for(var c,l=0,p=o.length;l<p;)d(o[c=l+p>>>1],i)<0?l=c+1:p=c;return l}(t,e,n);t.splice(r,0,e)}function jn(t,e){for(var n,r,o=e,i=t.length;o<i;o++){var d=t[o],c=[d.id,d.opts,[]];r?(r[2].push(c),r=c):n=r=c}return n}function wr(t,e){return t[0]<e[0]?-1:1}function On(t,e){for(var n=[{tree1:t,tree2:e}],r=!1;n.length>0;){var o=n.pop(),i=o.tree1,d=o.tree2;(i[1].status||d[1].status)&&(i[1].status="available"===i[1].status||"available"===d[1].status?"available":"missing");for(var c=0;c<d[2].length;c++)if(i[2][0]){for(var l=!1,p=0;p<i[2].length;p++)i[2][p][0]===d[2][c][0]&&(n.push({tree1:i[2][p],tree2:d[2][c]}),l=!0);l||(r="new_branch",br(i[2],d[2][c],wr))}else r="new_leaf",i[2][0]=d[2][c]}return{conflicts:r,tree:t}}function qn(t,e,n){var r,o=[],i=!1,d=!1;if(!t.length)return{tree:[e],conflicts:"new_leaf"};for(var c=0,l=t.length;c<l;c++){var p=t[c];if(p.pos===e.pos&&p.ids[0]===e.ids[0])r=On(p.ids,e.ids),o.push({pos:p.pos,ids:r.tree}),i=i||r.conflicts,d=!0;else if(!0!==n){var y=p.pos<e.pos?p:e,s=p.pos<e.pos?e:p,q=[],m=[];for(m.push({ids:y.ids,diff:s.pos-y.pos,parent:null,parentIdx:null});m.length>0;){var R=m.pop();if(0!==R.diff)for(var J=R.ids[2],x=0,A=J.length;x<A;x++)m.push({ids:J[x],diff:R.diff-1,parent:R.ids,parentIdx:x});else R.ids[0]===s.ids[0]&&q.push(R)}var S=q[0];S?(r=On(S.ids,s.ids),S.parent[2][S.parentIdx]=r.tree,o.push({pos:y.pos,ids:y.ids}),i=i||r.conflicts,d=!0):o.push(p)}else o.push(p)}return d||o.push(e),o.sort(mr),{tree:o,conflicts:i||"internal_node"}}function An(t,e,n){var r=qn(t,e),o=function(i,d){for(var c,l,p=kn(i),y=0,s=p.length;y<s;y++){var h,q=p[y],m=q.ids;if(m.length>d){c||(c={});var R=m.length-d;h={pos:q.pos+R,ids:jn(m,R)};for(var J=0;J<R;J++)c[q.pos+J+"-"+m[J].id]=!0}else h={pos:q.pos,ids:jn(m,0)};l=l?qn(l,h,!0).tree:[h]}return c&&Qt(l,function(A,S,_){delete c[S+"-"+_]}),{tree:l,revs:c?Object.keys(c):[]}}(r.tree,n);return{tree:o.tree,stemmedRevs:o.revs,conflicts:r.conflicts}}function kr(t){return t.ids}function Jt(t,e){e||(e=Gt(t));for(var n,r=e.substring(e.indexOf("-")+1),o=t.rev_tree.map(kr);n=o.pop();){if(n[0]===r)return!!n[1].deleted;o=o.concat(n[2])}}function Wt(t){return/^_local/.test(t)}function ae(t,e,n){F.call(this);var r=this;this.db=t;var o=(e=e?lt(e):{}).complete=T(function(c,l){var p,y;c?(y="error",("listenerCount"in(p=r)?p.listenerCount(y):F.listenerCount(p,y))>0&&r.emit("error",c)):r.emit("complete",l),r.removeAllListeners(),t.removeListener("destroyed",i)});function i(){r.cancel()}n&&(r.on("complete",function(c){n(null,c)}),r.on("error",n)),t.once("destroyed",i),e.onChange=function(c,l,p){r.isCancelled||function(y,s,h,q){try{y.emit("change",s,h,q)}catch(m){Ct("error",'Error in .on("change", function):',m)}}(r,c,l,p)};var d=new Promise(function(c,l){e.complete=function(p,y){p?l(p):c(y)}});r.once("cancel",function(){t.removeListener("destroyed",i),e.complete(null,{status:"cancelled"})}),this.then=d.then.bind(d),this.catch=d.catch.bind(d),this.then(function(c){o(null,c)},o),t.taskqueue.isReady?r.validateChanges(e):t.taskqueue.addTask(function(c){c?e.complete(c):r.isCancelled?r.emit("cancel"):r.validateChanges(e)})}function jr(t,e,n){var r=[{rev:t._rev}];"all_docs"===n.style&&(r=Re(e.rev_tree).map(function(i){return{rev:i.rev}}));var o={id:e.id,changes:r,doc:t};return Jt(e,t._rev)&&(o.deleted=!0),n.conflicts&&(o.doc._conflicts=Ne(e),o.doc._conflicts.length||delete o.doc._conflicts),o}function Sn(t,e){return t<e?-1:t>e?1:0}function Ue(t,e){return function(n,r){n||r[0]&&r[0].error?((n=n||r[0]).docId=e,t(n)):t(null,r.length?r[0]:r)}}function Or(t,e){var n=Sn(t._id,e._id);return 0!==n?n:Sn(t._revisions?t._revisions.start:0,e._revisions?e._revisions.start:0)}function Ot(){for(var t in F.call(this),Ot.prototype)"function"==typeof this[t]&&(this[t]=this[t].bind(this))}function ue(){this.isReady=!1,this.failed=!1,this.queue=[]}function pt(t,e){if(!(this instanceof pt))return new pt(t,e);var n=this;if(e=e||{},t&&"object"==typeof t&&(t=(e=t).name,delete e.name),void 0===e.deterministic_revs&&(e.deterministic_revs=!0),this.__opts=e=lt(e),n.auto_compaction=e.auto_compaction,n.prefix=pt.prefix,"string"!=typeof t)throw new Error("Missing/invalid DB name");var r=function(o,i){var d=o.match(/([a-z-]*):\/\/(.*)/);if(d)return{name:/https?/.test(d[1])?d[1]+"://"+d[2]:d[2],adapter:d[1]};var c=pt.adapters,l=pt.preferredAdapters,p=pt.prefix,y=i.adapter;if(!y)for(var s=0;s<l.length&&"idb"===(y=l[s])&&"websql"in c&&It()&&localStorage["_pouch__websqldb_"+p+o];++s)Ct("log",'PouchDB is downgrading "'+o+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');var h=c[y];return{name:h&&"use_prefix"in h&&!h.use_prefix?o:p+o,adapter:y}}((e.prefix||"")+t,e);if(e.name=r.name,e.adapter=e.adapter||r.adapter,n.name=t,n._adapter=e.adapter,pt.emit("debug",["adapter","Picked adapter: ",e.adapter]),!pt.adapters[e.adapter]||!pt.adapters[e.adapter].valid())throw new Error("Invalid Adapter: "+e.adapter);if(e.view_adapter&&(!pt.adapters[e.view_adapter]||!pt.adapters[e.view_adapter].valid()))throw new Error("Invalid View Adapter: "+e.view_adapter);Ot.call(n),n.taskqueue=new ue,n.adapter=e.adapter,pt.adapters[e.adapter].call(n,e,function(o){if(o)return n.taskqueue.fail(o);(function(i){function d(l){i.removeListener("closed",c),l||i.constructor.emit("destroyed",i.name)}function c(){i.removeListener("destroyed",d),i.constructor.emit("unref",i)}i.once("destroyed",d),i.once("closed",c),i.constructor.emit("ref",i)})(n),n.emit("created",n),pt.emit("created",n.name),n.taskqueue.ready(n)})}O(ae,F),ae.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},ae.prototype.validateChanges=function(t){var e=t.complete,n=this;pt._changesFilterPlugin?pt._changesFilterPlugin.validate(t,function(r){if(r)return e(r);n.doChanges(t)}):n.doChanges(t)},ae.prototype.doChanges=function(t){var e=this,n=t.complete;if("live"in(t=lt(t))&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=jr,"latest"===t.since&&(t.since="now"),t.since||(t.since=0),"now"!==t.since){if(pt._changesFilterPlugin){if(pt._changesFilterPlugin.normalize(t),pt._changesFilterPlugin.shouldFilter(this,t))return pt._changesFilterPlugin.filter(this,t)}else["doc_ids","filter","selector","view"].forEach(function(i){i in t&&Ct("warn",'The "'+i+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in t||(t.descending=!1),t.limit=0===t.limit?1:t.limit,t.complete=n;var r=this.db._changes(t);if(r&&"function"==typeof r.cancel){var o=e.cancel;e.cancel=H(function(i){r.cancel(),o.apply(this,i)})}}else this.db.info().then(function(i){e.isCancelled?n(null,{status:"cancelled"}):(t.since=i.update_seq,e.doChanges(t))},n)},O(Ot,F),Ot.prototype.post=Y("post",function(t,e,n){if("function"==typeof e&&(n=e,e={}),"object"!=typeof t||Array.isArray(t))return n(_t(xe));this.bulkDocs({docs:[t]},e,Ue(n,t._id))}),Ot.prototype.put=Y("put",function(t,e,n){if("function"==typeof e&&(n=e,e={}),"object"!=typeof t||Array.isArray(t))return n(_t(xe));if(pn(t._id),Wt(t._id)&&"function"==typeof this._putLocal)return t._deleted?this._removeLocal(t,n):this._putLocal(t,n);var r,o,i,d,c=this;function l(p){"function"==typeof c._put&&!1!==e.new_edits?c._put(t,e,p):c.bulkDocs({docs:[t]},e,Ue(p,t._id))}e.force&&t._rev?(o=(r=t._rev.split("-"))[1],i=parseInt(r[0],10)+1,d=wn(),t._revisions={start:i,ids:[d,o]},t._rev=i+"-"+d,e.new_edits=!1,l(function(p){n(p,p?null:{ok:!0,id:t._id,rev:t._rev})})):l(n)}),Ot.prototype.putAttachment=Y("putAttachment",function(t,e,n,r,o){var i=this;function d(c){var l="_rev"in c?parseInt(c._rev,10):0;return c._attachments=c._attachments||{},c._attachments[e]={content_type:o,data:r,revpos:++l},i.put(c)}return"function"==typeof o&&(o=r,r=n,n=null),void 0===o&&(o=r,r=n,n=null),o||Ct("warn","Attachment",e,"on document",t,"is missing content_type"),i.get(t).then(function(c){if(c._rev!==n)throw _t(ee);return d(c)},function(c){if(c.reason===Rt.message)return d({_id:t});throw c})}),Ot.prototype.removeAttachment=Y("removeAttachment",function(t,e,n,r){var o=this;o.get(t,function(i,d){if(i)r(i);else if(d._rev===n){if(!d._attachments)return r();delete d._attachments[e],0===Object.keys(d._attachments).length&&delete d._attachments,o.put(d,r)}else r(_t(ee))})}),Ot.prototype.remove=Y("remove",function(t,e,n,r){var o;"string"==typeof e?(o={_id:t,_rev:e},"function"==typeof n&&(r=n,n={})):(o=t,"function"==typeof e?(r=e,n={}):(r=n,n=e)),(n=n||{}).was_delete=!0;var i={_id:o._id,_rev:o._rev||n.rev,_deleted:!0};if(Wt(i._id)&&"function"==typeof this._removeLocal)return this._removeLocal(o,r);this.bulkDocs({docs:[i]},n,Ue(r,i._id))}),Ot.prototype.revsDiff=Y("revsDiff",function(t,e,n){"function"==typeof e&&(n=e,e={});var r=Object.keys(t);if(!r.length)return n(null,{});var o=0,i=new C;function d(c,l){i.has(c)||i.set(c,{missing:[]}),i.get(c).missing.push(l)}r.map(function(c){this._getRevisionTree(c,function(l,p){if(l&&404===l.status&&"missing"===l.message)i.set(c,{missing:t[c]});else{if(l)return n(l);h=p,q=t[s=c].slice(0),Qt(h,function(m,R,J,x,A){var S=R+"-"+J,_=q.indexOf(S);-1!==_&&(q.splice(_,1),"available"!==A.status&&d(s,S))}),q.forEach(function(m){d(s,m)})}var s,h,q;if(++o===r.length){var y={};return i.forEach(function(s,h){y[h]=s}),n(null,y)}})},this)}),Ot.prototype.bulkGet=Y("bulkGet",function(t,e){wt(this,t,e)}),Ot.prototype.compactDocument=Y("compactDocument",function(t,e,n){var r=this;this._getRevisionTree(t,function(o,i){if(o)return n(o);var y,s,d=(y={},s=[],Qt(i,function(h,q,m,R){var J=q+"-"+m;return h&&(y[J]=0),void 0!==R&&s.push({from:R,to:J}),J}),s.reverse(),s.forEach(function(h){y[h.from]=void 0===y[h.from]?1+y[h.to]:Math.min(y[h.from],1+y[h.to])}),y),c=[],l=[];Object.keys(d).forEach(function(p){d[p]>e&&c.push(p)}),Qt(i,function(p,y,s,h,q){var m=y+"-"+s;"available"===q.status&&-1!==c.indexOf(m)&&l.push(m)}),r._doCompaction(t,l,n)})}),Ot.prototype.compact=Y("compact",function(t,e){"function"==typeof t&&(e=t,t={}),t=t||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:t,callback:e}),1===this._compactionQueue.length&&function n(r){var o=r._compactionQueue[0],i=o.opts,d=o.callback;r.get("_local/compaction").catch(function(){return!1}).then(function(c){c&&c.last_seq&&(i.last_seq=c.last_seq),r._compact(i,function(l,p){l?d(l):d(null,p),E(function(){r._compactionQueue.shift(),r._compactionQueue.length&&n(r)})})})}(this)}),Ot.prototype._compact=function(t,e){var n=this,o=[];n.changes({return_docs:!1,last_seq:t.last_seq||0}).on("change",function(i){o.push(n.compactDocument(i.id,0))}).on("complete",function(i){var d=i.last_seq;Promise.all(o).then(function(){return ye(n,"_local/compaction",function(c){return(!c.last_seq||c.last_seq<d)&&(c.last_seq=d,c)})}).then(function(){e(null,{ok:!0})}).catch(e)}).on("error",e)},Ot.prototype.get=Y("get",function(t,e,n){if("function"==typeof e&&(n=e,e={}),"string"!=typeof t)return n(_t(cn));if(Wt(t)&&"function"==typeof this._getLocal)return this._getLocal(t,n);var r=[],o=this;function i(){var l=[],p=r.length;if(!p)return n(null,l);r.forEach(function(y){o.get(t,{rev:y,revs:e.revs,latest:e.latest,attachments:e.attachments,binary:e.binary},function(s,h){if(s)l.push({missing:y});else{for(var q,m=0,R=l.length;m<R;m++)if(l[m].ok&&l[m].ok._rev===h._rev){q=!0;break}q||l.push({ok:h})}--p||n(null,l)})})}if(!e.open_revs)return this._get(t,e,function(l,p){if(l)return l.docId=t,n(l);var y=p.doc,s=p.metadata,h=p.ctx;if(e.conflicts){var q=Ne(s);q.length&&(y._conflicts=q)}if(Jt(s,y._rev)&&(y._deleted=!0),e.revs||e.revs_info){for(var m=y._rev.split("-"),R=parseInt(m[0],10),J=m[1],x=kn(s.rev_tree),A=null,S=0;S<x.length;S++){var _=x[S],j=_.ids.map(function(D){return D.id}).indexOf(J);(j===R-1||!A&&-1!==j)&&(A=_)}if(!A)return(l=new Error("invalid rev tree")).docId=t,n(l);var b=A.ids.map(function(D){return D.id}).indexOf(y._rev.split("-")[1])+1;if(A.ids.splice(b,A.ids.length-b),A.ids.reverse(),e.revs&&(y._revisions={start:A.pos+A.ids.length-1,ids:A.ids.map(function(D){return D.id})}),e.revs_info){var z=A.pos+A.ids.length;y._revs_info=A.ids.map(function(D){return{rev:--z+"-"+D.id,status:D.opts.status}})}}if(e.attachments&&y._attachments){var G=y._attachments,K=Object.keys(G).length;if(0===K)return n(null,y);Object.keys(G).forEach(function(D){this._getAttachment(y._id,D,G[D],{rev:y._rev,binary:e.binary,ctx:h},function($,B){var U=y._attachments[D];U.data=B,delete U.stub,delete U.length,--K||n(null,y)})},o)}else{if(y._attachments)for(var N in y._attachments)Object.prototype.hasOwnProperty.call(y._attachments,N)&&(y._attachments[N].stub=!0);n(null,y)}});if("all"===e.open_revs)this._getRevisionTree(t,function(l,p){if(l)return n(l);r=Re(p).map(function(y){return y.rev}),i()});else{if(!Array.isArray(e.open_revs))return n(_t(fn,"function_clause"));r=e.open_revs;for(var d=0;d<r.length;d++){var c=r[d];if("string"!=typeof c||!/^\d+-/.test(c))return n(_t(hn))}i()}}),Ot.prototype.getAttachment=Y("getAttachment",function(t,e,n,r){var o=this;n instanceof Function&&(r=n,n={}),this._get(t,n,function(i,d){return i?r(i):d.doc._attachments&&d.doc._attachments[e]?(n.ctx=d.ctx,n.binary=!0,void o._getAttachment(t,e,d.doc._attachments[e],n,r)):r(_t(Rt))})}),Ot.prototype.allDocs=Y("allDocs",function(t,e){if("function"==typeof t&&(e=t,t={}),t.skip=void 0!==t.skip?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return e(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter(function(r){return r in t})[0];if(n)return void e(_t(fr,"Query parameter `"+n+"` is not compatible with multi-get"));if(!Ft(this)&&(o="limit"in(r=t)?r.keys.slice(r.skip,r.limit+r.skip):r.skip>0?r.keys.slice(r.skip):r.keys,r.keys=o,r.skip=0,delete r.limit,r.descending&&(o.reverse(),r.descending=!1),0===t.keys.length))return this._allDocs({limit:0},e)}var r,o;return this._allDocs(t,e)}),Ot.prototype.changes=function(t,e){return"function"==typeof t&&(e=t,t={}),(t=t||{}).return_docs="return_docs"in t?t.return_docs:!t.live,new ae(this,t,e)},Ot.prototype.close=Y("close",function(t){return this._closed=!0,this.emit("closed"),this._close(t)}),Ot.prototype.info=Y("info",function(t){var e=this;this._info(function(n,r){if(n)return t(n);r.db_name=r.db_name||e.name,r.auto_compaction=!(!e.auto_compaction||Ft(e)),r.adapter=e.adapter,t(null,r)})}),Ot.prototype.id=Y("id",function(t){return this._id(t)}),Ot.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},Ot.prototype.bulkDocs=Y("bulkDocs",function(t,e,n){if("function"==typeof e&&(n=e,e={}),e=e||{},Array.isArray(t)&&(t={docs:t}),!t||!t.docs||!Array.isArray(t.docs))return n(_t(ar));for(var r=0;r<t.docs.length;++r)if("object"!=typeof t.docs[r]||Array.isArray(t.docs[r]))return n(_t(xe));var o;if(t.docs.forEach(function(c){c._attachments&&Object.keys(c._attachments).forEach(function(l){var p;o=o||"_"===(p=l).charAt(0)&&p+" is not a valid attachment name, attachment names cannot start with '_'",c._attachments[l].content_type||Ct("warn","Attachment",l,"on document",c._id,"is missing content_type")})}),o)return n(_t(pe,o));"new_edits"in e||(e.new_edits=!("new_edits"in t)||t.new_edits);var i=this;e.new_edits||Ft(i)||t.docs.sort(Or),function(c){for(var l=0;l<c.length;l++){var p=c[l];if(p._deleted)delete p._attachments;else if(p._attachments)for(var y=Object.keys(p._attachments),s=0;s<y.length;s++){var h=y[s];p._attachments[h]=at(p._attachments[h],["data","digest","content_type","length","revpos","stub"])}}}(t.docs);var d=t.docs.map(function(c){return c._id});return this._bulkDocs(t,e,function(c,l){if(c)return n(c);if(e.new_edits||(l=l.filter(function(s){return s.error})),!Ft(i))for(var p=0,y=l.length;p<y;p++)l[p].id=l[p].id||d[p];n(null,l)})}),Ot.prototype.registerDependentDatabase=Y("registerDependentDatabase",function(t,e){var n=lt(this.__opts);this.__opts.view_adapter&&(n.adapter=this.__opts.view_adapter);var r=new this.constructor(t,n);ye(this,"_local/_pouch_dependentDbs",function(o){return o.dependentDbs=o.dependentDbs||{},!o.dependentDbs[t]&&(o.dependentDbs[t]=!0,o)}).then(function(){e(null,{db:r})}).catch(e)}),Ot.prototype.destroy=Y("destroy",function(t,e){"function"==typeof t&&(e=t,t={});var n=this,r=!("use_prefix"in n)||n.use_prefix;function o(){n._destroy(t,function(i,d){if(i)return e(i);n._destroyed=!0,n.emit("destroyed"),e(null,d||{ok:!0})})}if(Ft(n))return o();n.get("_local/_pouch_dependentDbs",function(i,d){if(i)return 404!==i.status?e(i):o();var l=n.constructor,p=Object.keys(d.dependentDbs).map(function(y){var s=r?y.replace(new RegExp("^"+l.prefix),""):y;return new l(s,n.__opts).destroy()});Promise.all(p).then(o,e)})}),ue.prototype.execute=function(){var t;if(this.failed)for(;t=this.queue.shift();)t(this.failed);else for(;t=this.queue.shift();)t()},ue.prototype.fail=function(t){this.failed=t,this.execute()},ue.prototype.ready=function(t){this.isReady=!0,this.db=t,this.execute()},ue.prototype.addTask=function(t){this.queue.push(t),this.failed&&this.execute()},O(pt,Ot);var qr="undefined"!=typeof AbortController?AbortController:function(){return{abort:function(){}}},xn=fetch,re=Headers;pt.adapters={},pt.preferredAdapters=[],pt.prefix="_pouch_";var En=new F;function Fe(t,e){for(var n=t,r=0,o=e.length;r<o&&(n=n[e[r]]);r++);return n}function Ke(t){for(var e=[],n="",r=0,o=t.length;r<o;r++){var i=t[r];r>0&&"\\"===t[r-1]&&("$"===i||"."===i)?n=n.substring(0,n.length-1)+i:"."===i?(e.push(n),n=""):n+=i}return e.push(n),e}(function(t){Object.keys(F.prototype).forEach(function(n){"function"==typeof F.prototype[n]&&(t[n]=En[n].bind(En))});var e=t._destructionListeners=new C;t.on("ref",function(n){e.has(n.name)||e.set(n.name,[]),e.get(n.name).push(n)}),t.on("unref",function(n){if(e.has(n.name)){var r=e.get(n.name),o=r.indexOf(n);o<0||(r.splice(o,1),r.length>1?e.set(n.name,r):e.delete(n.name))}}),t.on("destroyed",function(n){if(e.has(n)){var r=e.get(n);e.delete(n),r.forEach(function(o){o.emit("destroyed",!0)})}})})(pt),pt.adapter=function(t,e,n){e.valid()&&(pt.adapters[t]=e,n&&pt.preferredAdapters.push(t))},pt.plugin=function(t){if("function"==typeof t)t(pt);else{if("object"!=typeof t||0===Object.keys(t).length)throw new Error('Invalid plugin: got "'+t+'", expected an object or a function');Object.keys(t).forEach(function(e){pt.prototype[e]=t[e]})}return this.__defaults&&(pt.__defaults=Vt({},this.__defaults)),pt},pt.defaults=function(t){function e(n,r){if(!(this instanceof e))return new e(n,r);r=r||{},n&&"object"==typeof n&&(n=(r=n).name,delete r.name),r=Vt({},e.__defaults,r),pt.call(this,n,r)}return O(e,pt),e.preferredAdapters=pt.preferredAdapters.slice(),Object.keys(pt).forEach(function(n){n in e||(e[n]=pt[n])}),e.__defaults=Vt({},this.__defaults,t),e},pt.fetch=function(t,e){return xn(t,e)};var Ar=["$or","$nor","$not"];function Pn(t){return Ar.indexOf(t)>-1}function Cn(t){return Object.keys(t)[0]}function ce(t){var e={},n={$or:!0,$nor:!0};return t.forEach(function(r){Object.keys(r).forEach(function(o){var i=r[o];if("object"!=typeof i&&(i={$eq:i}),Pn(o))if(i instanceof Array){if(n[o])return n[o]=!1,void(e[o]=i);var d=[];e[o].forEach(function(l){Object.keys(i).forEach(function(p){var y=i[p],s=Math.max(Object.keys(l).length,Object.keys(y).length),h=ce([l,y]);Object.keys(h).length<=s||d.push(h)})}),e[o]=d}else e[o]=ce([i]);else{var c=e[o]=e[o]||{};Object.keys(i).forEach(function(l){var y,s,h,p=i[l];return"$gt"===l||"$gte"===l?(y=l,s=p,void(void 0===(h=c).$eq&&(void 0!==h.$gte?"$gte"===y?s>h.$gte&&(h.$gte=s):s>=h.$gte&&(delete h.$gte,h.$gt=s):void 0!==h.$gt?"$gte"===y?s>h.$gt&&(delete h.$gt,h.$gte=s):s>h.$gt&&(h.$gt=s):h[y]=s))):"$lt"===l||"$lte"===l?function(y,s,h){void 0===h.$eq&&(void 0!==h.$lte?"$lte"===y?s<h.$lte&&(h.$lte=s):s<=h.$lte&&(delete h.$lte,h.$lt=s):void 0!==h.$lt?"$lte"===y?s<h.$lt&&(delete h.$lt,h.$lte=s):s<h.$lt&&(h.$lt=s):h[y]=s)}(l,p,c):"$ne"===l?function(y,s){"$ne"in s?s.$ne.push(y):s.$ne=[y]}(p,c):"$eq"===l?function(y,s){delete s.$gt,delete s.$gte,delete s.$lt,delete s.$lte,delete s.$ne,s.$eq=y}(p,c):"$regex"===l?function(y,s){"$regex"in s?s.$regex.push(y):s.$regex=[y]}(p,c):void(c[l]=p)})}})}),e}function Sr(t){var e=lt(t),n=!1;(function c(l,p){for(var y in l){"$and"===y&&(p=!0);var s=l[y];"object"==typeof s&&(p=c(s,p))}return p})(e,!1)&&("$and"in(e=function c(l){for(var p in l){if(Array.isArray(l))for(var y in l)l[y].$and&&(l[y]=ce(l[y].$and));var s=l[p];"object"==typeof s&&c(s)}return l}(e))&&(e=ce(e.$and)),n=!0),["$or","$nor"].forEach(function(c){c in e&&e[c].forEach(function(l){for(var p=Object.keys(l),y=0;y<p.length;y++){var s=p[y],h=l[s];"object"==typeof h&&null!==h||(l[s]={$eq:h})}})}),"$not"in e&&(e.$not=ce([e.$not]));for(var r=Object.keys(e),o=0;o<r.length;o++){var i=r[o],d=e[i];"object"!=typeof d||null===d?d={$eq:d}:n||("$ne"in d&&(d.$ne=[d.$ne]),"$regex"in d&&(d.$regex=[d.$regex])),e[i]=d}return e}function At(t,e){if(t===e)return 0;t=Yt(t),e=Yt(e);var o,i,n=Je(t),r=Je(e);if(n-r!=0)return n-r;switch(typeof t){case"number":return t-e;case"boolean":return t<e?-1:1;case"string":return(o=t)===(i=e)?0:o>i?1:-1}return Array.isArray(t)?function(o,i){for(var d=Math.min(o.length,i.length),c=0;c<d;c++){var l=At(o[c],i[c]);if(0!==l)return l}return o.length===i.length?0:o.length>i.length?1:-1}(t,e):function(o,i){for(var d=Object.keys(o),c=Object.keys(i),l=Math.min(d.length,c.length),p=0;p<l;p++){var y=At(d[p],c[p]);if(0!==y||0!==(y=At(o[d[p]],i[c[p]])))return y}return d.length===c.length?0:d.length>c.length?1:-1}(t,e)}function Yt(t){switch(typeof t){case"undefined":return null;case"number":return t===1/0||t===-1/0||isNaN(t)?null:t;case"object":var e=t;if(Array.isArray(t)){var n=t.length;t=new Array(n);for(var r=0;r<n;r++)t[r]=Yt(e[r])}else{if(t instanceof Date)return t.toJSON();if(null!==t)for(var o in t={},e)if(Object.prototype.hasOwnProperty.call(e,o)){var i=e[o];void 0!==i&&(t[o]=Yt(i))}}}return t}function Nt(t){return Je(t=Yt(t))+""+function xr(t){if(null!==t)switch(typeof t){case"boolean":return t?1:0;case"number":return function(c){if(0===c)return"1";var q,l=c.toExponential().split(/e\+?/),p=parseInt(l[1],10),y=c<0,s=y?"0":"2";s+=""+(function(A,S,_){for(var j="",b=3-A.length;j.length<b;)j+="0";return j}(q=((y?-p:p)- -324).toString())+q);var J=Math.abs(parseFloat(l[0]));return y&&(J=10-J),s+""+J.toFixed(20).replace(/\.?0+$/,"")}(t);case"string":return t.replace(/\u0002/g,"\x02\x02").replace(/\u0001/g,"\x01\x02").replace(/\u0000/g,"\x01\x01");case"object":var e=Array.isArray(t),n=e?t:Object.keys(t),r=-1,o=n.length,i="";if(e)for(;++r<o;)i+=Nt(n[r]);else for(;++r<o;){var d=n[r];i+=Nt(d)+Nt(t[d])}return i}return""}(t)+"\0"}function Er(t,e){var n,r=e;if("1"===t[e])n=0,e++;else{var o="0"===t[e];e++;var i="",d=t.substring(e,e+3),c=parseInt(d,10)+-324;for(o&&(c=-c),e+=3;;){var l=t[e];if("\0"===l)break;i+=l,e++}n=1===(i=i.split(".")).length?parseInt(i,10):parseFloat(i[0]+"."+i[1]),o&&(n-=10),0!==c&&(n=parseFloat(n+"e"+c))}return{num:n,length:e-r}}function Pr(t,e){var n=t.pop();if(e.length){var r=e[e.length-1];n===r.element&&(e.pop(),r=e[e.length-1]);var o=r.element,i=r.index;Array.isArray(o)?o.push(n):i===t.length-2?o[t.pop()]=n:t.push(n)}}function Je(t){var e=["boolean","number","string","object"].indexOf(typeof t);return~e?null===t?1:Array.isArray(t)?5:e<3?e+2:e+3:Array.isArray(t)?5:void 0}function oe(t,e,n){return n.every(function(r){var c,l,p,o=e[r],i=Ke(r),d=Fe(t,i);return Pn(r)?(l=o,p=t,"$or"===(c=r)?l.some(function(y){return oe(p,y,Object.keys(y))}):"$not"===c?!oe(p,l,Object.keys(l)):!l.find(function(y){return oe(p,y,Object.keys(y))})):_e(o,t,i,d)})}function _e(t,e,n,r){return!t||("object"==typeof t?Object.keys(t).every(function(o){var i=t[o];if(0===o.indexOf("$"))return Ln(o,e,i,n,r);var d=Ke(o);if(void 0===r&&"object"!=typeof i&&d.length>0)return!1;var c=Fe(r,d);return"object"==typeof i?_e(i,e,n,c):Ln("$eq",e,i,d,c)}):t===r)}function Ln(t,e,n,r,o){if(!Dn[t])throw new Error('unknown operator "'+t+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return Dn[t](e,n,r,o)}function fe(t){return null!=t}function Ht(t){return void 0!==t}function $n(t,e){return e.some(function(n){return t instanceof Array?t.some(function(r){return 0===At(n,r)}):0===At(n,t)})}var Dn={$elemMatch:function(t,e,n,r){return!!Array.isArray(r)&&0!==r.length&&r.some("object"==typeof r[0]?function(o){return oe(o,e,Object.keys(e))}:function(o){return _e(e,t,n,o)})},$allMatch:function(t,e,n,r){return!!Array.isArray(r)&&0!==r.length&&r.every("object"==typeof r[0]?function(o){return oe(o,e,Object.keys(e))}:function(o){return _e(e,t,n,o)})},$eq:function(t,e,n,r){return Ht(r)&&0===At(r,e)},$gte:function(t,e,n,r){return Ht(r)&&At(r,e)>=0},$gt:function(t,e,n,r){return Ht(r)&&At(r,e)>0},$lte:function(t,e,n,r){return Ht(r)&&At(r,e)<=0},$lt:function(t,e,n,r){return Ht(r)&&At(r,e)<0},$exists:function(t,e,n,r){return e?Ht(r):!Ht(r)},$mod:function(t,e,n,r){return fe(r)&&(i=e,"number"==typeof(o=r)&&parseInt(o,10)===o&&o%i[0]===i[1]);var o,i},$ne:function(t,e,n,r){return e.every(function(o){return 0!==At(r,o)})},$in:function(t,e,n,r){return fe(r)&&$n(r,e)},$nin:function(t,e,n,r){return fe(r)&&!$n(r,e)},$size:function(t,e,n,r){return fe(r)&&Array.isArray(r)&&r.length===e},$all:function(t,e,n,r){return Array.isArray(r)&&(o=r,e.every(function(d){return o.some(function(c){return 0===At(d,c)})}));var o},$regex:function(t,e,n,r){return fe(r)&&"string"==typeof r&&e.every(function(o){return i=r,new RegExp(o).test(i);var i})},$type:function(t,e,n,r){return function(o,i){switch(i){case"null":return null===o;case"boolean":return"boolean"==typeof o;case"number":return"number"==typeof o;case"string":return"string"==typeof o;case"array":return o instanceof Array;case"object":return"[object Object]"==={}.toString.call(o)}}(r,e)}};function Lr(t,e){if(t.selector&&t.filter&&"_selector"!==t.filter)return e(new Error('selector invalid for filter "'+("string"==typeof t.filter?t.filter:"function")+'"'));e()}function $r(t){t.view&&!t.filter&&(t.filter="_view"),t.selector&&!t.filter&&(t.filter="_selector"),t.filter&&"string"==typeof t.filter&&("_view"===t.filter?t.view=vn(t.view):t.filter=vn(t.filter))}function Dr(t,e){return e.filter&&"string"==typeof e.filter&&!e.doc_ids&&!Ft(t.db)}function Ir(t,e){var n=e.complete;if("_view"===e.filter){if(!e.view||"string"!=typeof e.view){var r=_t(pe,"`view` filter parameter not found or invalid.");return n(r)}var o=Ce(e.view);t.db.get("_design/"+o[0],function(d,c){if(t.isCancelled)return n(null,{status:"cancelled"});if(d)return n(ne(d));var l=c&&c.views&&c.views[o[1]]&&c.views[o[1]].map;if(!l)return n(_t(Rt,c.views?"missing json key: "+o[1]:"missing json key: views"));e.filter=Le(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+l+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{}),t.doChanges(e)})}else if(e.selector)e.filter=function(d){return function(c,l){if("object"!=typeof l)throw new Error("Selector error: expected a JSON object");var p=function Cr(t,e,n){if(t=t.filter(function(c){return oe(c.doc,e.selector,n)}),e.sort){var r=function(c){function l(p){return c.map(function(y){var s=Ke(Cn(y));return Fe(p,s)})}return function(p,y){var s,h,q=At(l(p.doc),l(y.doc));return 0!==q?q:(s=p.doc._id)<(h=y.doc._id)?-1:s>h?1:0}}(e.sort);t=t.sort(r),"string"!=typeof e.sort[0]&&"desc"===(o=e.sort[0])[Cn(o)]&&(t=t.reverse())}var o;if("limit"in e||"skip"in e){var i=e.skip||0;t=t.slice(i,("limit"in e?e.limit:t.length)+i)}return t}([{doc:c}],{selector:l=Sr(l)},Object.keys(l));return p&&1===p.length}(d,e.selector)},t.doChanges(e);else{var i=Ce(e.filter);t.db.get("_design/"+i[0],function(d,c){if(t.isCancelled)return n(null,{status:"cancelled"});if(d)return n(ne(d));var l=c&&c.filters&&c.filters[i[1]];if(!l)return n(_t(Rt,c&&c.filters?"missing json key: "+i[1]:"missing json key: filters"));e.filter=Le('"use strict";\nreturn '+l+";",{}),t.doChanges(e)})}}function In(t){return t.reduce(function(e,n){return e[n]=!0,e},{})}pt.plugin(function(t){t._changesFilterPlugin={validate:Lr,normalize:$r,shouldFilter:Dr,filter:Ir}}),pt.version="7.3.0";var Br=In(["_id","_rev","_access","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Tr=In(["_access","_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Bn(t){if(!/^\d+-/.test(t))return _t(hn);var e=t.indexOf("-"),n=t.substring(0,e),r=t.substring(e+1);return{prefix:parseInt(n,10),id:r}}function Tn(t,e,n){var r,o,i;n||(n={deterministic_revs:!0});var d={status:"available"};if(t._deleted&&(d.deleted=!0),e)if(t._id||(t._id=ge()),o=wn(t,n.deterministic_revs),t._rev){if((i=Bn(t._rev)).error)return i;t._rev_tree=[{pos:i.prefix,ids:[i.id,{status:"missing"},[[o,d,[]]]]}],r=i.prefix+1}else t._rev_tree=[{pos:1,ids:[o,d,[]]}],r=1;else if(t._revisions&&(t._rev_tree=function(s,h){for(var q=s.start-s.ids.length+1,m=s.ids,R=[m[0],h,[]],J=1,x=m.length;J<x;J++)R=[m[J],{status:"missing"},[R]];return[{pos:q,ids:R}]}(t._revisions,d),r=t._revisions.start,o=t._revisions.ids[0]),!t._rev_tree){if((i=Bn(t._rev)).error)return i;t._rev_tree=[{pos:r=i.prefix,ids:[o=i.id,d,[]]}]}pn(t._id),t._rev=r+"-"+o;var c={metadata:{},data:{}};for(var l in t)if(Object.prototype.hasOwnProperty.call(t,l)){var p="_"===l[0];if(p&&!Br[l]){var y=_t(dn,l);throw y.message=dn.message+": "+l,y}p&&!Tr[l]?c.metadata[l.slice(1)]=t[l]:c.data[l]=t[l]}return c}function Rr(t,e,n){if(t.stub)return n();var r,o,i;"string"==typeof t.data?function Mr(t,e,n){var r=function(o){try{return $e(o)}catch(i){return{error:_t(ln,"Attachment is not a valid base64 string")}}}(t.data);if(r.error)return n(r.error);t.length=r.length,t.data="blob"===e?Ie(r,t.content_type):"base64"===e?se(r):r,Me(r,function(o){t.digest="md5-"+o,n()})}(t,e,n):(o=e,i=n,Me((r=t).data,function(d){r.digest="md5-"+d,r.length=r.data.size||r.data.length||0,"binary"===o?mn(r.data,function(c){r.data=c,i()}):"base64"===o?Te(r.data,function(c){r.data=c,i()}):i()}))}var St="document-store",Lt="meta-store";function Fr(t){try{return JSON.stringify(t)}catch(e){return ct.stringify(t)}}function Kt(t){return function(e){var n="unknown_error";e.target&&e.target.error&&(n=e.target.error.name||e.target.error.message),t(_t(Ee,n))}}function ze(t,e,n){return{data:Fr(t),winningRev:e,deletedOrLocal:n?"1":"0",seq:t.seq,id:t.id}}function Xt(t){if(!t)return null;var e=function(n){try{return JSON.parse(n)}catch(r){return ct.parse(n)}}(t.data);return e.winningRev=t.winningRev,e.deleted="1"===t.deletedOrLocal,e.seq=t.seq,e}function me(t){if(!t)return t;var e=t._doc_id_rev.lastIndexOf(":");return t._id=t._doc_id_rev.substring(0,e-1),t._rev=t._doc_id_rev.substring(e+1),delete t._doc_id_rev,t}function Mn(t,e,n,r){n?r(t?"string"!=typeof t?t:Be(t,e):De([""],{type:e})):t?"string"!=typeof t?_n(t,function(o){r(se(o))}):r(t):r("")}function Rn(t,e,n,r){var o=Object.keys(t._attachments||{});if(!o.length)return r&&r();var i=0;function d(){++i===o.length&&r&&r()}o.forEach(function(c){var y,s;e.attachments&&e.include_docs?(s=(y=t._attachments[c]).digest,n.objectStore("attach-store").get(s).onsuccess=function(h){y.body=h.target.result.body,d()}):(t._attachments[c].stub=!0,d())})}function Ve(t,e){return Promise.all(t.map(function(n){if(n.doc&&n.doc._attachments){var r=Object.keys(n.doc._attachments);return Promise.all(r.map(function(o){var i=n.doc._attachments[o];if("body"in i){var d=i.body,c=i.content_type;return new Promise(function(l){Mn(d,c,e,function(p){n.doc._attachments[o]=Vt(at(i,["digest","content_type"]),{data:p}),l()})})}}))}}))}function Nn(t,e,n){var r=[],o=n.objectStore("by-sequence"),i=n.objectStore("attach-store"),d=n.objectStore("attach-seq-store"),c=t.length;function l(){--c||!r.length||r.forEach(function(p){d.index("digestSeq").count(IDBKeyRange.bound(p+"::",p+"::\uffff",!1,!1)).onsuccess=function(y){y.target.result||i.delete(p)}})}t.forEach(function(p){o.index("_doc_id_rev").getKey(e+"::"+p).onsuccess=function(h){var q=h.target.result;if("number"!=typeof q)return l();o.delete(q),d.index("seq").openCursor(IDBKeyRange.only(q)).onsuccess=function(m){var R=m.target.result;if(R){var J=R.value.digestSeq.split("::")[0];r.push(J),d.delete(R.primaryKey),R.continue()}else l()}}})}function Ut(t,e,n){try{return{txn:t.transaction(e,n)}}catch(r){return{error:r}}}var le=new Pt;function Un(t,e,n,r,o){var i,d,c;function l(s){d=s.target.result,i&&o(i,d,c)}function p(s){i=s.target.result,d&&o(i,d,c)}function y(s){var h=s.target.result;if(!h)return o();o([h.key],[h.value],h)}-1===r&&(r=1e3),"function"==typeof t.getAll&&"function"==typeof t.getAllKeys&&r>1&&!n?(c={continue:function(){if(!i.length)return o();var s,h=i[i.length-1];if(e&&e.upper)try{s=IDBKeyRange.bound(h,e.upper,!0,e.upperOpen)}catch(q){if("DataError"===q.name&&0===q.code)return o()}else s=IDBKeyRange.lowerBound(h,!0);i=null,d=null,t.getAll(e=s,r).onsuccess=l,t.getAllKeys(e,r).onsuccess=p}},t.getAll(e,r).onsuccess=l,t.getAllKeys(e,r).onsuccess=p):n?t.openCursor(e,"prev").onsuccess=y:t.openCursor(e).onsuccess=y}var Ge=!1,Qe=[];function Fn(){!Ge&&Qe.length&&(Ge=!0,Qe.shift()())}var We,ie=new C,Ye=new C;function Kn(t,e){var o,i,n=this;o=e,i=n.constructor,Qe.push(function(){!function(o,i,d){var c=i.name,l=null,p=null;function y(x){return function(A,S){A&&A instanceof Error&&!A.reason&&p&&(A.reason=p),x(A,S)}}function s(x,A){var S=x.objectStore(St);S.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),S.openCursor().onsuccess=function(_){var j=_.target.result;if(j){var b=j.value,w=Jt(b);b.deletedOrLocal=w?"1":"0",S.put(b),j.continue()}else A()}}function h(x,A){var S=x.objectStore("local-store"),_=x.objectStore(St),j=x.objectStore("by-sequence");_.openCursor().onsuccess=function(b){var w=b.target.result;if(w){var z=w.value,G=z.id,K=Wt(G),N=Gt(z);if(K){var D=G+"::"+N,$=G+"::",B=G+"::~",U=j.index("_doc_id_rev"),Z=IDBKeyRange.bound($,B,!1,!1),ft=U.openCursor(Z);ft.onsuccess=function(rt){if(ft=rt.target.result){var nt=ft.value;nt._doc_id_rev===D&&S.put(nt),j.delete(ft.primaryKey),ft.continue()}else _.delete(w.primaryKey),w.continue()}}else w.continue()}else A&&A()}}function q(x,A){var S=x.objectStore("by-sequence"),_=x.objectStore("attach-store"),j=x.objectStore("attach-seq-store");_.count().onsuccess=function(b){if(!b.target.result)return A();S.openCursor().onsuccess=function(w){var z=w.target.result;if(!z)return A();for(var G=z.value,K=z.primaryKey,N=Object.keys(G._attachments||{}),D={},$=0;$<N.length;$++)D[G._attachments[N[$]].digest]=!0;var B=Object.keys(D);for($=0;$<B.length;$++)j.put({seq:K,digestSeq:B[$]+"::"+K});z.continue()}}}function m(x){var A=x.objectStore("by-sequence"),S=x.objectStore(St);S.openCursor().onsuccess=function(_){var G,K,N,D,j=_.target.result;if(j){var b,w=(b=j.value).data?Xt(b):(b.deleted="1"===b.deletedOrLocal,b);if(w.winningRev=w.winningRev||Gt(w),w.seq)return z();G=w.id+"::",K=w.id+"::\uffff",N=A.index("_doc_id_rev").openCursor(IDBKeyRange.bound(G,K)),D=0,N.onsuccess=function($){var B=$.target.result;if(!B)return w.seq=D,z();var U=B.primaryKey;U>D&&(D=U),B.continue()}}function z(){var G=ze(w,w.winningRev,w.deleted);S.put(G).onsuccess=function(){j.continue()}}}}o._meta=null,o._remote=!1,o.type=function(){return"idb"},o._id=W(function(x){x(null,o._meta.instanceId)}),o._bulkDocs=function(x,A,S){!function Kr(t,e,n,r,o,i){for(var d,c,l,p,y,s,h,q,m=e.docs,R=0,J=m.length;R<J;R++){var x=m[R];x._id&&Wt(x._id)||(x=m[R]=Tn(x,n.new_edits,t)).error&&!h&&(h=x)}if(h)return i(h);var A=!1,S=0,_=new Array(m.length),j=new C,b=!1;function z(){A=!0,G()}function G(){q&&A&&(q.docCount+=S,s.put(q))}function K(){b||(le.notify(r._meta.name),i(null,_))}function N($,B,U,Z,ft,rt,nt,ot){$.metadata.winningRev=B,$.metadata.deleted=U;var st=$.data;if(st._id=$.metadata.id,st._rev=$.metadata.rev,Z&&(st._deleted=!0),st._attachments&&Object.keys(st._attachments).length)return function(I,tt,it,ut,kt,vt){var qt=0,Dt=Object.keys(I.data._attachments);function Bt(){qt===Dt.length&&D(I,tt,it,ut,kt,vt)}function Tt(){qt++,Bt()}Dt.forEach(function($t){var zt,ro,sr,Et=I.data._attachments[$t];if(Et.stub)qt++,Bt();else{var Mt=Et.data;delete Et.data,Et.revpos=parseInt(tt,10),ro=Mt,sr=Tt,p.count(zt=Et.digest).onsuccess=function(oo){if(oo.target.result)return sr();p.put({digest:zt,body:ro}).onsuccess=sr}}})}($,B,U,ft,nt,ot);S+=rt,G(),D($,B,U,ft,nt,ot)}function D($,B,U,Z,ft,rt){var nt=$.data,ot=$.metadata;function st(it){var bt,ut=$.stemmedRevs||[];Z&&r.auto_compaction&&(ut=ut.concat((bt=[],Qt($.metadata.rev_tree,function(qt,Dt,Bt,Tt,$t){"available"!==$t.status||qt||(bt.push(Dt+"-"+Bt),$t.status="missing")}),bt))),ut&&ut.length&&Nn(ut,$.metadata.id,d),ot.seq=it.target.result;var kt=ze(ot,B,U);c.put(kt).onsuccess=I}function I(){_[ft]={ok:!0,id:ot.id,rev:ot.rev},j.set($.metadata.id,$.metadata),function(it,ut,kt){var Et,vt=0,bt=Object.keys(it.data._attachments||{});if(!bt.length)return kt();function qt(){++vt===bt.length&&kt()}for(var Bt=0;Bt<bt.length;Bt++)Et=void 0,(Et=y.put({seq:ut,digestSeq:it.data._attachments[bt[Bt]].digest+"::"+ut})).onsuccess=qt,Et.onerror=function(Mt){Mt.preventDefault(),Mt.stopPropagation(),qt()}}($,ot.seq,rt)}nt._doc_id_rev=ot.id+"::"+ot.rev,delete nt._id,delete nt._rev;var tt=l.put(nt);tt.onsuccess=st,tt.onerror=function(it){it.preventDefault(),it.stopPropagation(),l.index("_doc_id_rev").getKey(nt._doc_id_rev).onsuccess=function(ut){l.put(nt,ut.target.result).onsuccess=st}}}!function($,B,U){if(!$.length)return U();var Z,ft=0;function rt(){ft++,$.length===ft&&(Z?U(Z):U())}$.forEach(function(nt){var ot=nt.data&&nt.data._attachments?Object.keys(nt.data._attachments):[],st=0;if(!ot.length)return rt();function I(it){Z=it,++st===ot.length&&rt()}for(var tt in nt.data._attachments)Object.prototype.hasOwnProperty.call(nt.data._attachments,tt)&&Rr(nt.data._attachments[tt],B,I)})}(m,r._meta.blobSupport?"blob":"base64",function($){if($)return i($);!function(){var B=Ut(o,[St,"by-sequence","attach-store","local-store","attach-seq-store",Lt],"readwrite");if(B.error)return i(B.error);(d=B.txn).onabort=Kt(i),d.ontimeout=Kt(i),d.oncomplete=K,c=d.objectStore(St),l=d.objectStore("by-sequence"),p=d.objectStore("attach-store"),y=d.objectStore("attach-seq-store"),(s=d.objectStore(Lt)).get(Lt).onsuccess=function(U){q=U.target.result,G()},function(U){var Z=[];if(m.forEach(function(nt){nt.data&&nt.data._attachments&&Object.keys(nt.data._attachments).forEach(function(ot){var st=nt.data._attachments[ot];st.stub&&Z.push(st.digest)})}),!Z.length)return U();var ft,rt=0;Z.forEach(function(nt){var ot,st;st=function(ot){ot&&!ft&&(ft=ot),++rt===Z.length&&U(ft)},p.get(ot=nt).onsuccess=function(I){if(I.target.result)st();else{var tt=_t(lr,"unknown stub attachment with digest "+ot);tt.status=412,st(tt)}}})}(function(U){if(U)return b=!0,i(U);!function(){if(m.length)for(var Z=0,nt=0,ot=m.length;nt<ot;nt++){var st=m[nt];st._id&&Wt(st._id)?ft():c.get(st.metadata.id).onsuccess=rt}function ft(){++Z===m.length&&function Ur(t,e,n,r,o,i,d,c,l){t=t||1e3;var p=c.new_edits,y=new C,s=0,h=e.length;function q(){++s===h&&l&&l()}e.forEach(function(m,R){if(m._id&&Wt(m._id))n[m._deleted?"_removeLocal":"_putLocal"](m,{ctx:o},function(A,S){i[R]=A||S,q()});else{var x=m.metadata.id;y.has(x)?(h--,y.get(x).push([m,R])):y.set(x,[[m,R]])}}),y.forEach(function(m,R){var J=0;function x(){++J<m.length?A():q()}function A(){var S=m[J],_=S[0],j=S[1];if(r.has(R))!function Nr(t,e,n,r,o,i,d,c){if(function(S,_){for(var j,b=S.slice(),w=_.split("-"),z=parseInt(w[0],10),G=w[1];j=b.pop();){if(j.pos===z&&j.ids[0]===G)return!0;for(var K=j.ids[2],N=0,D=K.length;N<D;N++)b.push({pos:j.pos+1,ids:K[N]})}return!1}(e.rev_tree,n.metadata.rev)&&!c)return r[o]=n,i();var l=e.winningRev||Gt(e),p="deleted"in e?e.deleted:Jt(e,l),y="deleted"in n.metadata?n.metadata.deleted:Jt(n.metadata),s=/^1-/.test(n.metadata.rev);if(p&&!y&&c&&s){var h=n.data;h._rev=l,h._id=n.metadata.id,n=Tn(h,c)}var q=An(e.rev_tree,n.metadata.rev_tree[0],t);if(c&&(p&&y&&"new_leaf"!==q.conflicts||!p&&"new_leaf"!==q.conflicts||p&&!y&&"new_branch"===q.conflicts)){var m=_t(ee);return r[o]=m,i()}var R=n.metadata.rev;n.metadata.rev_tree=q.tree,n.stemmedRevs=q.stemmedRevs||[],e.rev_map&&(n.metadata.rev_map=e.rev_map);var J=Gt(n.metadata),x=Jt(n.metadata,J),A=p===x?0:p<x?-1:1;d(n,J,x,R===J?x:Jt(n.metadata,R),!0,A,o,i)}(t,r.get(R),_,i,j,x,d,p);else{var b=An([],_.metadata.rev_tree[0],t);_.metadata.rev_tree=b.tree,_.stemmedRevs=b.stemmedRevs||[],function(w,z,G){var K=Gt(w.metadata),N=Jt(w.metadata,K);if("was_delete"in c&&N)return i[z]=_t(Rt,"deleted"),G();if(p&&"missing"===w.metadata.rev_tree[0].ids[1].status){var D=_t(ee);return i[z]=D,G()}d(w,K,N,N,!1,N?0:1,z,G)}(_,j,x)}}A()})}(t.revs_limit,m,r,j,d,_,N,n,z)}function rt(I){var tt=Xt(I.target.result);tt&&j.set(tt.id,tt),ft()}}()})}()})}(i,x,A,o,l,y(S))},o._get=function(x,A,S){var _,j,b,w=A.ctx;if(!w){var z=Ut(l,[St,"by-sequence","attach-store"],"readonly");if(z.error)return S(z.error);w=z.txn}function G(){S(b,{doc:_,metadata:j,ctx:w})}w.objectStore(St).get(x).onsuccess=function(K){if(!(j=Xt(K.target.result)))return b=_t(Rt,"missing"),G();var N;if(A.rev)N=A.latest?function(B,U){for(var Z,ft=U.rev_tree.slice();Z=ft.pop();){var rt=Z.pos,nt=Z.ids,ot=nt[0],st=nt[1],I=nt[2],tt=0===I.length,it=Z.history?Z.history.slice():[];if(it.push({id:ot,pos:rt,opts:st}),tt)for(var ut=0,kt=it.length;ut<kt;ut++){var vt=it[ut];if(vt.pos+"-"+vt.id===B)return rt+"-"+ot}for(var bt=0,qt=I.length;bt<qt;bt++)ft.push({pos:rt+1,ids:I[bt],history:it})}throw new Error("Unable to resolve latest revision for id "+U.id+", rev "+B)}(A.rev,j):A.rev;else if(N=j.winningRev,Jt(j))return b=_t(Rt,"deleted"),G();var D=w.objectStore("by-sequence"),$=j.id+"::"+N;D.index("_doc_id_rev").get($).onsuccess=function(B){if((_=B.target.result)&&(_=me(_)),!_)return b=_t(Rt,"missing"),G();G()}}},o._getAttachment=function(x,A,S,_,j){var b;if(_.ctx)b=_.ctx;else{var w=Ut(l,[St,"by-sequence","attach-store"],"readonly");if(w.error)return j(w.error);b=w.txn}var z=S.digest,G=S.content_type;b.objectStore("attach-store").get(z).onsuccess=function(K){Mn(K.target.result.body,G,_.binary,function(N){j(null,N)})}},o._info=function(x){var A,S,_=Ut(l,[Lt,"by-sequence"],"readonly");if(_.error)return x(_.error);var j=_.txn;j.objectStore(Lt).get(Lt).onsuccess=function(b){S=b.target.result.docCount},j.objectStore("by-sequence").openCursor(null,"prev").onsuccess=function(b){var w=b.target.result;A=w?w.key:0},j.oncomplete=function(){x(null,{doc_count:S,update_seq:A,idb_attachment_format:o._meta.blobSupport?"binary":"base64"})}},o._allDocs=function(x,A){!function Jr(t,e,n){var r,o,l="keys"in t&&t.keys,p=t.skip||0,y="number"==typeof t.limit?t.limit:-1;if(!l&&(o=(r=function(N,D,$,B,U){try{if(N&&D)return U?IDBKeyRange.bound(D,N,!$,!1):IDBKeyRange.bound(N,D,!1,!$);if(N)return U?IDBKeyRange.upperBound(N):IDBKeyRange.lowerBound(N);if(D)return U?IDBKeyRange.lowerBound(D,!$):IDBKeyRange.upperBound(D,!$);if(B)return IDBKeyRange.only(B)}catch(Z){return{error:Z}}return null}("startkey"in t&&t.startkey,"endkey"in t&&t.endkey,!1!==t.inclusive_end,"key"in t&&t.key,t.descending))&&r.error)&&("DataError"!==o.name||0!==o.code))return n(_t(Ee,o.name));var h=[St,"by-sequence",Lt];t.attachments&&h.push("attach-store");var q=Ut(e,h,"readonly");if(q.error)return n(q.error);var m=q.txn;m.oncomplete=function(){t.attachments?Ve(b,t.binary).then(K):K()},m.onabort=Kt(n);var R,J,x,N,D,$,B,U,A=m.objectStore(St),S=m.objectStore("by-sequence"),_=m.objectStore(Lt),j=S.index("_doc_id_rev"),b=[];function w(N,D){var B,U,$={id:D.id,key:D.id,value:{rev:N}};D.deleted?l&&(b.push($),$.value.deleted=!0,$.doc=null):p--<=0&&(b.push($),t.include_docs&&(U=$,j.get((B=D).id+"::"+N).onsuccess=function(rt){if(U.doc=me(rt.target.result)||{},t.conflicts){var nt=Ne(B);nt.length&&(U.doc._conflicts=nt)}Rn(U.doc,t,m)}))}function z(N){for(var D=0,$=N.length;D<$&&b.length!==y;D++){var B=N[D];if(B.error&&l)b.push(B);else{var U=Xt(B);w(U.winningRev,U)}}}function G(N,D,$){$&&(z(D),b.length<y&&$.continue())}function K(){var N={total_rows:R,offset:t.skip,rows:b};t.update_seq&&void 0!==J&&(N.update_seq=J),n(null,N)}_.get(Lt).onsuccess=function(N){R=N.target.result.docCount},t.update_seq&&(x=function(N){N.target.result&&N.target.result.length>0&&(J=N.target.result[0])},S.openCursor(null,"prev").onsuccess=function(N){var D=N.target.result,$=void 0;return D&&D.key&&($=D.key),x({target:{result:[$]}})}),o||0===y||(l?(N=t.keys,D=A,$=G,B=new Array(N.length),U=0,N.forEach(function(Z,ft){D.get(Z).onsuccess=function(rt){B[ft]=rt.target.result?rt.target.result:{key:Z,error:"not_found"},++U===N.length&&$(N,B,{})}})):-1===y?function(N,D,$){if("function"!=typeof N.getAll){var B=[];N.openCursor(D).onsuccess=function(U){var Z=U.target.result;Z?(B.push(Z.value),Z.continue()):$({target:{result:B}})}}else N.getAll(D).onsuccess=$}(A,r,function(N){var D=N.target.result;t.descending&&(D=D.reverse()),z(D)}):Un(A,r,t.descending,y+p,G))}(x,l,y(A))},o._changes=function(x){return function zr(t,e,n,r){if((t=lt(t)).continuous){var o=n+":"+ge();return le.addListener(n,o,e,t),le.notify(n),{cancel:function(){le.removeListener(n,o)}}}var i=t.doc_ids&&new L(t.doc_ids);t.since=t.since||0;var d=t.since,c="limit"in t?t.limit:-1;0===c&&(c=1);var l,p,y,s,h=[],q=0,m=Pe(t),R=new C;function J(_,j,b,w){return b.seq!==j?w():b.winningRev===_._rev?w(b,_):void(s.get(_._id+"::"+b.winningRev).onsuccess=function(G){w(b,me(G.target.result))})}function x(){t.complete(null,{results:h,last_seq:d})}var A=[St,"by-sequence"];t.attachments&&A.push("attach-store");var S=Ut(r,A,"readonly");if(S.error)return t.complete(S.error);(l=S.txn).onabort=Kt(t.complete),l.oncomplete=function(){!t.continuous&&t.attachments?Ve(h).then(x):x()},p=l.objectStore("by-sequence"),y=l.objectStore(St),s=p.index("_doc_id_rev"),Un(p,t.since&&!t.descending?IDBKeyRange.lowerBound(t.since,!0):null,t.descending,c,function(_,j,b){if(b&&_.length){var w=new Array(_.length),z=new Array(_.length),G=0;j.forEach(function(N,D){!function($,B,U){if(i&&!i.has($._id))return U();var Z=R.get($._id);if(Z)return J($,B,Z,U);y.get($._id).onsuccess=function(ft){Z=Xt(ft.target.result),R.set($._id,Z),J($,B,Z,U)}}(me(N),_[D],function($,B){z[D]=$,w[D]=B,++G===_.length&&function(){for(var U=[],Z=0,ft=w.length;Z<ft&&q!==c;Z++){var rt=w[Z];rt&&U.push(K(z[Z],rt))}Promise.all(U).then(function(ot){for(var st=0,I=ot.length;st<I;st++)ot[st]&&t.onChange(ot[st])}).catch(t.complete),q!==c&&b.continue()}()})})}function K(N,D){var $=t.processChange(D,N,t);d=$.seq=N.seq;var B=m($);return"object"==typeof B?Promise.reject(B):B?(q++,t.return_docs&&h.push($),t.attachments&&t.include_docs?new Promise(function(U){Rn(D,t,l,function(){Ve([$],t.binary).then(function(){U($)})})}):Promise.resolve($)):Promise.resolve()}})}(x,o,c,l)},o._close=function(x){l.close(),ie.delete(c),x()},o._getRevisionTree=function(x,A){var S=Ut(l,[St],"readonly");if(S.error)return A(S.error);S.txn.objectStore(St).get(x).onsuccess=function(_){var j=Xt(_.target.result);j?A(null,j.rev_tree):A(_t(Rt))}},o._doCompaction=function(x,A,S){var _=Ut(l,[St,"by-sequence","attach-store","attach-seq-store"],"readwrite");if(_.error)return S(_.error);var j=_.txn;j.objectStore(St).get(x).onsuccess=function(b){var w=Xt(b.target.result);Qt(w.rev_tree,function(K,N,D,$,B){-1!==A.indexOf(N+"-"+D)&&(B.status="missing")}),Nn(A,x,j);var z=w.winningRev,G=w.deleted;j.objectStore(St).put(ze(w,z,G))},j.onabort=Kt(S),j.oncomplete=function(){S()}},o._getLocal=function(x,A){var S=Ut(l,["local-store"],"readonly");if(S.error)return A(S.error);var _=S.txn.objectStore("local-store").get(x);_.onerror=Kt(A),_.onsuccess=function(j){var b=j.target.result;b?(delete b._doc_id_rev,A(null,b)):A(_t(Rt))}},o._putLocal=function(x,A,S){"function"==typeof A&&(S=A,A={}),delete x._revisions;var _=x._rev,j=x._id;x._rev=_?"0-"+(parseInt(_.split("-")[1],10)+1):"0-1";var b,w=A.ctx;if(!w){var z=Ut(l,["local-store"],"readwrite");if(z.error)return S(z.error);(w=z.txn).onerror=Kt(S),w.oncomplete=function(){b&&S(null,b)}}var G,K=w.objectStore("local-store");_?(G=K.get(j)).onsuccess=function(N){var D=N.target.result;D&&D._rev===_?K.put(x).onsuccess=function(){b={ok:!0,id:x._id,rev:x._rev},A.ctx&&S(null,b)}:S(_t(ee))}:((G=K.add(x)).onerror=function(N){S(_t(ee)),N.preventDefault(),N.stopPropagation()},G.onsuccess=function(){b={ok:!0,id:x._id,rev:x._rev},A.ctx&&S(null,b)})},o._removeLocal=function(x,A,S){"function"==typeof A&&(S=A,A={});var _,j=A.ctx;if(!j){var b=Ut(l,["local-store"],"readwrite");if(b.error)return S(b.error);(j=b.txn).oncomplete=function(){_&&S(null,_)}}var w=x._id,z=j.objectStore("local-store"),G=z.get(w);G.onerror=Kt(S),G.onsuccess=function(K){var N=K.target.result;N&&N._rev===x._rev?(z.delete(w),_={ok:!0,id:w,rev:"0-0"},A.ctx&&S(null,_)):S(_t(Rt))}},o._destroy=function(x,A){le.removeAllListeners(c);var S=Ye.get(c);S&&S.result&&(S.result.close(),ie.delete(c));var _=indexedDB.deleteDatabase(c);_.onsuccess=function(){Ye.delete(c),It()&&c in localStorage&&delete localStorage[c],A(null,{ok:!0})},_.onerror=Kt(A)};var R=ie.get(c);if(R)return l=R.idb,o._meta=R.global,E(function(){d(null,o)});var J=indexedDB.open(c,5);Ye.set(c,J),J.onupgradeneeded=function(x){var A=x.target.result;if(x.oldVersion<1)return function(b){var w=b.createObjectStore(St,{keyPath:"id"});b.createObjectStore("by-sequence",{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),b.createObjectStore("attach-store",{keyPath:"digest"}),b.createObjectStore(Lt,{keyPath:"id",autoIncrement:!1}),b.createObjectStore("detect-blob-support"),w.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),b.createObjectStore("local-store",{keyPath:"_id"});var z=b.createObjectStore("attach-seq-store",{autoIncrement:!0});z.createIndex("seq","seq"),z.createIndex("digestSeq","digestSeq",{unique:!0})}(A);var w,S=x.currentTarget.transaction;x.oldVersion<3&&A.createObjectStore("local-store",{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),x.oldVersion<4&&((w=A.createObjectStore("attach-seq-store",{autoIncrement:!0})).createIndex("seq","seq"),w.createIndex("digestSeq","digestSeq",{unique:!0}));var _=[s,h,q,m],j=x.oldVersion;!function b(){var w=_[j-1];j++,w&&w(S,b)}()},J.onsuccess=function(x){(l=x.target.result).onversionchange=function(){l.close(),ie.delete(c)},l.onabort=function(K){Ct("error","Database has a global failure",K.target.error),p=K.target.error,l.close(),ie.delete(c)};var A,S,_,j,N,K,b=l.transaction([Lt,"detect-blob-support",St],"readwrite"),w=!1;function z(){void 0!==_&&w&&(o._meta={name:c,instanceId:j,blobSupport:_},ie.set(c,{idb:l,global:o._meta}),d(null,o))}function G(){if(void 0!==S&&void 0!==A){var K=c+"_id";K in A?j=A[K]:A[K]=j=ge(),A.docCount=S,b.objectStore(Lt).put(A)}}b.objectStore(Lt).get(Lt).onsuccess=function(K){A=K.target.result||{id:Lt},G()},N=function(K){S=K,G()},b.objectStore(St).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(D){N(D.target.result)},We||(K=b,We=new Promise(function(N){var D=De([""]),$=K.objectStore("detect-blob-support").put(D,"key");$.onsuccess=function(){var B=navigator.userAgent.match(/Chrome\/(\d+)/),U=navigator.userAgent.match(/Edge\//);N(U||!B||parseInt(B[1],10)>=43)},$.onerror=K.onabort=function(B){B.preventDefault(),B.stopPropagation(),N(!1)}}).catch(function(){return!1})),We.then(function(K){_=K,z()}),b.oncomplete=function(){w=!0,z()},b.onabort=Kt(d)},J.onerror=function(x){var A=x.target.error&&x.target.error.message;A?-1!==A.indexOf("stored database is a higher version")&&(A=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):A="Failed to open indexedDB, are you in private browsing mode?",Ct("error",A),d(_t(Ee,A))}}(n,t,function(d,c){(function(l,p,y,s){try{l(p,y)}catch(h){s.emit("error",h)}})(o,d,c,i),Ge=!1,E(function(){Fn()})})}),Fn()}Kn.valid=function(){try{return"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}};var He={};function Xe(t){var e=t.doc||t.ok,n=e&&e._attachments;n&&Object.keys(n).forEach(function(r){var o=n[r];o.data=Be(o.data,o.content_type)})}function Zt(t){return/^_design/.test(t)?"_design/"+encodeURIComponent(t.slice(8)):/^_local/.test(t)?"_local/"+encodeURIComponent(t.slice(7)):encodeURIComponent(t)}function Jn(t){return t._attachments&&Object.keys(t._attachments)?Promise.all(Object.keys(t._attachments).map(function(e){var n=t._attachments[e];if(n.data&&"string"!=typeof n.data)return new Promise(function(r){Te(n.data,r)}).then(function(r){n.data=r})})):Promise.resolve()}function xt(t,e){return be(t,t.db+"/"+e)}function be(t,e){return t.protocol+"://"+t.host+(t.port?":"+t.port:"")+"/"+t.path+(t.path?"/":"")+e}function we(t){return"?"+Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")}function Ze(t,e){var n=this,r=function Vr(t,e){if(function(i){if(!i.prefix)return!1;var d=gn(i.prefix).protocol;return"http"===d||"https"===d}(e)){var n=e.name.substr(e.prefix.length);t=e.prefix.replace(/\/?$/,"/")+encodeURIComponent(n)}var r=gn(t);(r.user||r.password)&&(r.auth={username:r.user,password:r.password});var o=r.path.replace(/(^\/|\/$)/g,"").split("/");return r.db=o.pop(),-1===r.db.indexOf("%")&&(r.db=encodeURIComponent(r.db)),r.path=o.join("/"),r}(t.name,t),o=xt(r,"");t=lt(t);var i,d=function(s,h){if((h=h||{}).headers=h.headers||new re,h.credentials="include",t.auth||r.auth){var q=t.auth||r.auth,R=se(unescape(encodeURIComponent(q.username+":"+q.password)));h.headers.set("Authorization","Basic "+R)}var x,A,S,_,j,J=t.headers||{};return Object.keys(J).forEach(function(x){h.headers.append(x,J[x])}),x=h,S=-1!==(A="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"").indexOf("msie"),_=-1!==A.indexOf("trident"),j=-1!==A.indexOf("edge"),(S||_||j)&&(!("method"in x)||"GET"===x.method)&&(s+=(-1===s.indexOf("?")?"?":"&")+"_nonce="+Date.now()),(t.fetch||xn)(s,h)};function c(s,h){return Y(s,H(function(q){p().then(function(){return h.apply(this,q)}).catch(function(m){q.pop()(m)})})).bind(n)}function l(s,h,q){var m={};return(h=h||{}).headers=h.headers||new re,h.headers.get("Content-Type")||h.headers.set("Content-Type","application/json"),h.headers.get("Accept")||h.headers.set("Accept","application/json"),d(s,h).then(function(R){return m.ok=R.ok,m.status=R.status,R.json()}).then(function(R){if(m.data=R,!m.ok){m.data.status=m.status;var J=ne(m.data);if(q)return q(J);throw J}if(Array.isArray(m.data)&&(m.data=m.data.map(function(x){return x.error||x.missing?ne(x):x})),!q)return m;q(null,m.data)})}function p(){return t.skip_setup?Promise.resolve():i||((i=l(o).catch(function(s){return s&&s.status&&404===s.status?(Se(404,"PouchDB is just detecting if the remote exists."),l(o,{method:"PUT"})):Promise.reject(s)}).catch(function(s){return!(!s||!s.status||412!==s.status)||Promise.reject(s)})).catch(function(){i=null}),i)}function y(s){return s.split("/").map(encodeURIComponent).join("/")}E(function(){e(null,n)}),n._remote=!0,n.type=function(){return"http"},n.id=c("id",function(s){d(be(r,"")).then(function(h){return h.json()}).catch(function(){return{}}).then(function(h){var q=h&&h.uuid?h.uuid+r.db:xt(r,"");s(null,q)})}),n.compact=c("compact",function(s,h){"function"==typeof s&&(h=s,s={}),s=lt(s),l(xt(r,"_compact"),{method:"POST"}).then(function(){!function q(){n.info(function(m,R){R&&!R.compact_running?h(null,{ok:!0}):setTimeout(q,s.interval||200)})}()})}),n.bulkGet=Y("bulkGet",function(s,h){var q=this;function m(A){var S={};s.revs&&(S.revs=!0),s.attachments&&(S.attachments=!0),s.latest&&(S.latest=!0),l(xt(r,"_bulk_get"+we(S)),{method:"POST",body:JSON.stringify({docs:s.docs})}).then(function(_){s.attachments&&s.binary&&_.data.results.forEach(function(j){j.docs.forEach(Xe)}),A(null,_.data)}).catch(A)}function R(){var A=Math.ceil(s.docs.length/50),S=0,_=new Array(A);function j(z){return function(G,K){_[z]=K.results,++S===A&&h(null,{results:ve(_)})}}for(var b=0;b<A;b++){var w=at(s,["revs","attachments","binary","latest"]);w.docs=s.docs.slice(50*b,Math.min(s.docs.length,50*(b+1))),wt(q,w,j(b))}}var J=be(r,""),x=He[J];"boolean"!=typeof x?m(function(A,S){A?(He[J]=!1,Se(A.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),R()):(He[J]=!0,h(null,S))}):x?m(h):R()}),n._info=function(s){p().then(function(){return d(xt(r,""))}).then(function(h){return h.json()}).then(function(h){h.host=xt(r,""),s(null,h)}).catch(s)},n.fetch=function(s,h){return p().then(function(){var q="/"===s.substring(0,1)?be(r,s.substring(1)):xt(r,s);return d(q,h)})},n.get=c("get",function(s,h,q){"function"==typeof h&&(q=h,h={});var m={};function R(J){var S,x=J._attachments,A=x&&Object.keys(x);if(x&&A.length)return S=A.map(function(S){return function(){return j=x[_=S],b=Zt(J._id)+"/"+y(_)+"?rev="+J._rev,d(xt(r,b)).then(function(w){return"buffer"in w?w.buffer():w.blob()}).then(function(w){if(h.binary){var z=Object.getOwnPropertyDescriptor(w.__proto__,"type");return z&&!z.set||(w.type=j.content_type),w}return new Promise(function(G){Te(w,G)})}).then(function(w){delete j.stub,delete j.length,j.data=w});var _,j,b}}),new Promise(function(j,b){var w,z=0,G=0,K=0,N=S.length;function D(){++K===N?w?b(w):j():U()}function $(){z--,D()}function B(Z){z--,w=w||Z,D()}function U(){for(;z<5&&G<N;)z++,S[G++]().then($,B)}U()})}(h=lt(h)).revs&&(m.revs=!0),h.revs_info&&(m.revs_info=!0),h.latest&&(m.latest=!0),h.open_revs&&("all"!==h.open_revs&&(h.open_revs=JSON.stringify(h.open_revs)),m.open_revs=h.open_revs),h.rev&&(m.rev=h.rev),h.conflicts&&(m.conflicts=h.conflicts),h.update_seq&&(m.update_seq=h.update_seq),s=Zt(s),l(xt(r,s+we(m))).then(function(J){return Promise.resolve().then(function(){if(h.attachments)return x=J.data,Array.isArray(x)?Promise.all(x.map(function(A){if(A.ok)return R(A.ok)})):R(x);var x}).then(function(){q(null,J.data)})}).catch(function(J){J.docId=s,q(J)})}),n.remove=c("remove",function(s,h,q,m){var R;"string"==typeof h?(R={_id:s,_rev:h},"function"==typeof q&&(m=q,q={})):(R=s,"function"==typeof h?(m=h,q={}):(m=q,q=h));var J=R._rev||q.rev;l(xt(r,Zt(R._id))+"?rev="+J,{method:"DELETE"},m).catch(m)}),n.getAttachment=c("getAttachment",function(s,h,q,m){"function"==typeof q&&(m=q,q={});var R,J=q.rev?"?rev="+q.rev:"",x=xt(r,Zt(s))+"/"+y(h)+J;d(x,{method:"GET"}).then(function(A){if(R=A.headers.get("content-type"),A.ok)return void 0===M||M.browser||"function"!=typeof A.buffer?A.blob():A.buffer();throw A}).then(function(A){void 0===M||M.browser||(A.type=R),m(null,A)}).catch(function(A){m(A)})}),n.removeAttachment=c("removeAttachment",function(s,h,q,m){l(xt(r,Zt(s)+"/"+y(h))+"?rev="+q,{method:"DELETE"},m).catch(m)}),n.putAttachment=c("putAttachment",function(s,h,q,m,R,J){"function"==typeof R&&(J=R,R=m,m=q,q=null);var x=Zt(s)+"/"+y(h),A=xt(r,x);if(q&&(A+="?rev="+q),"string"==typeof m){var S;try{S=$e(m)}catch(_){return J(_t(ln,"Attachment is not a valid base64 string"))}m=S?Ie(S,R):""}l(A,{headers:new re({"Content-Type":R}),method:"PUT",body:m},J).catch(J)}),n._bulkDocs=function(s,h,q){s.new_edits=h.new_edits,p().then(function(){return Promise.all(s.docs.map(Jn))}).then(function(){return l(xt(r,"_bulk_docs"),{method:"POST",body:JSON.stringify(s)},q)}).catch(q)},n._put=function(s,h,q){p().then(function(){return Jn(s)}).then(function(){return l(xt(r,Zt(s._id)),{method:"PUT",body:JSON.stringify(s)})}).then(function(m){q(null,m.data)}).catch(function(m){m.docId=s&&s._id,q(m)})},n.allDocs=c("allDocs",function(s,h){"function"==typeof s&&(h=s,s={});var q,m={},R="GET";(s=lt(s)).conflicts&&(m.conflicts=!0),s.update_seq&&(m.update_seq=!0),s.descending&&(m.descending=!0),s.include_docs&&(m.include_docs=!0),s.attachments&&(m.attachments=!0),s.key&&(m.key=JSON.stringify(s.key)),s.start_key&&(s.startkey=s.start_key),s.startkey&&(m.startkey=JSON.stringify(s.startkey)),s.end_key&&(s.endkey=s.end_key),s.endkey&&(m.endkey=JSON.stringify(s.endkey)),void 0!==s.inclusive_end&&(m.inclusive_end=!!s.inclusive_end),void 0!==s.limit&&(m.limit=s.limit),void 0!==s.skip&&(m.skip=s.skip);var J=we(m);void 0!==s.keys&&(R="POST",q={keys:s.keys}),l(xt(r,"_all_docs"+J),{method:R,body:JSON.stringify(q)}).then(function(x){s.include_docs&&s.attachments&&s.binary&&x.data.rows.forEach(Xe),h(null,x.data)}).catch(h)}),n._changes=function(s){var h="batch_size"in s?s.batch_size:25;(s=lt(s)).continuous&&!("heartbeat"in s)&&(s.heartbeat=1e4);var q="timeout"in s?s.timeout:3e4;"timeout"in s&&s.timeout&&q-s.timeout<5e3&&(q=s.timeout+5e3),"heartbeat"in s&&s.heartbeat&&q-s.heartbeat<5e3&&(q=s.heartbeat+5e3);var m={};"timeout"in s&&s.timeout&&(m.timeout=s.timeout);var R=void 0!==s.limit&&s.limit,J=R;if(s.style&&(m.style=s.style),(s.include_docs||s.filter&&"function"==typeof s.filter)&&(m.include_docs=!0),s.attachments&&(m.attachments=!0),s.continuous&&(m.feed="longpoll"),s.seq_interval&&(m.seq_interval=s.seq_interval),s.conflicts&&(m.conflicts=!0),s.descending&&(m.descending=!0),s.update_seq&&(m.update_seq=!0),"heartbeat"in s&&s.heartbeat&&(m.heartbeat=s.heartbeat),s.filter&&"string"==typeof s.filter&&(m.filter=s.filter),s.view&&"string"==typeof s.view&&(m.filter="_view",m.view=s.view),s.query_params&&"object"==typeof s.query_params)for(var x in s.query_params)Object.prototype.hasOwnProperty.call(s.query_params,x)&&(m[x]=s.query_params[x]);var A,S="GET";s.doc_ids?(m.filter="_doc_ids",S="POST",A={doc_ids:s.doc_ids}):s.selector&&(m.filter="_selector",S="POST",A={selector:s.selector});var _,j=new qr,b=function(G,K){if(!s.aborted){m.since=G,"object"==typeof m.since&&(m.since=JSON.stringify(m.since)),s.descending?R&&(m.limit=J):m.limit=!R||J>h?h:J;var N=xt(r,"_changes"+we(m)),D={signal:j.signal,method:S,body:JSON.stringify(A)};_=G,s.aborted||p().then(function(){return l(N,D,K)}).catch(K)}},w={results:[]},z=function(G,K){if(!s.aborted){var N=0;if(K&&K.results){N=K.results.length,w.last_seq=K.last_seq;var D=null,$=null;"number"==typeof K.pending&&(D=K.pending),"string"!=typeof w.last_seq&&"number"!=typeof w.last_seq||($=w.last_seq),K.results=K.results.filter(function(U){J--;var Z=Pe(s)(U);return Z&&(s.include_docs&&s.attachments&&s.binary&&Xe(U),s.return_docs&&w.results.push(U),s.onChange(U,D,$)),Z})}else if(G)return s.aborted=!0,void s.complete(G);K&&K.last_seq&&(_=K.last_seq),(!s.continuous||R&&J<=0)&&(R&&J<=0||K&&N<h||s.descending)?s.complete(null,w):E(function(){b(_,z)})}};return b(s.since||0,z),{cancel:function(){s.aborted=!0,j.abort()}}},n.revsDiff=c("revsDiff",function(s,h,q){"function"==typeof h&&(q=h,h={}),l(xt(r,"_revs_diff"),{method:"POST",body:JSON.stringify(s)},q).catch(q)}),n._close=function(s){s()},n._destroy=function(s,h){l(xt(r,""),{method:"DELETE"}).then(function(q){h(null,q)}).catch(function(q){404===q.status?h(null,{ok:!0}):h(q)})}}function te(t){this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,te)}catch(e){}}function ke(t){this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,ke)}catch(e){}}function je(t){this.status=500,this.name="invalid_value",this.message=t,this.error=!0;try{Error.captureStackTrace(this,je)}catch(e){}}function zn(t,e){return e&&t.then(function(n){E(function(){e(null,n)})},function(n){E(function(){e(n)})}),t}function tn(t,e){return function(){var n=arguments,r=this;return t.add(function(){return e.apply(r,n)})}}function Vn(t){var e=new L(t),n=new Array(e.size),r=-1;return e.forEach(function(o){n[++r]=o}),n}function en(t){var e=new Array(t.size),n=-1;return t.forEach(function(r,o){e[++n]=o}),e}function Gn(t){return new je("builtin "+t+" function requires map values to be numbers or number arrays")}function nn(t){for(var e=0,n=0,r=t.length;n<r;n++){var o=t[n];if("number"!=typeof o){if(!Array.isArray(o))throw Gn("_sum");e="number"==typeof e?[e]:e;for(var i=0,d=o.length;i<d;i++){var c=o[i];if("number"!=typeof c)throw Gn("_sum");void 0===e[i]?e.push(c):e[i]+=c}}else"number"==typeof e?e+=o:e[0]+=o}return e}Ze.valid=function(){return!0},O(te,Error),O(ke,Error),O(je,Error);var Gr=Ct.bind(null,"log"),Qr=Array.isArray,Wr=JSON.parse;function Qn(t,e){return Le("return ("+t.replace(/;\s*$/,"")+");",{emit:e,sum:nn,log:Gr,isArray:Qr,toJSON:Wr})}function de(){this.promise=new Promise(function(t){t()})}function Wn(t){if(!t)return"undefined";switch(typeof t){case"function":case"string":return t.toString();default:return JSON.stringify(t)}}function Yn(t,e,n,r,o,i){var d,y,c=(y=r,Wn(n)+Wn(y)+"undefined");if(!o&&(d=t._cachedViews=t._cachedViews||{})[c])return d[c];var l=t.info().then(function(p){var y=p.db_name+"-mrview-"+(o?"temp":bn(c));return ye(t,"_local/"+i,function(s){s.views=s.views||{};var h=e;-1===h.indexOf("/")&&(h=e+"/"+e);var q=s.views[h]=s.views[h]||{};if(!q[y])return q[y]=!0,s}).then(function(){return t.registerDependentDatabase(y).then(function(s){var h=s.db;h.auto_compaction=!0;var q={name:y,db:h,sourceDB:t,adapter:t.adapter,mapFun:n,reduceFun:r};return q.db.get("_local/lastSeq").catch(function(m){if(404!==m.status)throw m}).then(function(m){return q.seq=m?m.seq:0,d&&q.db.once("destroyed",function(){delete d[c]}),q})})})});return d&&(d[c]=l),l}de.prototype.add=function(t){return this.promise=this.promise.catch(function(){}).then(function(){return t()}),this.promise},de.prototype.finish=function(){return this.promise};var Hn={},Xn=new de;function rn(t){return-1===t.indexOf("/")?[t,t]:t.split("/")}function Zn(t,e){try{t.emit("error",e)}catch(n){Ct("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),Ct("error",e)}}var Yr=function(t,e){return nn(e)},Hr=function(t,e){return e.length},Xr=function(t,e){return{sum:nn(e),min:Math.min.apply(null,e),max:Math.max.apply(null,e),count:e.length,sumsqr:function(n){for(var r=0,o=0,i=n.length;o<i;o++){var d=n[o];r+=d*d}return r}(e)}},tr=function(t,e,n,r){function o(_,j,b){try{j(b)}catch(w){Zn(_,w)}}function i(_,j,b,w,z){try{return{output:j(b,w,z)}}catch(G){return Zn(_,G),{error:G}}}function d(_,j){var b=At(_.key,j.key);return 0!==b?b:At(_.value,j.value)}function c(_,j,b){return b=b||0,"number"==typeof j?_.slice(b,j+b):b>0?_.slice(b):_}function l(_){var j=_.value;return j&&"object"==typeof j&&j._id||_.id}function p(_){return function(j){return _.include_docs&&_.attachments&&_.binary&&j.rows.forEach(function(w){var z=w.doc&&w.doc._attachments;z&&Object.keys(z).forEach(function(G){var K=z[G];z[G].data=Be(K.data,K.content_type)})}),j}}function y(_,j,b,w){var z=j[_];void 0!==z&&(w&&(z=encodeURIComponent(JSON.stringify(z))),b.push(_+"="+z))}function s(_){if(void 0!==_){var j=Number(_);return isNaN(j)||j!==parseInt(_,10)?_:j}}function h(_,j){var b=_.descending?"endkey":"startkey",w=_.descending?"startkey":"endkey";if(void 0!==_[b]&&void 0!==_[w]&&At(_[b],_[w])>0)throw new te("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(j.reduce&&!1!==_.reduce){if(_.include_docs)throw new te("{include_docs:true} is invalid for reduce");if(_.keys&&_.keys.length>1&&!_.group&&!_.group_level)throw new te("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(z){var G=function(K){if(K){if("number"!=typeof K)return new te('Invalid value for integer: "'+K+'"');if(K<0)return new te('Invalid value for positive integer: "'+K+'"')}}(_[z]);if(G)throw G})}function q(_){return function(j){if(404===j.status)return _;throw j}}function R(_){var j="string"==typeof _?_:_.name,b=Hn[j];return b||(b=Hn[j]=new de),b}function J(_,j){return tn(R(_),function(){return function(b,w){var z,G,K=function(t,e){if("function"==typeof t&&2===t.length){var n=t;return function(r){return n(r,e)}}return Qn(t.toString(),e)}(b.mapFun,function(nt,ot){var st={id:G._id,key:Yt(nt)};null!=ot&&(st.value=Yt(ot)),z.push(st)}),N=b.seq||0;let $=0;b.sourceDB.emit("indexing",{view:b.name,indexed_docs:$});var U=new de;function Z(){return b.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:N,limit:w.changes_batch_size}).then(ft)}function ft(nt){var ot=nt.results;if(ot.length){var st=function(tt){for(var it=new C,ut=0,kt=tt.length;ut<kt;ut++){var vt=tt[ut];if("_"!==vt.doc._id[0]){z=[],(G=vt.doc)._deleted||o(b.sourceDB,K,G),z.sort(d);var bt=rt(z);it.set(vt.doc._id,[bt,vt.changes])}N=vt.seq}return it}(ot);return U.add(function D(nt,ot){return function(){return I=nt,tt=ot,(st=b).db.get("_local/lastSeq").catch(q({_id:"_local/lastSeq",seq:0})).then(function(it){var ut=en(I);return Promise.all(ut.map(function(kt){return function m(_,j,b){var N,w="_local/doc_"+_,z={_id:w,keys:[]},G=b.get(_),K=G[0];return(N=G[1],1===N.length&&/^1-/.test(N[0].rev)?Promise.resolve(z):j.db.get(w).catch(q(z))).then(function(N){return(D=N,D.keys.length?j.db.allDocs({keys:D.keys,include_docs:!0}):Promise.resolve({rows:[]})).then(function(D){return function($,B){for(var U=[],Z=new L,ft=0,rt=B.rows.length;ft<rt;ft++){var nt=B.rows[ft].doc;if(nt&&(U.push(nt),Z.add(nt._id),nt._deleted=!K.has(nt._id),!nt._deleted)){var ot=K.get(nt._id);"value"in ot&&(nt.value=ot.value)}}var st=en(K);return st.forEach(function(I){if(!Z.has(I)){var tt={_id:I},it=K.get(I);"value"in it&&(tt.value=it.value),U.push(tt)}}),$.keys=Vn(st.concat($.keys)),U.push($),U}(N,D)});var D})}(kt,st,I)})).then(function(kt){var vt=ve(kt);return it.seq=tt,vt.push(it),st.db.bulkDocs({docs:vt})})});var st,I,tt}}(st,N)),$+=ot.length,b.sourceDB.emit("indexing",{view:b.name,last_seq:nt.last_seq,results_count:ot.length,indexed_docs:$}),ot.length<w.changes_batch_size?void 0:Z()}}function rt(nt){for(var ot,st=new C,I=0,tt=nt.length;I<tt;I++){var it=nt[I],ut=[it.key,it.id];I>0&&0===At(it.key,ot)&&ut.push(I),st.set(Nt(ut),it),ot=it.key}return st}return Z().then(function(){return U.finish()}).then(function(){b.seq=N})}(_,j)})()}function x(_,j){return tn(R(_),function(){return function(b,w){var z,G=b.reduceFun&&!1!==w.reduce,K=w.skip||0;function N(ot){return ot.include_docs=!0,b.db.allDocs(ot).then(function(st){return z=st.total_rows,st.rows.map(function(I){if("value"in I.doc&&"object"==typeof I.doc.value&&null!==I.doc.value){var tt=Object.keys(I.doc.value).sort(),it=["id","key","value"];if(!(tt<it||tt>it))return I.doc.value}var ut=function(kt){for(var vt=[],bt=[],qt=0;;){var Dt=kt[qt++];if("\0"!==Dt)switch(Dt){case"1":vt.push(null);break;case"2":vt.push("1"===kt[qt]),qt++;break;case"3":var Bt=Er(kt,qt);vt.push(Bt.num),qt+=Bt.length;break;case"4":for(var Tt="";;){var $t=kt[qt];if("\0"===$t)break;Tt+=$t,qt++}Tt=Tt.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"\x01").replace(/\u0002\u0002/g,"\x02"),vt.push(Tt);break;case"5":var Et={element:[],index:vt.length};vt.push(Et.element),bt.push(Et);break;case"6":var Mt={element:{},index:vt.length};vt.push(Mt.element),bt.push(Mt);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+Dt)}else{if(1===vt.length)return vt.pop();Pr(vt,bt)}}}(I.doc._id);return{key:ut[0],id:ut[1],value:"value"in I.doc?I.doc.value:null}})})}function D(ot){var st;if(st=G?function(tt,it,ut){0===ut.group_level&&delete ut.group_level;var kt=ut.group||ut.group_level,vt=function(t){var e=t.toString(),n=function(r){if(/^_sum/.test(r))return Yr;if(/^_count/.test(r))return Hr;if(/^_stats/.test(r))return Xr;if(/^_/.test(r))throw new Error(r+" is not a supported reduce function.")}(e);return n||Qn(e)}(tt.reduceFun),bt=[],qt=isNaN(ut.group_level)?Number.POSITIVE_INFINITY:ut.group_level;it.forEach(function(Et){var Mt=bt[bt.length-1],zt=kt?Et.key:null;if(kt&&Array.isArray(zt)&&(zt=zt.slice(0,qt)),Mt&&0===At(Mt.groupKey,zt))return Mt.keys.push([Et.key,Et.id]),void Mt.values.push(Et.value);bt.push({keys:[[Et.key,Et.id]],values:[Et.value],groupKey:zt})}),it=[];for(var Dt=0,Bt=bt.length;Dt<Bt;Dt++){var Tt=bt[Dt],$t=i(tt.sourceDB,vt,Tt.keys,Tt.values,!1);if($t.error&&$t.error instanceof je)throw $t.error;it.push({value:$t.error?null:$t.output,key:Tt.groupKey})}return{rows:c(it,ut.limit,ut.skip)}}(b,ot,w):void 0===w.keys?{total_rows:z,offset:K,rows:ot}:{total_rows:z,offset:K,rows:c(ot,w.limit,w.skip)},w.update_seq&&(st.update_seq=b.seq),w.include_docs){var I=Vn(ot.map(l));return b.sourceDB.allDocs({keys:I,include_docs:!0,conflicts:w.conflicts,attachments:w.attachments,binary:w.binary}).then(function(tt){var it=new C;return tt.rows.forEach(function(ut){it.set(ut.id,ut.doc)}),ot.forEach(function(ut){var kt=l(ut),vt=it.get(kt);vt&&(ut.doc=vt)}),st})}return st}if(void 0===w.keys||w.keys.length||(w.limit=0,delete w.keys),void 0!==w.keys){var $=w.keys.map(function(ot){var st={startkey:Nt([ot]),endkey:Nt([ot,{}])};return w.update_seq&&(st.update_seq=!0),N(st)});return Promise.all($).then(ve).then(D)}var B,U,Z={descending:w.descending};if(w.update_seq&&(Z.update_seq=!0),"start_key"in w&&(B=w.start_key),"startkey"in w&&(B=w.startkey),"end_key"in w&&(U=w.end_key),"endkey"in w&&(U=w.endkey),void 0!==B&&(Z.startkey=Nt(w.descending?[B,{}]:[B])),void 0!==U){var ft=!1!==w.inclusive_end;w.descending&&(ft=!ft),Z.endkey=Nt(ft?[U,{}]:[U])}if(void 0!==w.key){var rt=Nt([w.key]),nt=Nt([w.key,{}]);Z.descending?(Z.endkey=rt,Z.startkey=nt):(Z.startkey=rt,Z.endkey=nt)}return G||("number"==typeof w.limit&&(Z.limit=w.limit),Z.skip=K),N(Z).then(D)}(_,j)})()}var S;return{query:function(_,j,b){var G,w=this;"function"==typeof j&&(b=j,j={}),j=j?((G=j).group_level=s(G.group_level),G.limit=s(G.limit),G.skip=s(G.skip),G):{},"function"==typeof _&&(_={map:_});var z=Promise.resolve().then(function(){return function A(_,j,b){if("function"==typeof _._query)return D=_,$=j,B=b,new Promise(function(U,Z){D._query($,B,function(ft,rt){if(ft)return Z(ft);U(rt)})});var D,$,B;if(Ft(_))return function(D,$,B){var U,Z,ft,rt=[],nt="GET";if(y("reduce",B,rt),y("include_docs",B,rt),y("attachments",B,rt),y("limit",B,rt),y("descending",B,rt),y("group",B,rt),y("group_level",B,rt),y("skip",B,rt),y("stale",B,rt),y("conflicts",B,rt),y("startkey",B,rt,!0),y("start_key",B,rt,!0),y("endkey",B,rt,!0),y("end_key",B,rt,!0),y("inclusive_end",B,rt),y("key",B,rt,!0),y("update_seq",B,rt),rt=""===(rt=rt.join("&"))?"":"?"+rt,void 0!==B.keys){var ot="keys="+encodeURIComponent(JSON.stringify(B.keys));ot.length+rt.length+1<=2e3?rt+=("?"===rt[0]?"&":"?")+ot:(nt="POST","string"==typeof $?U={keys:B.keys}:$.keys=B.keys)}if("string"==typeof $){var st=rn($);return D.fetch("_design/"+st[0]+"/_view/"+st[1]+rt,{headers:new re({"Content-Type":"application/json"}),method:nt,body:JSON.stringify(U)}).then(function(I){return Z=I.ok,ft=I.status,I.json()}).then(function(I){if(!Z)throw I.status=ft,ne(I);return I.rows.forEach(function(tt){if(tt.value&&tt.value.error&&"builtin_reduce_error"===tt.value.error)throw new Error(tt.reason)}),I}).then(p(B))}return U=U||{},Object.keys($).forEach(function(I){U[I]=Array.isArray($[I])?$[I]:$[I].toString()}),D.fetch("_temp_view"+rt,{headers:new re({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(U)}).then(function(I){return Z=I.ok,ft=I.status,I.json()}).then(function(I){if(!Z)throw I.status=ft,ne(I);return I}).then(p(B))}(_,j,b);var w={changes_batch_size:_.__opts.view_update_changes_batch_size||50};if("string"!=typeof j)return h(b,j),Xn.add(function(){return Yn(_,"temp_view/temp_view",j.map,j.reduce,!0,t).then(function(D){return $=J(D,w).then(function(){return x(D,b)}),B=function(){return D.db.destroy()},$.then(function(U){return B().then(function(){return U})},function(U){return B().then(function(){throw U})});var $,B})}),Xn.finish();var z=j,G=rn(z),N=G[1];return _.get("_design/"+G[0]).then(function(D){var $=D.views&&D.views[N];if(!$)throw new ke("ddoc "+D._id+" has no view named "+N);return function(t,e){var n=t.views&&t.views[e];if("string"!=typeof n.map)throw new ke("ddoc "+t._id+" has no string view named "+e+", instead found object of type: "+typeof n.map)}(D,N),h(b,$),Yn(_,z,$.map,$.reduce,!1,t).then(function(B){return"ok"===b.stale||"update_after"===b.stale?("update_after"===b.stale&&E(function(){J(B,w)}),x(B,b)):J(B,w).then(function(){return x(B,b)})})})}(w,_,j)});return zn(z,b),z},viewCleanup:(S=function(){var j,_=this;return"function"==typeof _._viewCleanup?(j=_,new Promise(function(b,w){j._viewCleanup(function(z,G){if(z)return w(z);b(G)})})):Ft(_)?function(j){return j.fetch("_view_cleanup",{headers:new re({"Content-Type":"application/json"}),method:"POST"}).then(function(b){return b.json()})}(_):function(j){return j.get("_local/"+t).then(function(b){var w=new C;Object.keys(b.views).forEach(function(G){var K=rn(G),N="_design/"+K[0],D=K[1],$=w.get(N);$||($=new L,w.set(N,$)),$.add(D)});var z={keys:en(w),include_docs:!0};return j.allDocs(z).then(function(G){var K={};G.rows.forEach(function(D){var $=D.key.substring(8);w.get(D.key).forEach(function(B){var U=$+"/"+B;b.views[U]||(U=B);var Z=Object.keys(b.views[U]),ft=D.doc&&D.doc.views&&D.doc.views[B];Z.forEach(function(rt){K[rt]=K[rt]||ft})})});var N=Object.keys(K).filter(function(D){return!K[D]}).map(function(D){return tn(R(D),function(){return new j.constructor(D,j.__opts).destroy()})()});return Promise.all(N).then(function(){return{ok:!0}})})},q({ok:!0}))}(_)},H(function(_){var j=_.pop(),b=S.apply(this,_);return"function"==typeof j&&zn(b,j),b}))}}("mrviews"),Zr={query:function(t,e,n){return tr.query.call(this,t,e,n)},viewCleanup:function(t){return tr.viewCleanup.call(this,t)}};function er(t){return/^1-/.test(t)}function nr(t,e){var n=Object.keys(e._attachments);return Promise.all(n.map(function(r){return t.getAttachment(e._id,r,{rev:e._rev})}))}function on(t,e,n,r,o){return t.get(e).catch(function(i){if(404===i.status)return"http"!==t.adapter&&"https"!==t.adapter||Se(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:e,history:[],replicator:"pouchdb",version:1};throw i}).then(function(i){if(!o.cancelled&&i.last_seq!==n)return i.history=(i.history||[]).filter(function(d){return d.session_id!==r}),i.history.unshift({last_seq:n,session_id:r}),i.history=i.history.slice(0,5),i.version=1,i.replicator="pouchdb",i.session_id=r,i.last_seq=n,t.put(i).catch(function(d){if(409===d.status)return on(t,e,n,r,o);throw d})})}function he(t,e,n,r,o){this.src=t,this.target=e,this.id=n,this.returnValue=r,this.opts=o||{}}he.prototype.writeCheckpoint=function(t,e){var n=this;return this.updateTarget(t,e).then(function(){return n.updateSource(t,e)})},he.prototype.updateTarget=function(t,e){return this.opts.writeTargetCheckpoint?on(this.target,this.id,t,e,this.returnValue):Promise.resolve(!0)},he.prototype.updateSource=function(t,e){if(this.opts.writeSourceCheckpoint){var n=this;return on(this.src,this.id,t,e,this.returnValue).catch(function(r){if(or(r))return n.opts.writeSourceCheckpoint=!1,!0;throw r})}return Promise.resolve(!0)};var rr={undefined:function(t,e){return 0===At(t.last_seq,e.last_seq)?e.last_seq:0},1:function(t,e){return(n=e,r=t,n.session_id===r.session_id?{last_seq:n.last_seq,history:n.history}:function o(i,d){var c=i[0],l=i.slice(1),p=d[0],y=d.slice(1);return c&&0!==d.length?sn(c.session_id,d)?{last_seq:c.last_seq,history:i}:sn(p.session_id,l)?{last_seq:p.last_seq,history:y}:o(l,y):{last_seq:0,history:[]}}(n.history,r.history)).last_seq;var n,r}};function sn(t,e){var n=e[0],r=e.slice(1);return!(!t||0===e.length)&&(t===n.session_id||sn(t,r))}function or(t){return"number"==typeof t.status&&4===Math.floor(t.status/100)}function ir(t,e,n,r,o){var i,c,l=[],p={seq:0,changes:[],docs:[]},y=!1,s=!1,h=!1,q=0,m=n.continuous||n.live||!1,R=n.batch_size||100,J=n.batches_limit||10,x=n.style||"all_docs",A=!1,S=n.doc_ids,_=n.selector,j=[],b=ge();o=o||{ok:!0,start_time:(new Date).toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var w={};function z(){return c?Promise.resolve():function eo(t,e,n){var l,r=n.doc_ids?n.doc_ids.sort(At):"",o=n.filter?n.filter.toString():"",i="",d="",c="";return n.selector&&(c=JSON.stringify(n.selector)),n.filter&&n.query_params&&(i=JSON.stringify((l=n.query_params,Object.keys(l).sort(At).reduce(function(p,y){return p[y]=l[y],p},{})))),n.filter&&"_view"===n.filter&&(d=n.view.toString()),Promise.all([t.id(),e.id()]).then(function(l){var p=l[0]+l[1]+o+d+i+r+c;return new Promise(function(y){Me(p,y)})}).then(function(l){return"_local/"+l.replace(/\//g,".").replace(/\+/g,"_")})}(t,e,n).then(function(I){c=new he(t,e,I,r,!1===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===n.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0})})}function G(){if(j=[],0!==i.docs.length){var I=i.docs;return e.bulkDocs({docs:I,new_edits:!1},{timeout:n.timeout}).then(function(it){if(r.cancelled)throw U(),new Error("cancelled");var ut=Object.create(null);it.forEach(function(vt){vt.error&&(ut[vt.id]=vt)});var kt=Object.keys(ut).length;o.doc_write_failures+=kt,o.docs_written+=I.length-kt,I.forEach(function(vt){var bt=ut[vt._id];if(bt){o.errors.push(bt);var qt=(bt.name||"").toLowerCase();if("unauthorized"!==qt&&"forbidden"!==qt)throw bt;r.emit("denied",lt(bt))}else j.push(vt)})},function(it){throw o.doc_write_failures+=I.length,it})}}function K(){if(i.error)throw new Error("There was a problem getting docs.");o.last_seq=q=i.seq;var I=lt(o);return j.length&&(I.docs=j,"number"==typeof i.pending&&(I.pending=i.pending,delete i.pending),r.emit("change",I)),y=!0,c.writeCheckpoint(i.seq,b).then(function(){if(r.emit("checkpoint",{checkpoint:i.seq}),y=!1,r.cancelled)throw U(),new Error("cancelled");i=void 0,nt()}).catch(function(tt){throw st(tt),tt})}function N(){return function to(t,e,n,r){n=lt(n);var o=[],i=!0;return Promise.resolve().then(function(){var c=Object.keys(n).filter(function(l){var p=n[l].missing;return 1===p.length&&er(p[0])});if(c.length>0)return function d(c){return t.allDocs({keys:c,include_docs:!0,conflicts:!0}).then(function(l){if(r.cancelled)throw new Error("cancelled");l.rows.forEach(function(p){var y,s;p.deleted||!p.doc||!er(p.value.rev)||(y=p.doc)._attachments&&Object.keys(y._attachments).length>0||(s=p.doc)._conflicts&&s._conflicts.length>0||(p.doc._conflicts&&delete p.doc._conflicts,o.push(p.doc),delete n[p.id])})})}(c)}).then(function(){var l,p,c=(l=n,p=[],Object.keys(l).forEach(function(y){l[y].missing.forEach(function(s){p.push({id:y,rev:s})})}),{docs:p,revs:!0,latest:!0});if(c.docs.length)return t.bulkGet(c).then(function(l){if(r.cancelled)throw new Error("cancelled");return Promise.all(l.results.map(function(p){return Promise.all(p.docs.map(function(y){var h,q,m,R,J,s=y.ok;return y.error&&(i=!1),s&&s._attachments?(h=e,q=t,m=s,R=Ft(q)&&!Ft(h),J=Object.keys(m._attachments),R?h.get(m._id).then(function(x){return Promise.all(J.map(function(A){return j=A,(S=x)._attachments&&S._attachments[j]&&S._attachments[j].digest===m._attachments[j].digest?h.getAttachment(x._id,A):q.getAttachment(m._id,A);var S,j}))}).catch(function(x){if(404!==x.status)throw x;return nr(q,m)}):nr(q,m)).then(function(h){var q=Object.keys(s._attachments);return h.forEach(function(m,R){var J=s._attachments[q[R]];delete J.stub,delete J.length,J.data=m}),s}):s}))})).then(function(p){o=o.concat(ve(p).filter(Boolean))})})}).then(function(){return{ok:i,docs:o}})}(t,e,i.diffs,r).then(function(I){i.error=!I.ok,I.docs.forEach(function(tt){delete i.diffs[tt._id],o.docs_read++,i.docs.push(tt)})})}function D(){var I;r.cancelled||i||(0!==l.length?(i=l.shift(),r.emit("checkpoint",{start_next_batch:i.seq}),(I={},i.changes.forEach(function(tt){r.emit("checkpoint",{revs_diff:tt}),"_user/"!==tt.id&&(I[tt.id]=tt.changes.map(function(it){return it.rev}))}),e.revsDiff(I).then(function(tt){if(r.cancelled)throw U(),new Error("cancelled");i.diffs=tt})).then(N).then(G).then(K).then(D).catch(function(tt){B("batch processing terminated with error",tt)})):$(!0))}function $(I){0!==p.changes.length?(I||s||p.changes.length>=R)&&(l.push(p),p={seq:0,changes:[],docs:[]},"pending"!==r.state&&"stopped"!==r.state||(r.state="active",r.emit("active")),D()):0!==l.length||i||((m&&w.live||s)&&(r.state="pending",r.emit("paused")),s&&U())}function B(I,tt){h||(tt.message||(tt.message=I),o.ok=!1,o.status="aborting",l=[],p={seq:0,changes:[],docs:[]},U(tt))}function U(I){if(!(h||r.cancelled&&(o.status="cancelled",y)))if(o.status=o.status||"complete",o.end_time=(new Date).toISOString(),o.last_seq=q,h=!0,I){(I=_t(I)).result=o;var tt=(I.name||"").toLowerCase();"unauthorized"===tt||"forbidden"===tt?(r.emit("error",I),r.removeAllListeners()):function(it,ut,kt,vt){if(!1===it.retry)return ut.emit("error",kt),void ut.removeAllListeners();if("function"!=typeof it.back_off_function&&(it.back_off_function=Ae),ut.emit("requestError",kt),"active"===ut.state||"pending"===ut.state){ut.emit("paused",kt),ut.state="stopped";var bt=function(){it.current_back_off=0};ut.once("paused",function(){ut.removeListener("active",bt)}),ut.once("active",bt)}it.current_back_off=it.current_back_off||0,it.current_back_off=it.back_off_function(it.current_back_off),setTimeout(function(){ir(t,e,n,r)},it.current_back_off)}(n,r,I)}else r.emit("complete",o),r.removeAllListeners()}function Z(I,tt,it){if(r.cancelled)return U();"number"==typeof tt&&(p.pending=tt),Pe(n)(I)&&(p.seq=I.seq||it,p.changes.push(I),r.emit("checkpoint",{pending_batch:p.seq}),E(function(){$(0===l.length&&w.live)}))}function ft(I){if(A=!1,r.cancelled)return U();if(I.results.length>0)w.since=I.results[I.results.length-1].seq,nt(),$(!0);else{var tt=function(){m?(w.live=!0,nt()):s=!0,$(!0)};i||0!==I.results.length?tt():(y=!0,c.writeCheckpoint(I.last_seq,b).then(function(){y=!1,o.last_seq=q=I.last_seq,tt()}).catch(st))}}function rt(I){if(A=!1,r.cancelled)return U();B("changes rejected",I)}function nt(){if(!A&&!s&&l.length<J){A=!0,r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",tt);var I=t.changes(w).on("change",Z);I.then(it,it),I.then(ft).catch(rt),n.retry&&(r._changes=I,r._abortChanges=tt)}function tt(){I.cancel()}function it(){r.removeListener("cancel",tt)}}function ot(){z().then(function(){if(!r.cancelled)return c.getCheckpoint().then(function(I){w={since:q=I,limit:R,batch_size:R,style:x,doc_ids:S,selector:_,return_docs:!0},n.filter&&("string"!=typeof n.filter?w.include_docs=!0:w.filter=n.filter),"heartbeat"in n&&(w.heartbeat=n.heartbeat),"timeout"in n&&(w.timeout=n.timeout),n.query_params&&(w.query_params=n.query_params),n.view&&(w.view=n.view),nt()});U()}).catch(function(I){B("getCheckpoint rejected with ",I)})}function st(I){y=!1,B("writeCheckpoint completed with error",I)}r.ready(t,e),r.cancelled?U():(r._addedListeners||(r.once("cancel",U),"function"==typeof n.complete&&(r.once("error",n.complete),r.once("complete",function(I){n.complete(null,I)})),r._addedListeners=!0),void 0===n.since?ot():z().then(function(){return y=!0,c.writeCheckpoint(n.since,b)}).then(function(){y=!1,r.cancelled?U():(q=n.since,ot())}).catch(st))}function Oe(){F.call(this),this.cancelled=!1,this.state="pending";var t=this,e=new Promise(function(n,r){t.once("complete",n),t.once("error",r)});t.then=function(n,r){return e.then(n,r)},t.catch=function(n){return e.catch(n)},t.catch(function(){})}function qe(t,e){return"string"==typeof t?new(0,e.PouchConstructor)(t,e):t}function an(t,e,n,r){if("function"==typeof n&&(r=n,n={}),void 0===n&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw _t(pe,"`doc_ids` filter parameter is not a list.");n.complete=r,(n=lt(n)).continuous=n.continuous||n.live,n.retry="retry"in n&&n.retry,n.PouchConstructor=n.PouchConstructor||this;var o=new Oe(n);return ir(qe(t,n),qe(e,n),n,o),o}function no(t,e,n,r){return"function"==typeof n&&(r=n,n={}),void 0===n&&(n={}),(n=lt(n)).PouchConstructor=n.PouchConstructor||this,new un(t=qe(t,n),e=qe(e,n),n,r)}function un(t,e,n,r){var o=this;this.canceled=!1;var i=n.push?Vt({},n,n.push):n,d=n.pull?Vt({},n,n.pull):n;function c(S){o.emit("change",{direction:"pull",change:S})}function l(S){o.emit("change",{direction:"push",change:S})}function p(S){o.emit("denied",{direction:"push",doc:S})}function y(S){o.emit("denied",{direction:"pull",doc:S})}function s(){o.pushPaused=!0,o.pullPaused&&o.emit("paused")}function h(){o.pullPaused=!0,o.pushPaused&&o.emit("paused")}function q(){o.pushPaused=!1,o.pullPaused&&o.emit("active",{direction:"push"})}function m(){o.pullPaused=!1,o.pushPaused&&o.emit("active",{direction:"pull"})}this.push=an(t,e,i),this.pull=an(e,t,d),this.pushPaused=!0,this.pullPaused=!0;var R={};function J(S){return function(_,j){("change"===_&&(j===c||j===l)||"denied"===_&&(j===y||j===p)||"paused"===_&&(j===h||j===s)||"active"===_&&(j===m||j===q))&&(_ in R||(R[_]={}),R[_][S]=!0,2===Object.keys(R[_]).length&&o.removeAllListeners(_))}}function x(S,_,j){-1==S.listeners(_).indexOf(j)&&S.on(_,j)}n.live&&(this.push.on("complete",o.pull.cancel.bind(o.pull)),this.pull.on("complete",o.push.cancel.bind(o.push))),this.on("newListener",function(S){"change"===S?(x(o.pull,"change",c),x(o.push,"change",l)):"denied"===S?(x(o.pull,"denied",y),x(o.push,"denied",p)):"active"===S?(x(o.pull,"active",m),x(o.push,"active",q)):"paused"===S&&(x(o.pull,"paused",h),x(o.push,"paused",s))}),this.on("removeListener",function(S){"change"===S?(o.pull.removeListener("change",c),o.push.removeListener("change",l)):"denied"===S?(o.pull.removeListener("denied",y),o.push.removeListener("denied",p)):"active"===S?(o.pull.removeListener("active",m),o.push.removeListener("active",q)):"paused"===S&&(o.pull.removeListener("paused",h),o.push.removeListener("paused",s))}),this.pull.on("removeListener",J("pull")),this.push.on("removeListener",J("push"));var A=Promise.all([this.push,this.pull]).then(function(S){var _={push:S[0],pull:S[1]};return o.emit("complete",_),r&&r(null,_),o.removeAllListeners(),_},function(S){if(o.cancel(),r?r(S):o.emit("error",S),o.removeAllListeners(),r)throw S});this.then=function(S,_){return A.then(S,_)},this.catch=function(S){return A.catch(S)}}he.prototype.getCheckpoint=function(){var t=this;return t.opts&&t.opts.writeSourceCheckpoint&&!t.opts.writeTargetCheckpoint?t.src.get(t.id).then(function(e){return e.last_seq||0}).catch(function(e){if(404!==e.status)throw e;return 0}):t.target.get(t.id).then(function(e){return t.opts&&t.opts.writeTargetCheckpoint&&!t.opts.writeSourceCheckpoint?e.last_seq||0:t.src.get(t.id).then(function(n){return e.version!==n.version?0:(r=e.version?e.version.toString():"undefined")in rr?rr[r](e,n):0;var r},function(n){if(404===n.status&&e.last_seq)return t.src.put({_id:t.id,last_seq:0}).then(function(){return 0},function(r){return or(r)?(t.opts.writeSourceCheckpoint=!1,e.last_seq):0});throw n})}).catch(function(e){if(404!==e.status)throw e;return 0})},O(Oe,F),Oe.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},Oe.prototype.ready=function(t,e){var n=this;function r(){n.cancel()}function o(){t.removeListener("destroyed",r),e.removeListener("destroyed",r)}n._readyCalled||(n._readyCalled=!0,t.once("destroyed",r),e.once("destroyed",r),n.once("complete",o),n.once("error",o))},O(un,F),un.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},pt.plugin(function(t){t.adapter("idb",Kn,!0)}).plugin(function(t){t.adapter("http",Ze,!1),t.adapter("https",Ze,!1)}).plugin(Zr).plugin(function(t){t.replicate=an,t.sync=no,Object.defineProperty(t.prototype,"replicate",{get:function(){var e=this;return void 0===this.replicateMethods&&(this.replicateMethods={from:function(n,r,o){return e.constructor.replicate(n,e,r,o)},to:function(n,r,o){return e.constructor.replicate(e,n,r,o)}}),this.replicateMethods}}),t.prototype.sync=function(e,n,r){return this.constructor.sync(this,e,n,r)}}),yt.exports=pt}).call(this)}).call(this,et(11))},{1:1,10:10,11:11,12:12,13:13,28:28,3:3,4:4}]},{},[29])(29)});