"use strict";var _t=Object.defineProperty,Xt=Object.defineProperties,Yt=Object.getOwnPropertyDescriptors,et=Object.getOwnPropertySymbols,Kt=Object.prototype.hasOwnProperty,Qt=Object.prototype.propertyIsEnumerable,tt=(te,W,x)=>W in te?_t(te,W,{enumerable:!0,configurable:!0,writable:!0,value:x}):te[W]=x,z=(te,W)=>{for(var x in W||(W={}))Kt.call(W,x)&&tt(te,x,W[x]);if(et)for(var x of et(W))Qt.call(W,x)&&tt(te,x,W[x]);return te},U=(te,W)=>Xt(te,Yt(W));(self.webpackChunkchasse_pwa_front=self.webpackChunkchasse_pwa_front||[]).push([[3490],{23490:(te,W,x)=>{x.r(W),x.d(W,{default:()=>Vt});var O=x(15861),v=x(17626),rt=x(73281),Ce=x(90885),N=x(26584),b=x(62208),nt=x(99959),ye=x(10699),it=x(32917),w=x(77712),st=(x(85931),x(8314)),at=x(90912),ot=x(55342),lt=x(68653),ie=x(76898),ct=x(44917),ut=x(552),ft=x(50107),Je=(x(29132),x(84792)),je=x(63290),we=x(83960),dt=x(37053),Ue=x(38305),ze=x(13812),mt=x(25982),pt=x(9548),de=x(2584),oe=x(79781),He=x(30994),ge=x(8341),ht=x(54805),yt=x(37084),G=x(2004),_=x(65234);const Ge=je.Z.getLogger("esri.layers.mixins.ImageryTileMixin"),gt=t=>{let e=class extends t{constructor(){super(...arguments),this._rasterJobHandler={instance:null,refCount:0,connectionPromise:null},this.bandIds=null,this.copyright=null,this.fullExtent=null,this.interpolation="nearest",this.multidimensionalDefinition=null,this.raster=null,this.rasterInfo=null,this.sourceJSON=null,this.spatialReference=null,this.tileInfo=null,this.symbolizer=null}set url(r){this._set("url",(0,Ue.Nm)(r,Ge))}set renderer(r){this._set("renderer",r),this.updateRenderer()}convertVectorFieldData(r,i){var n=this;return(0,O.Z)(function*(){if((0,b.Wi)(r))return null;const a=n._rasterJobHandler.instance,s=n.rasterInfo.dataType;return a?a.convertVectorFieldData({pixelBlock:r,dataType:s},i):(0,He.KC)(r,s)})()}createFlowMesh(r,i){var n=this;return(0,O.Z)(function*(){const a=n._rasterJobHandler.instance;return a?a.createFlowMesh(r,i):(0,yt.GE)(r.meshType,r.simulationSettings,r.flowData,(0,b.pC)(i.signal)?i.signal:(new AbortController).signal)})()}normalizeRasterFetchOptions(r){var s,c;const{multidimensionalInfo:i}=this.rasterInfo;if((0,b.Wi)(i))return r;let n=r.multidimensionalDefinition||this.multidimensionalDefinition;!(0,b.Wi)(n)&&n.length||(n=(0,oe.Tj)(this.raster.rasterInfo));const a=r.timeExtent||this.timeExtent;if((0,b.pC)(n)&&(0,b.pC)(a)&&((0,b.pC)(a.start)||(0,b.pC)(a.end))){n=n.map(g=>g.clone());const o=null==(c=null==(s=i.variables.find(({name:g})=>g===n[0].variableName))?void 0:s.dimensions)?void 0:c.find(({name:g})=>"StdTime"===g),l=n.find(({dimensionName:g})=>"StdTime"===g);if(!o||!l)return U(z({},r),{multidimensionalDefinition:null});const{start:u,end:m}=a,d=(0,b.Wi)(u)?null:u.getTime(),f=(0,b.Wi)(m)?null:m.getTime(),h=null!=d?d:f,y=null!=f?f:d;if((0,b.pC)(o.values)){const g=o.values.filter(p=>{if(Array.isArray(p)){if(h===y)return p[0]<=h&&p[1]>=h;const R=p[0]>=h&&p[1]<=y||p[0]<h&&p[1]>y;return p[0]<=h&&p[1]>h||p[0]<y&&p[1]>=y||R}return h===y?p===h:p>=h&&p<=y});if(g.length){const p=g.sort((I,R)=>{var M,F,B,T;return h===y?(null!=(M=I[0])?M:I)-(null!=(F=R[0])?F:R):Math.abs((null!=(B=I[1])?B:I)-y)-Math.abs((null!=(T=R[1])?T:R)-y)})[0];l.values=[p]}else n=null}else if(o.hasRegularIntervals&&o.extent){const[g,p]=o.extent;h>p||y<g?n=null:l.values=h===y?[h]:[Math.max(g,h),Math.min(p,y)]}}return U(z({},r),{multidimensionalDefinition:n})}updateRenderer(){var r=this;return(0,O.Z)(function*(){if(!r.loaded||JSON.stringify(r._cachedRendererJson)===JSON.stringify(r.renderer))return;const i=r._rasterJobHandler.instance;i&&(r.symbolizer.rendererJSON=(0,ge.ol)(r.renderer.toJSON()),r.symbolizer.bind(),yield i.updateSymbolizer(r.symbolizer),r._cachedRendererJson=r.renderer.toJSON())})()}applyRenderer(r,i){var n=this;return(0,O.Z)(function*(){const a=r&&r.pixelBlock;if(!((0,b.pC)(a)&&a.pixels&&a.pixels.length>0))return null;let s;yield n.updateRenderer();const c=n._rasterJobHandler.instance,{bandIds:o}=n;return s=c?yield c.symbolize(U(z({},r),{simpleStretchParams:i,bandIds:o})):n.symbolizer.symbolize(U(z({},r),{simpleStretchParams:i,bandIds:o})),s})()}getTileUrl(r,i,n){return"RasterTileServer"===this.raster.datasetFormat?`${this.url}/tile/${r}/${i}/${n}`:""}getCompatibleTileInfo(r,i,n=!1){if(!this.loaded||(0,b.Wi)(i))return null;if(n&&r.equals(this.spatialReference))return this.tileInfo;const a=(0,dt.C5)(r);return de.Z.create({size:256,spatialReference:r,origin:a?{x:a.origin[0],y:a.origin[1]}:{x:i.xmin,y:i.ymax}})}getCompatibleFullExtent(r){return this.loaded?(this._compatibleFullExtent&&this._compatibleFullExtent.spatialReference.equals(r)||(this._compatibleFullExtent=this.raster.computeExtent(r)),this._compatibleFullExtent):null}fetchTile(r,i,n,a={}){var s=this;return(0,O.Z)(function*(){if(a.requestAsImageElement){const c=s.getTileUrl(r,i,n);return(0,Je.default)(c,{responseType:"image",query:z(z({},s.refreshParameters),s.raster.ioConfig.customFetchParameters),signal:a.signal}).then(o=>o.data)}return(0,b.pC)(s.rasterInfo.multidimensionalInfo)&&(a=s.normalizeRasterFetchOptions(a),(0,b.Wi)(a.multidimensionalDefinition))?{extent:s.raster.getTileExtentFromTileInfo(r,i,n,a.tileInfo||s.rasterInfo.storageInfo.tileInfo),pixelBlock:null}:(yield s._initJobHandler(),"raster-shaded-relief"===s.renderer.type&&(a=U(z({},a),{buffer:{cols:1,rows:1}})),s.raster.fetchTile(r,i,n,a))})()}fetchPixels(r,i,n,a={}){var s=this;return(0,O.Z)(function*(){return(0,b.pC)(s.rasterInfo.multidimensionalInfo)&&(a=s.normalizeRasterFetchOptions(a),(0,b.Wi)(a.multidimensionalDefinition))?{extent:r,pixelBlock:null}:(yield s._initJobHandler(),s.raster.fetchPixels(r,i,n,a))})()}identify(r,i={}){var n=this;return(0,O.Z)(function*(){return!(0,b.pC)(n.rasterInfo.multidimensionalInfo)||n.rasterInfo.hasMultidimensionalTranspose&&((0,oe.WU)(i.multidimensionalDefinition)||i.transposedVariableName||i.timeExtent)||(i=n.normalizeRasterFetchOptions(i),!(0,b.Wi)(i.multidimensionalDefinition))?n.raster.identify(r,i):{location:r,value:null}})()}increaseRasterJobHandlerUsage(){this._rasterJobHandler.refCount++}decreaseRasterJobHandlerUsage(){this._rasterJobHandler.refCount--,this._rasterJobHandler.refCount<=0&&this._shutdownJobHandler()}hasStandardTime(){var n;const r=this.rasterInfo.multidimensionalInfo;if((0,b.Wi)(r)||"standard-time"!==this.rasterInfo.dataType)return!1;const i=null==(n=this.multidimensionalDefinition[0])?void 0:n.variableName;return r.variables.some(a=>a.name===i&&a.dimensions.some(s=>"StdTime"===s.name))}getStandardTimeValue(r){return new Date(24*(r-25569)*3600*1e3).toString()}_configDefaultSettings(){this._configDefaultInterpolation(),this.multidimensionalDefinition||(this.multidimensionalDefinition=(0,oe.Tj)(this.raster.rasterInfo)),this._configDefaultRenderer()}_initJobHandler(){if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;const r=new pt.Z;return this._rasterJobHandler.connectionPromise=r.initialize().then(()=>{this._rasterJobHandler.instance=r,this.raster.rasterJobHandler=r,this.renderer&&this.updateRenderer()}).catch(()=>null),this._rasterJobHandler.connectionPromise}_shutdownJobHandler(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy(),this._rasterJobHandler.instance=null,this._rasterJobHandler.connectionPromise=null,this._rasterJobHandler.refCount=0,this.raster.rasterJobHandler=null,this._cachedRendererJson=null}_configDefaultInterpolation(){var r;if(null==this.interpolation){const i=(0,ge.In)(this.rasterInfo,this.raster.tileType,null==(r=this.sourceJSON)?void 0:r.defaultResamplingMethod);this._set("interpolation",i)}}_configDefaultRenderer(){var n,a,s;const r=this.raster.rasterInfo;if(this.bandIds||(this.bandIds=(0,ge.YD)(r)),!this.renderer){const c=(0,ge.Ob)(r,{bandIds:this.bandIds,variableName:(0,b.pC)(this.multidimensionalDefinition)?null==(n=this.multidimensionalDefinition[0])?void 0:n.variableName:null});"WCSServer"===this.raster.datasetFormat&&"raster-stretch"===c.type&&((null==(a=r.statistics)?void 0:a[0].max)>1e24||(null==(s=r.statistics)?void 0:s[0].min)<-1e24)&&(c.dynamicRangeAdjustment=!0,c.statistics=null,"none"===c.stretchType&&(c.stretchType="min-max")),this.renderer=c}this.symbolizer?(this.symbolizer.rendererJSON=(0,ge.ol)(this.renderer.toJSON()),this.symbolizer.rasterInfo=r):this.symbolizer=new ht.Z({rendererJSON:this.renderer.toJSON(),rasterInfo:r});const i=this.symbolizer.bind();i.success||Ge.warn("imagery-tile-mixin",i.error||"The given renderer is not supported by the layer.")}};return(0,v._)([(0,w.Cb)()],e.prototype,"_cachedRendererJson",void 0),(0,v._)([(0,w.Cb)()],e.prototype,"_compatibleFullExtent",void 0),(0,v._)([(0,w.Cb)()],e.prototype,"_rasterJobHandler",void 0),(0,v._)([(0,w.Cb)()],e.prototype,"bandIds",void 0),(0,v._)([(0,w.Cb)({json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),(0,v._)([(0,w.Cb)({type:G.Z,json:{read:!1}}),(0,we.B)("rasterInfo.extent")],e.prototype,"fullExtent",void 0),(0,v._)([(0,w.Cb)()],e.prototype,"interpolation",void 0),(0,v._)([(0,w.Cb)()],e.prototype,"ioConfig",void 0),(0,v._)([(0,w.Cb)({type:[mt.Z]})],e.prototype,"multidimensionalDefinition",void 0),(0,v._)([(0,w.Cb)()],e.prototype,"raster",void 0),(0,v._)([(0,w.Cb)({readOnly:!0}),(0,we.B)("raster.rasterInfo")],e.prototype,"rasterInfo",void 0),(0,v._)([(0,w.Cb)()],e.prototype,"sourceJSON",void 0),(0,v._)([(0,w.Cb)({type:_.Z,json:{read:!1}}),(0,we.B)("rasterInfo.spatialReference")],e.prototype,"spatialReference",void 0),(0,v._)([(0,w.Cb)({type:de.Z,json:{read:!1}}),(0,we.B)("rasterInfo.storageInfo.tileInfo")],e.prototype,"tileInfo",void 0),(0,v._)([(0,w.Cb)(ze.HQ)],e.prototype,"url",null),(0,v._)([(0,w.Cb)({types:Ce.dr})],e.prototype,"renderer",null),(0,v._)([(0,w.Cb)()],e.prototype,"symbolizer",void 0),e=(0,v._)([(0,ie.j)("esri.layers.ImageryTileMixin")],e),e};var xt=x(49286),It=x(6647),vt=x(30346),bt=x(99555),St=x(97941),xe=x(36255),Rt=x(2939),Ie=x(79645),ve=x(27497),Tt=x(86810),Ct=x(60330),se=x(61068),Ve=x(8614),le=x(79751),L=x(28594),V=x(49672);let K=class extends((0,Ct.v)(Tt.wq)){constructor(){super(...arguments),this.rasterJobHandler=null,this.datasetName=null,this.datasetFormat=null,this.rasterInfo=null,this.ioConfig={sampling:"closest"}}init(){var t=this;return(0,O.Z)(function*(){const e=(0,L.zD)();t.addResolvingPromise(e),yield t.when()})()}normalizeCtorArgs(t){return t&&t.ioConfig&&(t=U(z({},t),{ioConfig:z({resolution:null,bandIds:null,sampling:"closest",tileInfo:de.Z.create()},t.ioConfig)})),t}get _isGlobalWrappableSource(){const{rasterInfo:t}=this,e=(0,L.ut)(t.spatialReference);return(0,b.pC)(e)&&t.extent.width>=e/2}set url(t){this._set("url",(0,Ue.Nm)(t,je.Z.getLogger(this.declaredClass)))}open(t){return(0,O.Z)(function*(){throw new N.Z("BaseRaster:open-not-implemented","open() is not implemented")})()}fetchTile(t,e,r,i={}){var n=this;return(0,O.Z)(function*(){const a=i.tileInfo||n.rasterInfo.storageInfo.tileInfo,s=n.getTileExtentFromTileInfo(t,e,r,a);return n.fetchPixels(s,a.size[0],a.size[1],i)})()}identify(t,e={}){var r=this;return(0,O.Z)(function*(){var Z;const{multidimensionalDefinition:i,timeExtent:n}=e,{hasMultidimensionalTranspose:a,multidimensionalInfo:s}=r.rasterInfo;let{transposedVariableName:c}=e;const o=(0,b.pC)(s)&&a&&(null!=n||(0,oe.WU)(i));o&&!c&&(c=(0,b.pC)(i)&&i.length>0?i[0].variableName:s.variables[0].name,e=U(z({},e),{transposedVariableName:c})),e=r._getRequestOptionsWithSliceId(e);const{spatialReference:l,extent:u}=r.rasterInfo,{datumTransformation:m}=e;let d=(0,L.nF)(t,l,m);if(!u.intersects(d))return{location:d,value:null};if((0,b.pC)(r.rasterInfo.transform)){const k=r.rasterInfo.transform.inverseTransform(d);if(!r.rasterInfo.nativeExtent.intersects(k))return{location:k,value:null};d=k}let f=0;const h=c&&(0,b.pC)(s)&&r.rasterInfo.hasMultidimensionalTranspose;if(!h)if(e.srcResolution)f=(0,L.kr)(e.srcResolution,r.rasterInfo,r.ioConfig.sampling).pyramidLevel;else if(f=yield r.computeBestPyramidLevelForLocation(t,e),null==f)return{location:d,value:null};const y=r.identifyPixelLocation(d,f,null,h);if(null===y)return{location:d,value:null};const{row:g,col:p,rowOffset:I,colOffset:R,blockWidth:M}=y,F=null!=c?c:(0,b.Wg)(e.sliceId),B=(0,se.Rq)(r.url,F),T=`${f}/${g}/${p}`;let S=(0,se.Qg)(B,null,T);(0,b.Wi)(S)&&(S=r.fetchRawTile(f,g,p,e),(0,se.gX)(B,null,T,S));const P=yield S;return(0,b.Wi)(P)||!(null==(Z=P.pixels)?void 0:Z.length)?{location:d,value:null}:r._processIdentifyResult(P,{srcLocation:d,position:I*M+R,pyramidLevel:f,useTransposedTile:h,requestSomeSlices:o,identifyOptions:e})})()}fetchPixels(t,e,r,i={}){var n=this;return(0,O.Z)(function*(){if(t=(0,L.kZ)(t),(i=n._getRequestOptionsWithSliceId(i)).requestRawData)return n._fetchPixels(t,e,r,i);const a=(0,L.ut)(t.spatialReference),s=(0,L.Hq)(t);if((0,b.Wi)(a)||0===s||1===s&&n._isGlobalWrappableSource)return n._fetchPixels(t,e,r,i);if(s>=3)return{extent:t,pixelBlock:null};const c=[],{xmin:o,xmax:l}=t,u=Math.round(a/(l-o)*e),m=u-Math.round((a/2-o)/(l-o)*e);let d=0;const f=[];for(let p=0;p<=s;p++){const I=new G.Z({xmin:0===p?o:-a/2,xmax:p===s?l-a*p:a/2,ymin:t.ymin,ymax:t.ymax,spatialReference:t.spatialReference}),R=0===p?u-m:p===s?e-d:u;d+=R,f.push(R);const M=i.disableWrapAround&&p>0?null:n._fetchPixels(I,R,r,i);c.push(M)}const h=(yield Promise.all(c)).map(p=>null==p?void 0:p.pixelBlock);let y=null;const g={width:e,height:r};return y=n.rasterJobHandler?(yield n.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:h,srcMosaicSize:g,destDimension:null,coefs:null,sampleSpacing:null,interpolation:"nearest",alignmentInfo:null,blockWidths:f},i)).pixelBlock:(0,le.us)(h,g,{blockWidths:f}),{extent:t,srcExtent:(0,L.tB)(t,n.rasterInfo.spatialReference,i.datumTransformation),pixelBlock:y}})()}fetchRawPixels(t,e,r,i={}){var n=this;return(0,O.Z)(function*(){e={x:Math.floor(e.x),y:Math.floor(e.y)};const a=yield n._fetchRawTiles(t,e,r,i),{nativeExtent:s,nativePixelSize:c,storageInfo:o}=n.rasterInfo,l=2**t,u=c.x*l,m=c.y*l,d=new G.Z({xmin:s.xmin+u*e.x,xmax:s.xmin+u*(e.x+r.width-1),ymin:s.ymax-m*(e.y+r.height-1),ymax:s.ymax-m*e.y,spatialReference:s.spatialReference});if(!a)return{extent:d,srcExtent:d,pixelBlock:null};const{pixelBlocks:f,mosaicSize:h}=a;if(1===f.length&&(0,b.pC)(f[0])&&f[0].width===r.width&&f[0].height===r.height)return{extent:d,srcExtent:d,pixelBlock:a.pixelBlocks[0]};const p={x:e.x%(t>0?o.pyramidBlockWidth:o.blockWidth),y:e.y%(t>0?o.pyramidBlockHeight:o.blockHeight)};let I;return I=n.rasterJobHandler?(yield n.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:f,srcMosaicSize:h,destDimension:r,clipOffset:p,clipSize:r,coefs:null,sampleSpacing:null,interpolation:i.interpolation,alignmentInfo:null,blockWidths:null},i)).pixelBlock:(0,le.us)(f,h,{clipOffset:p,clipSize:r}),{extent:d,srcExtent:d,pixelBlock:I}})()}fetchRawTile(t,e,r,i){throw new N.Z("BaseRaster:read-not-implemented","fetchRawTile() is not implemented")}computeExtent(t){return(0,L.tB)(this.rasterInfo.extent,t)}decodePixelBlock(t,e){return!this.rasterJobHandler||e.useCanvas?(0,Ve.J)(t,e):this.rasterJobHandler.decode({data:t,options:e})}request(t,e,r){var i=this;return(0,O.Z)(function*(){var l;const{customFetchParameters:n}=i.ioConfig,{range:a,query:s,headers:c}=e;r=null!=(l=null!=r?r:e.retryCount)?l:i.ioConfig.retryCount;const o=a?{Range:`bytes=${a.from}-${a.to}`}:null;try{return yield(0,Je.default)(t,U(z({},e),{query:z(z({},s),n),headers:z(z({},c),o)}))}catch(u){if(r>0)return r--,i.request(t,e,r);throw u}})()}getSliceIndex(t){const{multidimensionalInfo:e}=this.rasterInfo;return(0,b.Wi)(e)||(0,b.Wi)(t)||0===t.length?null:(0,oe.gk)(t,e)}getTileExtentFromTileInfo(t,e,r,i){const n=i.lodAt(t);return this.getTileExtent({x:n.resolution,y:n.resolution},e,r,i.origin,i.spatialReference,i.size)}updateTileInfo(){const{storageInfo:t,spatialReference:e,extent:r,pixelSize:i}=this.rasterInfo;if(!t.tileInfo){const n=[],a=t.maximumPyramidLevel||0;let s=Math.max(i.x,i.y),c=1/.0254*96*s;for(let l=0;l<=a;l++)n.push({level:a-l,resolution:s,scale:c}),s*=2,c*=2;const o=new V.Z({x:r.xmin,y:r.ymax,spatialReference:e});t.tileInfo=new de.Z({origin:o,size:[t.blockWidth,t.blockHeight],spatialReference:e,lods:n}),t.isVirtualTileInfo=!0}}createRemoteDatasetStorageInfo(t,e=512,r=512,i){const{width:n,height:a,nativeExtent:s,pixelSize:c,spatialReference:o}=t,l=new V.Z({x:s.xmin,y:s.ymax,spatialReference:o});null==i&&(i=Math.max(0,Math.round(Math.log(Math.max(n,a))/Math.LN2-8)));const u=this.computeBlockBoundary(s,512,512,{x:s.xmin,y:s.ymax},[c],i);t.storageInfo=new ve.Z({blockWidth:e,blockHeight:r,pyramidBlockWidth:e,pyramidBlockHeight:r,origin:l,firstPyramidLevel:1,maximumPyramidLevel:i,blockBoundary:u})}computeBestPyramidLevelForLocation(t,e={}){return(0,O.Z)(function*(){return 0})()}computeBlockBoundary(t,e,r,i,n,a=0,s=2){if(1===n.length&&a>0){n=[...n];let{x:u,y:m}=n[0];for(let d=0;d<a;d++)u*=s,m*=s,n.push({x:u,y:m})}const c=[],{x:o,y:l}=i;for(let u=0;u<n.length;u++){const{x:m,y:d}=n[u];c.push({minCol:Math.floor((t.xmin-o+.1*m)/e/m),maxCol:Math.floor((t.xmax-o-.1*m)/e/m),minRow:Math.floor((l-t.ymax+.1*d)/r/d),maxRow:Math.floor((l-t.ymin-.1*d)/r/d)})}return c}getPyramidPixelSize(t){const{nativePixelSize:e}=this.rasterInfo,{pyramidResolutions:r,pyramidScalingFactor:i}=this.rasterInfo.storageInfo;if(0===t)return e;if((0,b.pC)(r)&&r.length)return r[t-1];const n=i**t;return{x:e.x*n,y:e.y*n}}identifyPixelLocation(t,e,r,i){const{spatialReference:n,nativeExtent:a,storageInfo:s}=this.rasterInfo,{maximumPyramidLevel:c,origin:o,transposeInfo:l}=s,u=i&&(0,b.pC)(l)?l.tileSize[0]:s.blockWidth,m=i&&(0,b.pC)(l)?l.tileSize[1]:s.blockHeight,d=(0,L.nF)(t,n,r);if(!a.intersects(d)||e<0||e>c)return null;const f=this.getPyramidPixelSize(e),{x:h,y}=f,g=(o.y-d.y)/y/m,p=(d.x-o.x)/h/u,I=Math.min(m-1,Math.floor((g-Math.floor(g))*m)),R=Math.min(u-1,Math.floor((p-Math.floor(p))*u));return{pyramidLevel:e,row:Math.floor(g),col:Math.floor(p),rowOffset:I,colOffset:R,blockWidth:u,srcLocation:d}}getTileExtent(t,e,r,i,n,a){const[s,c]=a,o=i.x+r*s*t.x,u=i.y-e*c*t.y;return new G.Z({xmin:o,xmax:o+s*t.x,ymin:u-c*t.y,ymax:u,spatialReference:n})}getBlockWidthHeight(t){return{blockWidth:t>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,blockHeight:t>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight}}isBlockOutside(t,e,r){const i=this.rasterInfo.storageInfo.blockBoundary[t];return!i||i.maxRow<e||i.maxCol<r||i.minRow>e||i.minCol>r}_fetchPixels(t,e,r,i={}){var n=this;return(0,O.Z)(function*(){let a=(0,L.Hq)(t);if(a>=2)return{extent:t,pixelBlock:null};const s=n._getSourceDataInfo(t,e,r,i),{pyramidLevel:c,pyramidResolution:o,srcResolution:l,srcExtent:u,srcWidth:m,srcHeight:d}=s;if(0===m||0===d)return{extent:t,srcExtent:u,pixelBlock:null};const f=(0,b.Wg)(n.rasterInfo.transform),h="gcs-shift"===(null==f?void 0:f.type),y=(0,b.pC)((0,L.ut)(t.spatialReference));!h&&y||(a=(0,L.Hq)(s.srcExtent,h));const g=n.rasterInfo.storageInfo,p={x:Math.floor((u.xmin-g.origin.x)/o.x+.1),y:Math.floor((g.origin.y-u.ymax)/o.y+.1)},I=yield n._fetchRawTiles(c,p,{width:m,height:d,wrapCount:a},i);if(!I)return{extent:t,srcExtent:u,pixelBlock:null};const R=c>0?g.pyramidBlockWidth:g.blockWidth,M=c>0?g.pyramidBlockHeight:g.blockHeight,F=R===m&&M===d&&p.x%R==0&&p.y%M==0,B=new V.Z({x:(t.xmax-t.xmin)/e,y:(t.ymax-t.ymin)/r,spatialReference:t.spatialReference}),T=!t.spatialReference.equals(n.rasterInfo.spatialReference),{datumTransformation:S}=i;if(!T&&F&&1===I.pixelBlocks.length&&R===e&&M===r&&l.x===B.x&&l.y===B.y)return{extent:t,srcExtent:u,pixelBlock:I.pixelBlocks[0]};const P=y&&(0,b.pC)((0,L.ut)(u.spatialReference)),C=i.requestProjectedLocalDirections&&n.rasterInfo.dataType.startsWith("vector");C&&!n.rasterJobHandler&&(yield(0,L.zD)());const Z=n.rasterJobHandler?yield n.rasterJobHandler.getProjectionOffsetGrid({projectedExtent:t,srcBufferExtent:I.extent,pixelSize:B.toJSON(),datumTransformation:S,rasterTransform:f,hasWrapAround:a>0||P,isAdaptive:!1!==n.ioConfig.optimizeProjectionAccuracy,includeGCSGrid:C},i):(0,L.Qp)({projectedExtent:t,srcBufferExtent:I.extent,pixelSize:B,datumTransformation:S,rasterTransform:f,hasWrapAround:a>0||P,isAdaptive:!1,includeGCSGrid:C});let k;const Y=!i.requestRawData,q={rows:Z.spacing[0],cols:Z.spacing[1]},D=(0,b.Wg)(n._getRasterTileAlignmentInfo(c,I.extent.xmin)),{pixelBlocks:A,mosaicSize:j,isPartiallyFilled:ne}=I;let $=null;if(n.rasterJobHandler)({pixelBlock:k,localNorthDirections:$}=yield n.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:A,srcMosaicSize:j,destDimension:Y?{width:e,height:r}:null,coefs:Y?Z.coefficients:null,sampleSpacing:Y?q:null,projectDirections:C,gcsGrid:C?Z.gcsGrid:null,isUV:"vector-uv"===n.rasterInfo.dataType,interpolation:i.interpolation,alignmentInfo:D,blockWidths:null},i));else{const E=(0,le.us)(A,j,{alignmentInfo:D});k=Y?(0,le.Uk)(E,{width:e,height:r},Z.coefficients,q,i.interpolation):E,C&&Z.gcsGrid&&($=(0,le.Qh)({width:e,height:r},Z.gcsGrid),k=(0,He.xQ)(k,n.rasterInfo.dataType,$))}return i.requestRawData||C?{srcExtent:u,pixelBlock:k,transformGrid:Z,localNorthDirections:$,extent:t,isPartiallyFilled:ne}:{srcExtent:u,extent:t,pixelBlock:k}})()}_fetchRawTiles(t,e,r,i){var n=this;return(0,O.Z)(function*(){const{origin:a,blockBoundary:s}=n.rasterInfo.storageInfo,{blockWidth:c,blockHeight:o}=n.getBlockWidthHeight(t);let{x:l,y:u}=e,{width:m,height:d,wrapCount:f}=r;const h=n._getRasterTileAlignmentInfo(t,0);i.buffer&&(l-=i.buffer.cols,u-=i.buffer.rows,m+=2*i.buffer.cols,d+=2*i.buffer.rows);let y=0,g=0,p=0;f&&(0,b.pC)(h)&&(({worldColumnCountFromOrigin:g,originColumnOffset:p,rightPadding:y}=h),g*h.blockWidth-y>=l+m&&(y=0));const I=Math.floor(l/c),R=Math.floor(u/o),M=Math.floor((l+m+y-1)/c),F=Math.floor((u+d+y-1)/o),B=s[t];if(!B)return null;const{minRow:T,minCol:S,maxCol:P,maxRow:C}=B;if(0===f&&(F<T||M<S||R>C||I>P))return null;const Z=new Array;let k=!1;const Y=null==n.ioConfig.allowPartialFill?i.allowPartialFill:n.ioConfig.allowPartialFill;for(let E=R;E<=F;E++)for(let ee=I;ee<=M;ee++){let ke=ee;if(!i.disableWrapAround&&f&&(0,b.pC)(h)&&g<=ee&&(ke=ee-g-p),E>=T&&ke>=S&&C>=E&&P>=ke){const Qe=n._fetchRawTile(t,E,ke,i);Z.push(Y?new Promise(qe=>{Qe.then($t=>qe($t)).catch(()=>{k=!0,qe(null)})}):Qe)}else Z.push(null)}if(0===Z.length)return null;const q=yield Promise.all(Z),D={height:(F-R+1)*o,width:(M-I+1)*c},{spatialReference:A}=n.rasterInfo,j=n.getPyramidPixelSize(t),{x:ne,y:$}=j;return{extent:new G.Z({xmin:a.x+I*c*ne,xmax:a.x+(M+1)*c*ne,ymin:a.y-(F+1)*o*$,ymax:a.y-R*o*$,spatialReference:A}),pixelBlocks:q,mosaicSize:D,isPartiallyFilled:k}})()}_fetchRawTile(t,e,r,i){const n=this.rasterInfo.storageInfo.blockBoundary[t];if(!n)return Promise.resolve(null);const{minRow:a,minCol:s,maxCol:c,maxRow:o}=n;if(e<a||r<s||e>o||r>c)return Promise.resolve(null);const l=(0,se.Rq)(this.url,i.sliceId),u=`${t}/${e}/${r}`;let m=(0,se.Qg)(l,i.registryId,u);if((0,b.Wi)(m)){const d=new AbortController;m=this.fetchRawTile(t,e,r,U(z({},i),{signal:d.signal})),(0,se.gX)(l,i.registryId,u,m,d),m.catch(()=>(0,se.Gc)(l,i.registryId,u))}return i.signal&&(0,ye.fu)(i,()=>{(0,se.OE)(l,i.registryId,u)}),m}_computeMagDirValues(t){var o;const{bandCount:e,dataType:r}=this.rasterInfo;if((2!==e||"vector-magdir"!==r)&&"vector-uv"!==r||2!==(null==t?void 0:t.length)||!(null==(o=t[0])?void 0:o.length))return null;const i=t[0].length;if("vector-magdir"===r){const l=t[1].map(u=>(u+360)%360);return[t[0],l]}const[n,a]=t,s=[],c=[];for(let l=0;l<i;l++){const[u,m]=(0,He.Tg)([n[l],a[l]]);s.push(u),c.push(m)}return[s,c]}_getRasterTileAlignmentInfo(t,e){return null==this._rasterTileAlighmentInfo&&(this._rasterTileAlighmentInfo=(0,L.P_)(this.rasterInfo)),(0,b.Wi)(this._rasterTileAlighmentInfo.pyramidsInfo)?null:z({startX:e,halfWorldWidth:this._rasterTileAlighmentInfo.halfWorldWidth,hasGCSSShiftTransform:this._rasterTileAlighmentInfo.hasGCSSShiftTransform},this._rasterTileAlighmentInfo.pyramidsInfo[t])}_getSourceDataInfo(t,e,r,i={}){const n={datumTransformation:i.datumTransformation,pyramidLevel:0,pyramidResolution:null,srcExtent:null,srcHeight:0,srcResolution:null,srcWidth:0};i.srcResolution&&(n.srcResolution=i.srcResolution,this._updateSourceDataInfo(t,n));const a=this.rasterInfo.storageInfo.maximumPyramidLevel||0,{srcWidth:s,srcHeight:c,pyramidLevel:o}=n,l=s/e,u=c/r,m=o<a&&l*u>=16;if(m||o===a&&(l>8||u>8)||0===s||0===c){const d=new V.Z({x:(t.xmax-t.xmin)/e,y:(t.ymax-t.ymin)/r,spatialReference:t.spatialReference});let f=(0,L.VO)(d,this.rasterInfo.spatialReference,t,n.datumTransformation);const h=!f||i.srcResolution&&f.x+f.y<i.srcResolution.x+i.srcResolution.y;if(m&&i.srcResolution&&h){const y=Math.round(Math.log(Math.max(l,u))/Math.LN2)-1;if(a-o+3>=y){const g=2**y;f={x:i.srcResolution.x*g,y:i.srcResolution.y*g}}}f&&(n.srcResolution=f,this._updateSourceDataInfo(t,n))}return(n.srcWidth/e>8||n.srcHeight/r>8)&&(n.srcWidth=0,n.srcHeight=0),n}_updateSourceDataInfo(t,e){e.srcWidth=0,e.srcHeight=0;const r=this.rasterInfo.spatialReference,{srcResolution:i,datumTransformation:n}=e,{pyramidLevel:a,pyramidResolution:s,excessiveReading:c}=(0,L.kr)(i,this.rasterInfo,this.ioConfig.sampling);if(c)return;let o=e.srcExtent||(0,L.tB)(t,r,n);if(null==o)return;const l=(0,b.Wg)(this.rasterInfo.transform);l&&(o=l.inverseTransform(o)),e.srcExtent=o;const u=Math.ceil((o.xmax-o.xmin)/s.x-.1),m=Math.ceil((o.ymax-o.ymin)/s.y-.1);e.pyramidLevel=a,e.pyramidResolution=s,e.srcWidth=u,e.srcHeight=m}_getRequestOptionsWithSliceId(t){return(0,b.pC)(this.rasterInfo.multidimensionalInfo)&&null==t.sliceId&&(t=U(z({},t),{sliceId:this.getSliceIndex(t.multidimensionalDefinition)})),t}_processIdentifyResult(t,e){const{srcLocation:r,position:i,pyramidLevel:n,useTransposedTile:a}=e,s=t.pixels[0].length/t.width/t.height;if(t.mask&&!t.mask[i])return{location:r,value:null};const{multidimensionalInfo:c}=this.rasterInfo;if((0,b.Wi)(c)||!a){const f=t.pixels.map(g=>g[i]),h={location:r,value:f,pyramidLevel:n},y=this._computeMagDirValues(f.map(g=>[g]));return(null==y?void 0:y.length)&&(h.magdirValue=y.map(g=>g[0])),h}let o=t.pixels.map(f=>Array.prototype.slice.call(f,i*s,i*s+s)),l=this._computeMagDirValues(o);const{requestSomeSlices:u,identifyOptions:m}=e;let d=(0,oe.MO)(c,m.transposedVariableName);if(u){const f=(0,oe.Ur)(d,(0,b.Wg)(m.multidimensionalDefinition),(0,b.Wg)(m.timeExtent));o=o.map(h=>f.map(y=>h[y])),l=null==l?void 0:l.map(h=>f.map(y=>h[y])),d=f.map(h=>d[h])}return{location:r,value:null,dataSeries:d.map((f,h)=>{const y={value:o.map(g=>g[h]),multidimensionalDefinition:f.multidimensionalDefinition,variableName:f.multidimensionalDefinition[0].variableName,dimensionValues:{}};return(null==l?void 0:l.length)&&(y.magdirValue=[l[0][h],l[1][h]]),f.multidimensionalDefinition.forEach(g=>y.dimensionValues[g.dimensionName]=g.values[0]),y}),pyramidLevel:n}}};(0,v._)([(0,w.Cb)()],K.prototype,"_rasterTileAlighmentInfo",void 0),(0,v._)([(0,w.Cb)({readOnly:!0})],K.prototype,"_isGlobalWrappableSource",null),(0,v._)([(0,w.Cb)(ze.HQ)],K.prototype,"url",null),(0,v._)([(0,w.Cb)({type:String,json:{write:!0}})],K.prototype,"datasetName",void 0),(0,v._)([(0,w.Cb)({type:String,json:{write:!0}})],K.prototype,"datasetFormat",void 0),(0,v._)([(0,w.Cb)()],K.prototype,"rasterInfo",void 0),(0,v._)([(0,w.Cb)()],K.prototype,"ioConfig",void 0),(0,v._)([(0,w.Cb)()],K.prototype,"sourceJSON",void 0),K=(0,v._)([(0,ie.j)("esri.layers.support.rasterDatasets.BaseRaster")],K);const me=K;var $e=x(15365);function wt(t){const e=t.fields,r=t.records,i=e.some(l=>"oid"===l.name.toLowerCase())?"OBJECTID":"OID",n=[{name:i,type:"esriFieldTypeOID",alias:"OID"}].concat(e.map(l=>({name:l.name,type:"esriFieldType"+l.typeName,alias:l.name}))),a=n.map(l=>l.name),s=[];let c=0,o=0;return r.forEach(l=>{const u={};for(u[i]=c++,o=1;o<a.length;o++)u[a[o]]=l[o-1];s.push({attributes:u})}),{displayFieldName:"",fields:n,features:s}}var _e=x(46572),Ft=x(17253);const ce=new Map;ce.set("int16","esriFieldTypeSmallInteger"),ce.set("int32","esriFieldTypeInteger"),ce.set("int64","esriFieldTypeInteger"),ce.set("float32","esriFieldTypeSingle"),ce.set("float64","esriFieldTypeDouble"),ce.set("text","esriFieldTypeString");let be=class extends me{constructor(){super(...arguments),this.storageInfo=null,this.datasetFormat="CRF"}open(t){var e=this;return(0,O.Z)(function*(){yield e.init();const{data:r}=yield e.request(e.url+"/conf.json",{signal:null==t?void 0:t.signal});if(!e._validateHeader(r))throw new N.Z("cloudraster:open","Invalid or unsupported conf.json.");e.datasetName=e.url.slice(e.url.lastIndexOf("/")+1);const{storageInfo:i,rasterInfo:n}=e._parseHeader(r);if("thematic"===n.dataType){const a=yield e._fetchAuxiliaryInformation();n.attributeTable=a}e._set("storageInfo",i),e._set("rasterInfo",n),e.ioConfig.retryCount=e.ioConfig.retryCount||0})()}fetchRawTile(t,e,r,i={}){var n=this;return(0,O.Z)(function*(){const{transposeInfo:a}=n.rasterInfo.storageInfo,{transposedVariableName:s}=i,c=!(!a||!s),o=c?0:n.rasterInfo.storageInfo.maximumPyramidLevel-t;if(o<0)return null;const l=n._buildCacheFilePath(o,e,r,i.multidimensionalDefinition,s),u=n._getIndexRecordFromBundle(e,r,c),m=yield n.request(l,{range:{from:0,to:n.storageInfo.headerSize-1},responseType:"array-buffer",signal:i.signal});if(!m)return null;const d=new Uint8Array(m.data),f=n._getTileEndAndContentType(d,u);if(0===f.recordSize)return null;const h=yield n.request(l,{range:{from:f.position,to:f.position+f.recordSize},responseType:"array-buffer",signal:i.signal});if(!h)return null;const[y,g]=n._getTileSize(c);return n.decodePixelBlock(h.data,{width:y,height:g,planes:null,pixelType:null,returnPixelInterleavedDims:c})})()}_validateHeader(t){return t&&"RasterInfo"===t.type&&!["origin","extent","geodataXform","LODInfos","blockWidth","blockHeight","bandCount","pixelType","pixelSizeX","pixelSizeY","format","packetSize"].some(r=>!t[r])}_parseHeader(t){var ne,$;const e=["u1","u2","u4","u8","s8","u16","s16","u32","s32","f32","f64"][t.pixelType],{bandCount:r,histograms:i,colormap:n,blockWidth:a,blockHeight:s,firstPyramidLevel:c,maximumPyramidLevel:o}=t,l=t.statistics&&t.statistics.map(E=>({min:E.min,max:E.max,avg:E.mean,stddev:E.standardDeviation,median:E.median,mode:E.mode})),u=t.extent.spatialReference,m=null==(ne=t.geodataXform)?void 0:ne.spatialReference,d=new _.Z((null==u?void 0:u.wkid)||(null==u?void 0:u.wkt)?u:m);let f=new G.Z({xmin:t.extent.xmin,ymin:t.extent.ymin,xmax:t.extent.xmax,ymax:t.extent.ymax,spatialReference:d});const h=new V.Z({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:d}),y=Math.round((f.xmax-f.xmin)/h.x),g=Math.round((f.ymax-f.ymin)/h.y),p=this._parseTransform(t.geodataXform),I=p?f:null;p&&(f=p.forwardTransform(f),h.x=(f.xmax-f.xmin)/y,h.y=(f.ymax-f.ymin)/g);const R=null!=($=t.properties)?$:{},M=t.format.toLowerCase().replace("cache/",""),F=new V.Z(t.origin.x,t.origin.y,d);let B,T,S,P;if(n&&n.colors)for(B=[],T=0;T<n.colors.length;T++)S=n.colors[T],P=n.values?n.values[T]:T,B.push([P,255&S,S<<16>>>24,S<<8>>>24,S>>>24]);const C=t.LODInfos,Z=[];for(T=0;T<C.levels.length;T++)Z.push({level:C.levels[T],resolution:C.resolutions[T],scale:96/.0254*C.resolutions[T]});const k=new de.Z({dpi:96,lods:Z,format:M,origin:F,size:[a,s],spatialReference:d}),Y={recordSize:8,packetSize:t.packetSize,headerSize:t.packetSize*t.packetSize*8+64},q=[{maxCol:Math.ceil(y/a)-1,maxRow:Math.ceil(g/s)-1,minCol:0,minRow:0}];let D=2;if(o>0)for(T=0;T<o;T++)q.push({maxCol:Math.ceil(y/D/a)-1,maxRow:Math.ceil(g/D/s)-1,minCol:0,minRow:0}),D*=2;const A=t.mdInfo;let j=null;if(A&&R._yxs){const E=R._yxs;j={packetSize:E.PacketSize,tileSize:[E.TileXSize,E.TileYSize]}}return{storageInfo:Y,rasterInfo:new Ie.Z({width:y,height:g,pixelType:e,bandCount:r,extent:f,nativeExtent:I,transform:p,spatialReference:d,pixelSize:h,keyProperties:R,statistics:l,histograms:i,multidimensionalInfo:A,colormap:B,storageInfo:new ve.Z({blockWidth:a,blockHeight:s,pyramidBlockWidth:a,pyramidBlockHeight:s,origin:F,tileInfo:k,transposeInfo:j,firstPyramidLevel:c,maximumPyramidLevel:o,blockBoundary:q})})}}_parseTransform(t){var r,i;if(!(0,_e.j)(t))throw new N.Z("cloudraster:open","the data contains unsupported geodata transform types");const e=(0,_e.c)(t);if("identity"===e.type)return null;if("polynomial"!==e.type||!(null==(r=e.forwardCoefficients)?void 0:r.length)||!(null==(i=e.inverseCoefficients)?void 0:i.length))throw new N.Z("cloudraster:open","the data contains unsupported geodata transforms - both forward and inverse coefficients are required currently");return e}_fetchAuxiliaryInformation(t){var e=this;return(0,O.Z)(function*(){const r=e.request(e.url+"/conf.vat.json",{signal:t}).then(s=>s.data).catch(()=>null),i=e.request(e.url+"/conf.vat.dbf",{responseType:"array-buffer",signal:t}).then(s=>s.data).catch(()=>null),n=yield Promise.all([r,i]);let a;if(n[0]){let s=n[0].fields;const c=n[0].values;if(s&&c){s=s.map(l=>({type:"OID"===l.name?"esriFieldTypeOID":ce.get(l.type),name:l.name,alias:l.alias||l.name}));const o=c.map(l=>({attributes:l}));s&&c&&(a={fields:s,features:o})}}return!a&&n[1]&&(a=class Pt{static get supportedVersions(){return[5]}static parse(e){const r=new DataView(e),i=3&r.getUint8(0);if(3!==i)return{header:{version:i},recordSet:null};const n=r.getUint32(4,!0),a=r.getUint16(8,!0),s=r.getUint16(10,!0),c={version:i,recordCount:n,headerByteCount:a,recordByteCount:s};let o=32;const l=[],u=[];let m;if(3===i){for(;13!==r.getUint8(o);)m=String.fromCharCode(r.getUint8(o+11)).trim(),l.push({name:(0,$e.f)(new Uint8Array(e,o,11)),type:m,typeName:["String","Date","Double","Boolean","String","Integer"][["C","D","F","L","M","N"].indexOf(m)],length:r.getUint8(o+16)}),o+=32;if(o+=1,l.length>0)for(;u.length<n&&e.byteLength-o>s;){const d=[];32===r.getUint8(o)?(o+=1,l.forEach(f=>{if("C"===f.type)d.push((0,$e.f)(new Uint8Array(e,o,f.length)).trim());else if("N"===f.type)d.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(e,o,f.length)).trim(),10));else if("F"===f.type)d.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(e,o,f.length)).trim()));else if("D"===f.type){const h=String.fromCharCode.apply(null,new Uint8Array(e,o,f.length)).trim();d.push(new Date(parseInt(h.substring(0,4),10),parseInt(h.substring(4,6),10)-1,parseInt(h.substring(6,8),10)))}o+=f.length}),u.push(d)):o+=s}}return{header:c,fields:l,records:u,recordSet:wt({fields:l,records:u})}}}.parse(n[1]).recordSet),Ft.default.fromJSON(a)})()}_buildCacheFilePath(t,e,r,i,n){const a=this._getPackageSize(!!n),s=Math.floor(e/a)*a,c=Math.floor(r/a)*a,o="R"+this._toHexString4(s)+"C"+this._toHexString4(c);let l="L";l+=t>=10?t.toString():"0"+t.toString();const{multidimensionalInfo:u}=this.rasterInfo,m=null==i?void 0:i[0];if((0,b.Wi)(u)||!m)return`${this.url}/_alllayers/${l}/${o}.bundle`;let d="_yxs";if(!n){d=u.variables.find(y=>y.name===m.variableName).dimensions[0].values.indexOf(m.values[0]).toString(16);const h=4-d.length;for(let y=0;y<h;y++)d="0"+d;d="S"+d}const f=this._getVariableFolderName(n||m.variableName);return`${this.url}/_alllayers/${f}/${d}/${l}/${o}.bundle`}_getPackageSize(t=!1){const{transposeInfo:e}=this.rasterInfo.storageInfo;return t&&(0,b.pC)(e)?e.packetSize:this.storageInfo.packetSize}_getTileSize(t=!1){const{storageInfo:e}=this.rasterInfo,{transposeInfo:r}=e;return t&&(0,b.pC)(r)?r.tileSize:e.tileInfo.size}_getVariableFolderName(t){return""===(t=t.trim())?"_v":t.replace(/[\{|\}\-]/g,"_").replace("\\*","_v")}_getIndexRecordFromBundle(t,e,r=!1){const i=this._getPackageSize(r),n=i*(t%i)+e%i;if(n<0)throw"Invalid level / row / col";return 20+n*this.storageInfo.recordSize+44}_getTileEndAndContentType(t,e){const r=t.subarray(e,e+8);let i,n=0;for(i=0;i<5;i++)n|=(255&r[i])<<8*i;const a=0xffffffffff&n;for(n=0,i=5;i<8;i++)n|=(255&r[i])<<8*(i-5);return{position:a,recordSize:0xffffffffff&n}}_toHexString4(t){let e=t.toString(16);if(4!==e.length){let r=4-e.length;for(;r-- >0;)e="0"+e}return e}};(0,v._)([(0,w.Cb)({readOnly:!0})],be.prototype,"storageInfo",void 0),(0,v._)([(0,w.Cb)({type:String,json:{write:!0}})],be.prototype,"datasetFormat",void 0),be=(0,v._)([(0,ie.j)("esri.layers.support.rasterDatasets.CloudRaster")],be);const Mt=be;var Fe=x(17057);let Se=class extends me{constructor(){super(...arguments),this.datasetFormat="MEMORY"}open(t){var e=this;return(0,O.Z)(function*(){var g;yield e.init();const{pixelBlock:r,statistics:i,histograms:n,name:a,keyProperties:s,nativeExtent:c,transform:o}=e.data,{width:l,height:u,pixelType:m}=r,d=e.data.extent||new G.Z({xmin:-.5,ymin:.5,xmax:l-.5,ymax:u-.5,spatialReference:new _.Z({wkid:3857})}),f=null!=(g=e.data.isPseudoSpatialReference)?g:!e.data.extent,y=new Ie.Z({width:l,height:u,pixelType:m,extent:d,nativeExtent:c,transform:o,pixelSize:{x:d.width/l,y:d.height/u},spatialReference:d.spatialReference,bandCount:3,keyProperties:s||{},statistics:i,isPseudoSpatialReference:f,histograms:n});e.createRemoteDatasetStorageInfo(y,512,512),e._set("rasterInfo",y),e.updateTileInfo(),yield e._buildInMemoryRaster(r,{width:512,height:512},t),e.datasetName=a,e.url="/InMemory/"+a})()}fetchRawTile(t,e,r,i={}){const n=this._pixelBlockTiles.get(`${t}/${e}/${r}`);return Promise.resolve(n)}_buildInMemoryRaster(t,e,r){var i=this;return(0,O.Z)(function*(){var u,m;const n=i.rasterInfo.storageInfo.maximumPyramidLevel,a=i.rasterJobHandler?i.rasterJobHandler.split({pixelBlock:t,tileSize:e,maximumPyramidLevel:n},r):Promise.resolve((0,le.Vl)(t,e,n)),s=(0,b.pC)(i.rasterInfo.statistics),c=(0,b.pC)(i.rasterInfo.histograms),o=s?Promise.resolve({statistics:null,histograms:null}):i.rasterJobHandler?i.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:t},r):Promise.resolve((0,Fe.Hv)(t)),l=yield(0,ye.as)([a,o]);if(!l[0].value&&l[1].value)throw new N.Z("inmemory-raster:open","failed to build in memory raster");i._pixelBlockTiles=l[0].value,s||(i.rasterInfo.statistics=null==(u=l[1].value)?void 0:u.statistics),c||(i.rasterInfo.histograms=null==(m=l[1].value)?void 0:m.histograms)})()}};(0,v._)([(0,w.Cb)({type:String,json:{write:!0}})],Se.prototype,"datasetFormat",void 0),(0,v._)([(0,w.Cb)()],Se.prototype,"data",void 0),Se=(0,v._)([(0,ie.j)("esri.layers.support.rasterDatasets.InMemoryRaster")],Se);const Ot=Se;function pe(t,e){if(!t||!e)return[];let r=e;e.includes("/")?(r=e.slice(0,e.indexOf("/")),e=e.slice(e.indexOf("/")+1)):e="";const i=[];if(e){const a=pe(t,r);for(let s=0;s<a.length;s++)pe(a[s],e).forEach(c=>i.push(c));return i}const n=t.getElementsByTagNameNS("*",r);if(!n||0===n.length)return[];for(let a=0;a<n.length;a++)i.push(n[a]||n.item[a]);return i}function X(t,e){if(!t||!e)return null;let r=e;e.includes("/")?(r=e.slice(0,e.indexOf("/")),e=e.slice(e.indexOf("/")+1)):e="";const i=pe(t,r);return i.length>0?e?X(i[0],e):i[0]:null}function Q(t,e=null){const r=e?X(t,e):t;let i;return r?(i=r.textContent||r.nodeValue,i?i.trim():null):null}function Me(t,e){return function Bt(t,e){const r=pe(t,e),i=[];let n;for(let a=0;a<r.length;a++)n=r[a].textContent||r[a].nodeValue,n&&(n=n.trim(),""!==n&&i.push(n));return i}(t,e).map(r=>Number(r))}function ue(t,e){const r=Q(t,e);return Number(r)}function Ne(t,e){var n;const r=null==(n=null==t?void 0:t.nodeName)?void 0:n.toLowerCase(),i=e.toLowerCase();return r.slice(r.lastIndexOf(":")+1)===i}var Le=x(85374);function Ye(t,e){if(!t||!e)return null;const r=[];for(let i=0;i<t.length;i++)r.push(t[i]),r.push(e[i]);return r}function Oe(t){if(!t)return null;let e=Number(t);if(!isNaN(e)&&0!==e)return new _.Z({wkid:e});if((t=String(t)).startsWith("COMPD_CS")){if(!t.includes("VERTCS")||!t.includes("GEOGCS")&&!t.startsWith("PROJCS"))return null;const r=t.indexOf("VERTCS"),i=t.indexOf("PROJCS"),n=i>-1?i:t.indexOf("GEOGCS");if(-1===n)return null;const a=t.slice(n,t.lastIndexOf("]",r)+1).trim(),s=t.slice(r,t.lastIndexOf("]")).trim();e=We(a);const c=new _.Z(e?{wkid:e}:{wkt:a}),o=We(s);return o&&(c.vcsWkid=o),c}return t.startsWith("GEOGCS")||t.startsWith("PROJCS")?(e=We(t),new _.Z(0!==e?{wkid:e}:{wkt:t})):null}function We(t){var n;const e=t.replace(/\]/g,"[").replace(/\"/g,"").split("[").map(a=>a.trim()).filter(a=>""!==a),r=e[e.length-1].split(","),i=null==(n=r[0])?void 0:n.toLowerCase();if(("epsg"===i||"esri"===i)&&t.endsWith('"]]')){const a=Number(r[1]);if(!isNaN(a)&&0!==a)return a}return 0}function Ae(t){var i;if("pamdataset"!==(null==(i=null==t?void 0:t.documentElement.tagName)?void 0:i.toLowerCase()))return{};const e={spatialReference:null,transform:null,metadata:{},rasterBands:[],statistics:null,histograms:null};t.documentElement.childNodes.forEach(n=>{if(1===n.nodeType)if(Ne(n,"SRS")){if(!e.spatialReference){const a=Q(n);e.spatialReference=Oe(a)}}else if(Ne(n,"Metadata"))if("xml:ESRI"===n.getAttribute("domain")){const{spatialReference:a,transform:s}=function Dt(t){var u;const e=X(t,"GeodataXform"),r=Oe(ue(e,"SpatialReference/WKID")||Q(e,"SpatialReference/WKT"));if("typens:PolynomialXform"!==e.getAttribute("xsi:type"))return{spatialReference:r,transform:null};const i=null!=(u=ue(e,"PolynomialOrder"))?u:1,n=Me(e,"CoeffX/Double"),a=Me(e,"CoeffY/Double"),s=Me(e,"InverseCoeffX/Double"),c=Me(e,"InverseCoeffY/Double"),o=Ye(n,a),l=Ye(s,c);return{spatialReference:r,transform:new Le.Z({spatialReference:r,polynomialOrder:i,forwardCoefficients:o,inverseCoefficients:l})}}(n);e.transform=s,e.spatialReference||(e.spatialReference=a)}else pe(n,"MDI").forEach(a=>e.metadata[a.getAttribute("key")]=Q(a));else if(Ne(n,"PAMRasterBand")){const a=function Zt(t){var d;const e=ue(t,"NoDataValue"),r=X(t,"Histograms/HistItem"),i=ue(r,"HistMin"),n=ue(r,"HistMax"),a=ue(r,"BucketCount"),s=null==(d=Q(r,"HistCounts"))?void 0:d.split("|").map(f=>Number(f));let c,o,l,u;pe(t,"Metadata/MDI").forEach(f=>{var y;const h=Number(null!=(y=f.textContent)?y:f.nodeValue);switch(f.getAttribute("key").toUpperCase()){case"STATISTICS_MINIMUM":c=h;break;case"STATISTICS_MAXIMUM":o=h;break;case"STATISTICS_MEAN":l=h;break;case"STATISTICS_STDDEV":u=h}});const m=ue(t,"Metadata/SourceBandIndex");return{noDataValue:e,histogram:(null==s?void 0:s.length)&&null!=c&&null!=o?{min:i,max:n,size:a||s.length,counts:s}:null,sourceBandIndex:m,statistics:null!=c&&null!=o?{min:c,max:o,avg:l,stddev:u}:null}}(n);null!=a.sourceBandIndex&&null==e.rasterBands[a.sourceBandIndex]?e.rasterBands[a.sourceBandIndex]=a:e.rasterBands.push(a)}});const r=e.rasterBands;return r&&(e.statistics=r[0].statistics?r.map(s=>s.statistics):null,e.histograms=r[0].histogram?r.map(s=>s.histogram):null),e}let Be=class extends me{open(t){var e=this;return(0,O.Z)(function*(){yield e.init();const r=yield e._fetchData(t);let{spatialReference:i,statistics:n,histograms:a,transform:s}=yield e._fetchAuxiliaryData(t);const c=!i;c&&(i=new _.Z({wkid:3857})),(null==a?void 0:a.length)&&null==n&&(n=(0,Fe.Oh)(a));const{width:o,height:l}=r;let u=new G.Z({xmin:-.5,ymin:.5-l,xmax:o-.5,ymax:.5,spatialReference:i});const m=s?s.forwardTransform(u):u;let d=!0;if(s){const h=s.forwardCoefficients;d=h&&0===h[1]&&0===h[2],d&&(s=null,u=m)}const f=new Ot({data:{extent:m,nativeExtent:u,transform:s,pixelBlock:r,statistics:n,histograms:a,keyProperties:{DateType:"Processed"},isPseudoSpatialReference:c}});yield f.open(),f.data=null,e._set("rasterInfo",f.rasterInfo),e._inMemoryRaster=f})()}fetchRawTile(t,e,r,i={}){return this._inMemoryRaster.fetchRawTile(t,e,r,i)}_fetchData(t){var e=this;return(0,O.Z)(function*(){const{data:r}=yield e.request(e.url,{responseType:"array-buffer",signal:null==t?void 0:t.signal}),i=(0,Ve.y)(r).toUpperCase();if("JPG"!==i&&"PNG"!==i&&"GIF"!==i&&"BMP"!==i)throw new N.Z("image-aux-raster:open","the data is not a supported format");e._set("datasetFormat",i);const n=i.toLowerCase(),a="gif"===n||"bmp"===n||!(0,st.Z)("ios");return yield e.decodePixelBlock(r,{format:n,useCanvas:a,hasNoZlibMask:!0})})()}_fetchAuxiliaryData(t){var e=this;return(0,O.Z)(function*(){var u,m;const r=(0,b.Wg)(null==t?void 0:t.signal),i=null!=(u=e.ioConfig.skipExtensions)?u:[],n=i.includes("aux.xml")?null:e.request(e.url+".aux.xml",{responseType:"xml",signal:r}),a=e.datasetFormat,s="JPG"===a?"jgw":"PNG"===a?"pgw":"BMP"===a?"bpw":null,c=i.includes(s)?null:e.request(e.url.slice(0,e.url.lastIndexOf("."))+"."+s,{responseType:"text",signal:r}),o=yield(0,ye.as)([n,c]);if(null==r?void 0:r.aborted)throw(0,ye.zE)();const l=Ae(null==(m=o[0].value)?void 0:m.data);if(!l.transform){const d=o[1].value?o[1].value.data.split("\n").slice(0,6).map(f=>Number(f)):null;l.transform=6===(null==d?void 0:d.length)?new Le.Z({forwardCoefficients:[d[4],d[5],d[0],-d[1],d[2],-d[3]]}):null}return l})()}};(0,v._)([(0,w.Cb)({type:String,json:{write:!0}})],Be.prototype,"datasetFormat",void 0),Be=(0,v._)([(0,ie.j)("esri.layers.support.rasterDatasets.ImageAuxRaster")],Be);const De=Be;var Et=x(21726),kt=x(51026),zt=x(28930),Ht=x(76671),Nt=x(99208);let Re=class extends me{constructor(){super(...arguments),this._levelOffset=0,this._tilemapCache=null,this._slices=null,this.datasetFormat="RasterTileServer"}open(t){var e=this;return(0,O.Z)(function*(){var c,o;yield e.init();const r=t&&t.signal,i=e.sourceJSON?{data:e.sourceJSON}:yield e.request(e.url,{query:{f:"json"},signal:r});i.ssl&&(e.url=e.url.replace(/^http:/i,"https:"));const n=i.data;if(e.sourceJSON=n,!n)throw new N.Z("imageserverraster:open","cannot initialize tiled image service, missing service info");if(!n.tileInfo)throw new N.Z("imageserverraster:open","use ImageryLayer to open non-tiled image services");e._fixScaleInServiceInfo(),e.tileType=n.cacheType,null==e.tileType&&(e.tileType=["jpg","jpeg","png","png8","png24","png32","mixed"].includes(n.tileInfo.format.toLowerCase())?"Map":"lerc"===n.tileInfo.format.toLowerCase()?"Elevation":"Raster"),e.datasetName=n.name.slice(n.name.indexOf("/")+1);const s=yield e._fetchRasterInfo({signal:r});if(!(0,b.pC)(s))throw new N.Z("image-server-raster:open","cannot initialize image service");{const l="Map"===e.tileType?(0,kt.d)(n.tileInfo,n):de.Z.fromJSON(n.tileInfo),{extent:u,pixelSize:m}=s,d=.5/s.width*m.x;let f,h;const y=l.lodAt(Math.max.apply(null,l.lods.map(P=>P.level)));"Map"!==e.tileType&&0!==n.maxScale&&("Raster"===e.tileType?(f=l.lods.find(P=>P.resolution===m.x),f||(f=l.lods[l.lods.length-1])):(f=l.lods.find(P=>Math.abs(P.scale-n.maxScale)<d),f||(f=l.lods.filter(P=>P.scale>n.maxScale).sort((P,C)=>P.scale>C.scale?1:-1)[0])),m.x=m.y=f.resolution,s.width=Math.ceil((u.xmax-u.xmin)/m.x-.1),s.height=Math.ceil((u.ymax-u.ymin)/m.y-.1)),f||(f=y);const g=l.lodAt(Math.min.apply(null,l.lods.map(P=>P.level)));"Map"===e.tileType?e._levelOffset=l.lods[0].level:0!==n.minScale&&"Elevation"===e.tileType&&(h=l.lods.find(P=>Math.abs(P.scale-n.minScale)<d),e._levelOffset=h.level-g.level),h||(h=g);const p=Math.max(m.x,m.y);(Math.abs(m.x-m.y)>d||!l.lods.some(P=>Math.abs(P.resolution-p)<d))&&(m.x=m.y=f.resolution,s.width=Math.ceil((u.xmax-u.xmin)/m.x-.1),s.height=Math.ceil((u.ymax-u.ymin)/m.y-.1));const I=f.level-h.level,[R,M]=l.size,F=[];l.lods.forEach(P=>{P.level>=h.level&&P.level<=f.level&&F.push({x:P.resolution,y:P.resolution})}),F.sort((P,C)=>P.x-C.x);const B=e.computeBlockBoundary(u,R,M,l.origin,F,I),T=F.length>1?F.slice(1):null;let S;n.transposeInfo&&(S={tileSize:[n.transposeInfo.rows,n.transposeInfo.cols],packetSize:null!=(o=null==(c=s.keyProperties)?void 0:c._yxs.PacketSize)?o:0}),s.storageInfo=new ve.Z({blockWidth:l.size[0],blockHeight:l.size[1],pyramidBlockWidth:l.size[0],pyramidBlockHeight:l.size[1],pyramidResolutions:T,compression:l.format,origin:l.origin,firstPyramidLevel:1,maximumPyramidLevel:I,tileInfo:l,transposeInfo:S,blockBoundary:B}),e._fixGCSShift(s),e._set("rasterInfo",s)}if(n.capabilities.toLowerCase().includes("tilemap")){const l={tileInfo:s.storageInfo.tileInfo,parsedUrl:(0,Et.mN)(e.url),url:e.url,tileServers:[],type:"tile"};e._tilemapCache=new zt.y({layer:l})}})()}fetchRawTile(t,e,r,i={}){var n=this;return(0,O.Z)(function*(){const{storageInfo:a,extent:s}=n.rasterInfo,{transposeInfo:c}=a,o=(0,b.pC)(c)&&!!i.transposedVariableName;if(n._slices&&!o&&null==i.sliceId)return null;const u=`${n.url}/tile/${o?0:a.maximumPyramidLevel-t+n._levelOffset}/${e}/${r}`,m=n._slices?o?{variable:i.transposedVariableName}:{sliceId:i.sliceId||0}:null,{data:d}=yield n.request(u,{query:m,responseType:"array-buffer",signal:i.signal});if(!d)return null;const f=o?c.tileSize:a.tileInfo.size,h=yield n.decodePixelBlock(d,{width:f[0],height:f[1],planes:null,pixelType:null,isPoint:"Elevation"===n.tileType,returnPixelInterleavedDims:o}),y=a.blockBoundary[t];if("jpg"!==a.compression||r>y.minCol&&r<y.maxCol&&e>y.minRow&&e<y.maxRow)return h;const{origin:g,blockWidth:p,blockHeight:I}=a,{x:R,y:M}=n.getPyramidPixelSize(t),F=Math.round((s.xmin-g.x)/R)%p,B=Math.round((s.xmax-g.x)/R)%p||p,T=Math.round((g.y-s.ymax)/M)%I,S=Math.round((g.y-s.ymin)/M)%I||I,P=r===y.minCol?F:0,C=e===y.minRow?T:0;return(0,le.pW)(h,{x:P,y:C},{width:(r===y.maxCol?B:p)-P,height:(e===y.maxRow?S:I)-C}),h})()}getSliceIndex(t){if(!this._slices||(0,b.Wi)(t)||0===t.length)return null;const e=t;for(let r=0;r<this._slices.length;r++){const i=this._slices[r].multidimensionalDefinition;if(i.length===e.length&&!i.some(n=>{const a=e.find(s=>n.variableName===s.variableName&&s.dimensionName===n.dimensionName);return!a||(Array.isArray(n.values[0])?`${n.values[0][0]}-${n.values[0][1]}`:n.values[0])!==(Array.isArray(a.values[0])?`${a.values[0][0]}-${a.values[0][1]}`:a.values[0])}))return r}return null}fetchVariableStatisticsHistograms(t,e){var r=this;return(0,O.Z)(function*(){const i=r.request(r.url+"/statistics",{query:{variable:t,f:"json"},signal:e}).then(s=>{var c;return null==(c=s.data)?void 0:c.statistics}),n=r.request(r.url+"/histograms",{query:{variable:t,f:"json"},signal:e}).then(s=>{var c;return null==(c=s.data)?void 0:c.histograms}),a=yield Promise.all([i,n]);return a[0]&&a[0].forEach(s=>{s.avg=s.mean,s.stddev=s.standardDeviation}),{statistics:a[0]||null,histograms:a[1]||null}})()}computeBestPyramidLevelForLocation(t,e={}){var r=this;return(0,O.Z)(function*(){if(!r._tilemapCache)return 0;let i=r.identifyPixelLocation(t,0,(0,b.Wg)(e.datumTransformation));if(null===i)return null;let n=0;const{maximumPyramidLevel:a}=r.rasterInfo.storageInfo;let s=a-n+r._levelOffset;const c=i.srcLocation;for(;s>=0;){try{if("available"===(yield r._tilemapCache.fetchAvailability(s,i.row,i.col,e)))break}catch(o){}if(s--,n++,i=r.identifyPixelLocation(c,n,(0,b.Wg)(e.datumTransformation)),null===i)return null}return-1===s||null==i?null:n})()}_fetchRasterInfo(t){var e=this;return(0,O.Z)(function*(){const r=e.sourceJSON;if("Map"===e.tileType){const c=Math.ceil((r.extent.xmax-r.extent.xmin)/r.pixelSizeX-.1),o=Math.ceil((r.extent.ymax-r.extent.ymin)/r.pixelSizeY-.1),l=_.Z.fromJSON(r.spatialReference||r.extent.spatialReference),u=new V.Z({x:r.pixelSizeX,y:r.pixelSizeY,spatialReference:l});return new Ie.Z({width:c,height:o,bandCount:3,extent:G.Z.fromJSON(r.extent),spatialReference:l,pixelSize:u,pixelType:"u8",statistics:null,keyProperties:{DataType:"processed"}})}const{signal:i}=t,n=(0,Nt.g)(e.url,e.sourceJSON,{signal:i,query:e.ioConfig.customFetchParameters}),a=r.hasMultidimensions?e.request(`${e.url}/slices`,{query:{f:"json"},signal:i}).then(c=>c.data&&c.data.slices).catch(()=>null):null,s=yield Promise.all([n,a]);return e._slices=s[1],s[0]})()}_fixScaleInServiceInfo(){const{sourceJSON:t}=this;t.minScale&&t.minScale<0&&(t.minScale=0),t.maxScale&&t.maxScale<0&&(t.maxScale=0)}_fixGCSShift(t){const{extent:e,spatialReference:r}=t;0===e.xmin&&360===e.xmax&&r.wkid&&r.isGeographic&&(t.nativeExtent=t.extent,t.transform=new Ht.Z,t.extent=t.transform.forwardTransform(e))}};(0,v._)([(0,w.Cb)({type:String,json:{write:!0}})],Re.prototype,"datasetFormat",void 0),(0,v._)([(0,w.Cb)()],Re.prototype,"tileType",void 0),Re=(0,v._)([(0,ie.j)("esri.layers.support.rasterDatasets.ImageServerRaster")],Re);const Lt=Re;var Wt=x(60295),At=x(44853);const re=new Map;re.set("Int8","s8"),re.set("UInt8","u8"),re.set("Int16","s16"),re.set("UInt16","u16"),re.set("Int32","s32"),re.set("UInt32","u32"),re.set("Float32","f32"),re.set("Float64","f32"),re.set("Double64","f32");const ae=new Map;ae.set("none",{blobExtension:".til",isOneSegment:!0,decoderFormat:"bip"}),ae.set("lerc",{blobExtension:".lrc",isOneSegment:!1,decoderFormat:"lerc"}),ae.set("deflate",{blobExtension:".pzp",isOneSegment:!0,decoderFormat:"deflate"}),ae.set("jpeg",{blobExtension:".pjg",isOneSegment:!0,decoderFormat:"jpg"});let he=class extends me{constructor(){super(...arguments),this._files=null,this._storageIndex=null,this.datasetFormat="MRF"}open(t){var e=this;return(0,O.Z)(function*(){var g,p;yield e.init(),e.datasetName=e.url.slice(e.url.lastIndexOf("/")+1);const r=t?(0,b.Wg)(t.signal):null,i=yield e.request(e.url,{responseType:"xml",signal:r}),{rasterInfo:n,files:a}=e._parseHeader(i.data);if(-1===(null==(g=e.ioConfig.skipExtensions)?void 0:g.indexOf("aux.xml"))){const I=yield e._fetchAuxiliaryData(t);null!=I&&(n.statistics=null!=(p=I.statistics)?p:n.statistics,n.histograms=I.histograms,I.histograms&&(0,b.Wi)(n.statistics)&&(n.statistics=(0,Fe.Oh)(I.histograms)))}e._set("rasterInfo",n),e._files=a;const s=yield e.request(a.index,{responseType:"array-buffer",signal:r});e._storageIndex=e._parseIndex(s.data);const{blockWidth:c,blockHeight:o}=e.rasterInfo.storageInfo,l=e.rasterInfo.storageInfo.pyramidScalingFactor,{width:u,height:m}=e.rasterInfo,d=[],f=e._getBandSegmentCount();let h=0,y=-1;for(;h<e._storageIndex.length;){y++;const I=Math.ceil(u/c/l**y)-1,R=Math.ceil(m/o/l**y)-1;h+=(I+1)*(R+1)*f*4,d.push({maxRow:R,maxCol:I,minCol:0,minRow:0})}e.rasterInfo.storageInfo.blockBoundary=d,y>0&&(e.rasterInfo.storageInfo.firstPyramidLevel=1,e.rasterInfo.storageInfo.maximumPyramidLevel=y),e.updateTileInfo()})()}fetchRawTile(t,e,r,i={}){var n=this;return(0,O.Z)(function*(){const{blockWidth:a,blockHeight:s,blockBoundary:c}=n.rasterInfo.storageInfo,o=c[t];if(!o||o.maxRow<e||o.maxCol<r||o.minRow>e||o.minCol>r)return null;const{bandCount:l,pixelType:u}=n.rasterInfo,{ranges:m,actualTileWidth:d,actualTileHeight:f}=n._getTileLocation(t,e,r);if(!m||0===m.length)return null;if(0===m[0].from&&0===m[0].to){const C=new Uint8Array(a*s);return new Wt.Z({width:a,height:s,pixels:null,mask:C,validPixelCount:0})}const{bandIds:h}=n.ioConfig,y=n._getBandSegmentCount(),g=[];let p=0;for(p=0;p<y;p++)(!h||h.indexOf[p]>-1)&&g.push(n.request(n._files.data,{range:{from:m[p].from,to:m[p].to},responseType:"array-buffer",signal:i.signal}));const I=yield Promise.all(g),R=I.map(C=>C.data.byteLength).reduce((C,Z)=>C+Z),M=new Uint8Array(R);let F=0;for(p=0;p<y;p++)M.set(new Uint8Array(I[p].data),F),F+=I[p].data.byteLength;const B=ae.get(n.rasterInfo.storageInfo.compression).decoderFormat,T=yield n.decodePixelBlock(M.buffer,{width:a,height:s,format:B,planes:(null==h?void 0:h.length)||l,pixelType:u});if((0,b.pC)(n.rasterInfo.noDataValue)&&"lerc"!==B&&!T.mask){const C=n.rasterInfo.noDataValue[0];if(null!=C){const Z=T.width*T.height,k=new Uint8Array(Z);if(Math.abs(C)>1e24)for(p=0;p<Z;p++)Math.abs((T.pixels[0][p]-C)/C)>1e-6&&(k[p]=1);else for(p=0;p<Z;p++)T.pixels[0][p]!==C&&(k[p]=1);T.mask=k}}let S=0,P=0;if(d!==a||f!==s){let C=T.mask;if(C)for(p=0;p<s;p++)if(P=p*a,p<f)for(S=d;S<a;S++)C[P+S]=0;else for(S=0;S<a;S++)C[P+S]=0;else for(C=new Uint8Array(a*s),T.mask=C,p=0;p<f;p++)for(P=p*a,S=0;S<d;S++)C[P+S]=1}return T})()}_parseIndex(t){if(t.byteLength%16>0)throw"invalid array buffer must be multiples of 16";let e,r,i,n,a,s;if(At.f){for(r=new Uint8Array(t),n=new ArrayBuffer(t.byteLength),i=new Uint8Array(n),a=0;a<t.byteLength/4;a++)for(s=0;s<4;s++)i[4*a+s]=r[4*a+3-s];e=new Uint32Array(n)}else e=new Uint32Array(t);return e}_getBandSegmentCount(){return ae.get(this.rasterInfo.storageInfo.compression).isOneSegment?1:this.rasterInfo.bandCount}_getTileLocation(t,e,r){const{blockWidth:i,blockHeight:n,pyramidScalingFactor:a}=this.rasterInfo.storageInfo,{width:s,height:c}=this.rasterInfo,o=this._getBandSegmentCount();let l,u,m,d=0,f=0;for(m=0;m<t;m++)f=a**m,l=Math.ceil(s/i/f),u=Math.ceil(c/n/f),d+=l*u;f=a**t,l=Math.ceil(s/i/f),u=Math.ceil(c/n/f),d+=e*l+r,d*=4*o;const h=this._storageIndex.subarray(d,d+4*o);let y=0,g=0;const p=[];for(let I=0;I<o;I++)y=h[4*I+0]*2**32+h[4*I+1],g=y+h[4*I+2]*2**32+h[4*I+3],p.push({from:y,to:g});return{ranges:p,actualTileWidth:r<l-1?i:Math.ceil(s/f)-i*(l-1),actualTileHeight:e<u-1?n:Math.ceil(c/f)-n*(u-1)}}_parseHeader(t){const e=X(t,"MRF_META/Raster");if(!e)throw new N.Z("mrf:open","not a valid MRF format");const r=X(e,"Size"),i=parseInt(r.getAttribute("x"),10),n=parseInt(r.getAttribute("y"),10),a=parseInt(r.getAttribute("c"),10),s=(Q(e,"Compression")||"none").toLowerCase();if(!ae.has(s))throw new N.Z("mrf:open","currently does not support compression "+s);const c=Q(e,"DataType")||"UInt8",o=re.get(c);if(null==o)throw new N.Z("mrf:open","currently does not support pixel type "+c);const l=X(e,"PageSize"),u=parseInt(l.getAttribute("x"),10),m=parseInt(l.getAttribute("y"),10),d=X(e,"DataValues");let f,h;if(d&&(h=d.getAttribute("NoData"),null!=h&&(f=h.trim().split(" ").map(Z=>parseFloat(Z)))),X(t,"MRF_META/CachedSource"))throw new N.Z("mrf:open","currently does not support MRF referencing other data files");const y=X(t,"MRF_META/GeoTags"),g=X(y,"BoundingBox");let p,I=!1;if(null!=g){const Z=parseFloat(g.getAttribute("minx")),k=parseFloat(g.getAttribute("miny")),Y=parseFloat(g.getAttribute("maxx")),q=parseFloat(g.getAttribute("maxy")),D=Q(y,"Projection")||"";let A;if("LOCAL_CS[]"!==D)if(D.toLowerCase().startsWith("epsg:")){const j=Number(D.slice(5));isNaN(j)||0===j||(A=new _.Z({wkid:j}))}else A=Oe(D);else I=!0,A=new _.Z({wkid:3857});p=new G.Z(Z,k,Y,q),p.spatialReference=A}else I=!0,p=new G.Z({xmin:-.5,ymin:.5-n,xmax:i-.5,ymax:.5,spatialReference:new _.Z({wkid:3857})});const R=X(t,"MRF_META/Rsets"),M=parseInt(R&&R.getAttribute("scale")||"2",10),F=p.spatialReference,B=new ve.Z({origin:new V.Z({x:p.xmin,y:p.ymax,spatialReference:F}),blockWidth:u,blockHeight:m,pyramidBlockWidth:u,pyramidBlockHeight:m,compression:s,pyramidScalingFactor:M}),T=new V.Z({x:p.width/i,y:p.height/n,spatialReference:F}),S=new Ie.Z({width:i,height:n,extent:p,isPseudoSpatialReference:I,spatialReference:F,bandCount:a,pixelType:o,pixelSize:T,noDataValue:f,storageInfo:B}),P=Q(t,"datafile"),C=Q(t,"IndexFile");return{rasterInfo:S,files:{mrf:this.url,index:C||this.url.replace(".mrf",".idx"),data:P||this.url.replace(".mrf",ae.get(s).blobExtension)}}}_fetchAuxiliaryData(t){var e=this;return(0,O.Z)(function*(){try{const{data:r}=yield e.request(e.url+".aux.xml",{responseType:"xml",signal:null==t?void 0:t.signal});return Ae(r)}catch(r){return null}})()}};(0,v._)([(0,w.Cb)()],he.prototype,"_files",void 0),(0,v._)([(0,w.Cb)()],he.prototype,"_storageIndex",void 0),(0,v._)([(0,w.Cb)({type:String,json:{write:!0}})],he.prototype,"datasetFormat",void 0),he=(0,v._)([(0,ie.j)("esri.layers.support.rasterIO.MRFRaster")],he);const Jt=he;var Te=x(93122),Ze=x(635);const Ke=(t,e)=>{const r=t.get(e);return r&&r.values},Ee=(t,e)=>{const r=t.get(e);return r&&r.values[0]};let fe=class extends me{constructor(){super(...arguments),this._files=null,this._headerInfo=null,this._bufferSize=1048576,this.datasetFormat="TIFF"}open(t){var e=this;return(0,O.Z)(function*(){var A,j,ne,$;yield e.init();const r=t?(0,b.Wg)(t.signal):null,{data:i}=yield e.request(e.url,{range:{from:0,to:e._bufferSize},responseType:"array-buffer",signal:r});if(!i)throw new N.Z("tiffraster:open","failed to open url "+e.url);e.datasetName=e.url.slice(e.url.lastIndexOf("/")+1);const{littleEndian:n,firstIFD:a,isBigTiff:s}=(0,Te.cK)(i),c=[];yield e._readIFDs(c,i,n,a,0,s?8:4,r);const o=(0,Te.FI)(c),{width:l,height:u,tileWidth:m,tileHeight:d,planes:f,pixelType:h,compression:y,firstPyramidLevel:g,maximumPyramidLevel:p,pyramidBlockWidth:I,pyramidBlockHeight:R,tileBoundary:M,affine:F,metadata:B}=o;let S=Oe((null==(A=o.extent.spatialReference)?void 0:A.wkt)||(null==(j=o.extent.spatialReference)?void 0:j.wkid)),P=!1;null==S&&(P=!0,S=new _.Z({wkid:3857}));const C=new G.Z(U(z({},o.extent),{spatialReference:S})),Z=new V.Z(C?{x:C.xmin,y:C.ymax,spatialReference:S}:{x:0,y:0}),k=new ve.Z({blockWidth:m,blockHeight:d,pyramidBlockWidth:I,pyramidBlockHeight:R,compression:y,origin:Z,firstPyramidLevel:g,maximumPyramidLevel:p,blockBoundary:M}),Y=new V.Z({x:(C.xmax-C.xmin)/l,y:(C.ymax-C.ymin)/u,spatialReference:S}),D=new Ie.Z({width:l,height:u,bandCount:f,pixelType:h,compression:y,pixelSize:Y,storageInfo:k,spatialReference:S,isPseudoSpatialReference:P,keyProperties:B?{BandProperties:B.bandProperties,DataType:B.dataType}:{},extent:C,statistics:B?B.statistics:null});if((null==F?void 0:F.length)&&(D.nativeExtent=new G.Z({xmin:-.5,ymin:.5-u,xmax:l-.5,ymax:.5,spatialReference:S}),D.transform=new Le.Z({polynomialOrder:1,forwardCoefficients:[F[2]+F[0]/2,F[5]-F[3]/2,F[0],F[3],-F[1],-F[4]]}),D.extent=D.transform.forwardTransform(D.nativeExtent),D.pixelSize=new V.Z({x:(C.xmax-C.xmin)/l,y:(C.ymax-C.ymin)/u,spatialReference:S}),k.origin.x=-.5,k.origin.y=.5),!(null==(ne=e.ioConfig.skipExtensions)?void 0:ne.includes("aux.xml"))){const E=yield e._fetchAuxiliaryData(t);if(null!=E){if(D.statistics=null!=($=E.statistics)?$:D.statistics,D.histograms=E.histograms,E.histograms&&(0,b.Wi)(D.statistics)&&(D.statistics=(0,Fe.Oh)(E.histograms)),E.transform&&!F){D.transform=E.transform,D.nativeExtent=D.extent;const ee=D.transform.forwardTransform(D.nativeExtent);D.pixelSize=new V.Z({x:(ee.xmax-ee.xmin)/l,y:(ee.ymax-ee.ymin)/u,spatialReference:S}),D.extent=ee}D.spatialReference||(D.spatialReference=E.spatialReference)}}if(e._set("rasterInfo",D),e._headerInfo=z({littleEndian:n,isBigTiff:s,ifds:c},o),!e._headerInfo.isSupported)throw new N.Z("tiffraster:open","this tiff is not supported: "+e._headerInfo.message);e.updateTileInfo()})()}fetchRawTile(t,e,r,i={}){var n=this;return(0,O.Z)(function*(){var B;if(!(null==(B=n._headerInfo)?void 0:B.isSupported)||n.isBlockOutside(t,e,r))return null;const a=n._getTileLocation(t,e,r);if(!a)return null;const{ranges:s,actualTileWidth:c,actualTileHeight:o,ifd:l}=a,u=s.map(T=>n.request(n.url,{range:T,responseType:"array-buffer",signal:i.signal})),m=yield Promise.all(u),d=m.map(T=>T.data.byteLength).reduce((T,S)=>T+S),f=1===m.length?m[0].data:new ArrayBuffer(d),h=[0],y=[0];if(m.length>1){const T=new Uint8Array(f);for(let S=0,P=0;S<m.length;S++){const C=m[S].data;T.set(new Uint8Array(C),P),h[S]=P,P+=C.byteLength,y[S]=C.byteLength}}const{blockWidth:g,blockHeight:p}=n.getBlockWidthHeight(t),I=yield n.decodePixelBlock(f,{format:"tiff",customOptions:{headerInfo:n._headerInfo,ifd:l,offsets:h,sizes:y},width:g,height:p,planes:null,pixelType:null});let R,M,F;if(c!==g||o!==p){let T=I.mask;if(T)for(R=0;R<p;R++)if(F=R*g,R<o)for(M=c;M<g;M++)T[F+M]=0;else for(M=0;M<g;M++)T[F+M]=0;else for(T=new Uint8Array(g*p),I.mask=T,R=0;R<o;R++)for(F=R*g,M=0;M<c;M++)T[F+M]=1}return I})()}_readIFDs(t,e,r,i,n,a=4,s){var c=this;return(0,O.Z)(function*(){if(!i)return null;(i>=e.byteLength||i<0)&&(e=(yield c.request(c.url,{range:{from:i+n,to:i+n+c._bufferSize},responseType:"array-buffer",signal:s})).data,n=i+n,i=0);const o=yield c._readIFD(e,r,i,n,Ze.Z.TIFF_TAGS,a,s);if(t.push(o.ifd),!o.nextIFD)return null;yield c._readIFDs(t,e,r,o.nextIFD-n,n,a,s)})()}_readIFD(t,e,r,i,n=Ze.Z.TIFF_TAGS,a=4,s){var c=this;return(0,O.Z)(function*(){if(!t)return null;const o=(0,Te.vr)(t,e,r,i,n,a);if(o.success){const l=[];if(o.ifd.forEach(u=>{u.values||l.push(u)}),l.length>0){const u=l.map(d=>d.offlineOffsetSize),m=Math.min.apply(null,u.map(d=>d[0]));if(Math.min.apply(null,u.map(d=>d[0]+d[1]))-m<=c._bufferSize){const{data:d}=yield c.request(c.url,{range:{from:m,to:m+c._bufferSize},responseType:"array-buffer",signal:s});t=d,i=m,l.forEach(f=>(0,Te.Dq)(t,e,f,i))}}if(o.ifd.has("GEOKEYDIRECTORY")){const u=o.ifd.get("GEOKEYDIRECTORY"),m=u.values;if(m&&m.length>4){const d=m[0]+"."+m[1]+"."+m[2],f=yield c._readIFD(t,e,u.valueOffset+6-i,i,Ze.Z.GEO_KEYS,2,s);u.data=f.ifd,u.data&&u.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[d]})}}return o}return o.requiredBufferSize&&o.requiredBufferSize!==t.byteLength?(t=(yield c.request(c.url,{range:{from:i,to:i+o.requiredBufferSize+4},responseType:"array-buffer",signal:s})).data).byteLength<o.requiredBufferSize?null:c._readIFD(t,e,0,i,Ze.Z.TIFF_TAGS,4,s):void 0})()}_getTileLocation(t,e,r){const{firstPyramidLevel:i,blockBoundary:n}=this.rasterInfo.storageInfo,a=0===t?0:t-(i-1),s=this._headerInfo.ifds[a];if(!s)return null;const c=(0,Te.If)(s,this._headerInfo),o=Ke(s,"TILEOFFSETS");if(void 0===o)return null;const l=Ke(s,"TILEBYTECOUNTS"),{minRow:u,minCol:m,maxRow:d,maxCol:f}=n[a];if(e>d||r>f||e<u||r<m)return null;const h=Ee(s,"IMAGEWIDTH"),y=Ee(s,"IMAGELENGTH"),g=Ee(s,"TILEWIDTH"),p=Ee(s,"TILELENGTH"),I=c?this.rasterInfo.bandCount:1,R=I*e*(f+1)+r,M=[{from:o[R],to:o[R+I-1]+l[R+I-1]-1}];if(c){let T=!0;for(let S=0;S<I;S++)if(o[R+S]+l[R+S]!==o[R+S+1]){T=!1;break}if(!T)for(let S=0;S<I;S++)M[S]={from:o[R+S],to:o[R+S]+l[R+S]-1}}return null==o[R]||null==l[R]?null:{ranges:M,ifd:s,actualTileWidth:r===f?h%g:g,actualTileHeight:e===d?y%p:p}}_fetchAuxiliaryData(t){var e=this;return(0,O.Z)(function*(){try{const{data:r}=yield e.request(e.url+".aux.xml",{responseType:"xml",signal:null==t?void 0:t.signal});return Ae(r)}catch(r){return null}})()}};(0,v._)([(0,w.Cb)()],fe.prototype,"_files",void 0),(0,v._)([(0,w.Cb)()],fe.prototype,"_headerInfo",void 0),(0,v._)([(0,w.Cb)()],fe.prototype,"_bufferSize",void 0),(0,v._)([(0,w.Cb)({type:String,json:{write:!0}})],fe.prototype,"datasetFormat",void 0),fe=(0,v._)([(0,ie.j)("esri.layers.support.rasterDatasets.TIFFRaster")],fe);const jt=fe,J=new Map;J.set("CRF",{desc:"Cloud Raster Format",constructor:Mt}),J.set("MRF",{desc:"Meta Raster Format",constructor:Jt}),J.set("TIFF",{desc:"GeoTIFF",constructor:jt}),J.set("RasterTileServer",{desc:"Raster Tile Server",constructor:Lt}),J.set("JPG",{desc:"JPG Raster Format",constructor:De}),J.set("PNG",{desc:"PNG Raster Format",constructor:De}),J.set("GIF",{desc:"GIF Raster Format",constructor:De}),J.set("BMP",{desc:"BMP Raster Format",constructor:De});var Gt=x(49430);let H=class extends((0,ut.h)((0,bt.M)((0,xt.q)((0,It.I)((0,ft.N)(gt((0,St.n)((0,vt.Q)((0,nt.R)(ct.Z)))))))))){constructor(...t){super(...t),this.bandIds=null,this.interpolation=null,this.legendEnabled=!0,this.isReference=null,this.listMode="show",this.sourceJSON=null,this.version=null,this.title=null,this.type="imagery-tile",this.operationalLayerType="ArcGISTiledImageServiceLayer",this.popupEnabled=!0,this.popupTemplate=null,this.fields=null}normalizeCtorArgs(t,e){return"string"==typeof t?z({url:t},e):t}load(t){const e=(0,b.pC)(t)?t.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},t).catch(ye.r9).then(()=>this._openRaster(e))),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}get rasterFields(){var n,a,s;let t=[new xe.Z({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})];const e=null==(a=null==(n=this.rasterInfo)?void 0:n.attributeTable)?void 0:a.fields;if(e){const c=e.filter(o=>"oid"!==o.type&&"value"!==o.name.toLowerCase()).map(o=>{const l=o.clone();return l.name="Raster."+o.name,l});t=t.concat(c)}const i=this.rasterInfo.dataType;if(("vector-magdir"===i||"vector-uv"===i)&&(0,b.pC)(this.rasterInfo.multidimensionalInfo)){const c=null==(s=this.rasterInfo.multidimensionalInfo.variables[0].unit)?void 0:s.trim();t.push(new xe.Z({name:"Raster.Magnitude",alias:"Magnitude"+(c?` (${c})`:""),domain:null,editable:!1,type:"double"})),t.push(new xe.Z({name:"Raster.Direction",alias:"Direction (\xb0)",domain:null,editable:!1,type:"double"}))}return t}set renderer(t){this._set("renderer",t),this.updateRenderer()}readRenderer(t,e,r){const n=(0,Ce.ij)(e&&e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.renderer,r)||void 0;if(null!=n)return n}createPopupTemplate(t){return(0,Gt.eZ)({fields:this.rasterFields,title:this.title},t)}write(t,e){const{raster:r}=this;return(this.loaded?"RasterTileServer"===r.datasetFormat&&("Raster"===r.tileType||"Map"===r.tileType):this.url&&/\/ImageServer(\/|\/?$)/i.test(this.url))?super.write(t,e):(e&&e.messages&&e.messages.push(new N.Z("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${e.origin}/${e.layerContainerType||"operational-layers"}'`,{layer:this})),null)}_openRaster(t){var e=this;return(0,O.Z)(function*(){e.raster?(e.raster.rasterInfo||(yield e.raster.open()),e.url=e.raster.url):e.raster=yield class Ut{static get supportedFormats(){const e=new Set;return J.forEach((r,i)=>e.add(i)),e}static open(e){var r=this;return(0,O.Z)(function*(){const{url:i,ioConfig:n,sourceJSON:a}=e;let s=e.datasetFormat;null==s&&i.lastIndexOf(".")&&(s=i.slice(i.lastIndexOf(".")+1).toUpperCase()),"OVR"===s||"TIF"===s?s="TIFF":"JPG"!==s&&"JPEG"!==s&&"JFIF"!==s||(s="JPG"),i.toLowerCase().includes("/imageserver")&&!i.toLowerCase().includes("/wcsserver")&&(s="RasterTileServer");const c={url:i,sourceJSON:a,datasetFormat:s,ioConfig:n||{bandIds:null,sampling:null}};let o,l;if(r.supportedFormats.has(s)){if("CRF"===s&&!n.enableCRF)throw new N.Z("rasterfactory:open",`cannot open raster: ${i}`);return o=J.get(s).constructor,l=new o(c),yield l.open({signal:e.signal}),l}if(s)throw new N.Z("rasterfactory:open","not a supported format "+s);const u=Array.from(J.keys());let m=0;const d=()=>(s=u[m++],s&&("CRF"!==s||n.enableCRF)?(o=J.get(s).constructor,l=new o(c),l.open({signal:e.signal}).then(()=>l).catch(()=>d())):null);return d()})()}static register(e,r,i){J.has(e.toUpperCase())||J.set(e.toUpperCase(),{desc:r,constructor:i})}}.open({url:e.url,sourceJSON:e.sourceJSON,ioConfig:U(z({sampling:"closest"},e.ioConfig),{customFetchParameters:e.customParameters}),signal:t});const{rasterInfo:r}=e.raster;if(!r)throw new N.Z("imagery-tile-layer:load","cannot load resources on "+e.url);if(e.sourceJSON=e.sourceJSON||e.raster.sourceJSON,null!=e.sourceJSON){const i="Map"===e.raster.tileType&&null!=e.sourceJSON.minLOD&&null!=e.sourceJSON.maxLOD?e.sourceJSON:U(z({},e.sourceJSON),{minScale:0,maxScale:0});e.read(i,{origin:"service"})}null==e.title&&(e.title=e.raster.datasetName),"Map"===e.raster.tileType&&(e.popupEnabled=!1),e._configDefaultSettings(),e.own((0,it.YP)(()=>e.customParameters,i=>{e.raster.ioConfig.customFetchParameters=i}))})()}};(0,v._)([(0,w.Cb)({type:[at.z8],json:{write:{overridePolicy(){var t;return{enabled:!this.loaded||"Raster"===this.raster.tileType||"0,1,2"!==(null==(t=this.bandIds)?void 0:t.join(","))}}}}})],H.prototype,"bandIds",void 0),(0,v._)([(0,w.Cb)({json:{write:{overridePolicy(){return{enabled:!this.loaded||"Raster"===this.raster.tileType||"bilinear"!==this.interpolation}}}}}),(0,ot.J)(Rt.c)],H.prototype,"interpolation",void 0),(0,v._)([(0,w.Cb)({json:{write:!0}})],H.prototype,"multidimensionalDefinition",void 0),(0,v._)([(0,w.Cb)(ze.rn)],H.prototype,"legendEnabled",void 0),(0,v._)([(0,w.Cb)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],H.prototype,"isReference",void 0),(0,v._)([(0,w.Cb)({type:["show","hide"]})],H.prototype,"listMode",void 0),(0,v._)([(0,w.Cb)({json:{read:!0,write:!0}})],H.prototype,"blendMode",void 0),(0,v._)([(0,w.Cb)()],H.prototype,"sourceJSON",void 0),(0,v._)([(0,w.Cb)({readOnly:!0,json:{origins:{service:{read:{source:"currentVersion"}}}}})],H.prototype,"version",void 0),(0,v._)([(0,w.Cb)()],H.prototype,"title",void 0),(0,v._)([(0,w.Cb)({readOnly:!0,json:{read:!1}})],H.prototype,"type",void 0),(0,v._)([(0,w.Cb)({type:["ArcGISTiledImageServiceLayer"]})],H.prototype,"operationalLayerType",void 0),(0,v._)([(0,w.Cb)({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:(t,e)=>!e.disablePopup},write:{target:"disablePopup",overridePolicy(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}},writer(t,e,r){e[r]=!t}}}})],H.prototype,"popupEnabled",void 0),(0,v._)([(0,w.Cb)({type:rt.Z,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}}}}})],H.prototype,"popupTemplate",void 0),(0,v._)([(0,w.Cb)({readOnly:!0})],H.prototype,"defaultPopupTemplate",null),(0,v._)([(0,w.Cb)({readOnly:!0,type:[xe.Z]})],H.prototype,"fields",void 0),(0,v._)([(0,w.Cb)({readOnly:!0,type:[xe.Z]})],H.prototype,"rasterFields",null),(0,v._)([(0,w.Cb)({types:Ce.dr,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy(){var e;const t="raster-stretch"===(null==(e=this.renderer)?void 0:e.type)&&"none"===this.renderer.stretchType&&!this.renderer.useGamma;return{enabled:!this.loaded||"Raster"===this.raster.tileType||!t}}},origins:{"web-scene":{types:Ce.FK,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:t=>({enabled:t&&"vector-field"!==t.type&&"flow"!==t.type})}}}}})],H.prototype,"renderer",null),(0,v._)([(0,lt.r)("renderer")],H.prototype,"readRenderer",null),H=(0,v._)([(0,ie.j)("esri.layers.ImageryTileLayer")],H);const Vt=H}}]);