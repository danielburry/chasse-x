"use strict";var Ie=Object.defineProperty,q=Object.getOwnPropertySymbols,ve=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable,z=(v,y,o)=>y in v?Ie(v,y,{enumerable:!0,configurable:!0,writable:!0,value:o}):v[y]=o,C=(v,y)=>{for(var o in y||(y={}))ve.call(y,o)&&z(v,o,y[o]);if(q)for(var o of q(y))Ee.call(y,o)&&z(v,o,y[o]);return v};(self.webpackChunkchasse_pwa_front=self.webpackChunkchasse_pwa_front||[]).push([[4896],{54896:(v,y,o)=>{o.r(y),o.d(y,{default:()=>ge});var m=o(15861),j=(o(29132),o(84792)),F=o(26584),w=o(63290),b=o(10699),Z=o(21726),P=o(55915),U=o(15994),S=o(37053),g=o(46367),I=o(66385),D=o(88071),A=o(82708),T=o(82959),H=o(58175);const J=/^\s*"([\S\s]*)"\s*$/,K=/""/g,Y=[","," ",";","|","\t"];function*$(s,n,e){let t=0;for(;t<=s.length;){const i=s.indexOf(n,t),r=s.substring(t,i>-1?i:void 0);t+=r.length+n.length,e&&!r.trim()||(yield r)}}function Q(s){const n=s.includes("\r\n")?"\r\n":"\n";return $(s,n,!0)}function k(s,n){return $(s,n,!1)}function*V(s,n,e,t=(()=>Object.create(null))){let i="",r="",d=0,u=t(),p=0;e:for(const l of s){const c=k(l,e);for(const f of c)if(i+=r+f,r="",d+=ee(f),d%2==0){if(d>0){const N=J.exec(i);if(!N){u=t(),p=0,i="",d=0;continue e}u[n[p]]=N[1].replace(K,'"'),p++}else u[n[p]]=i,p++;i="",d=0}else r=e;0===d?(yield u,u=t(),p=0):r="\n"}}function ee(s){let n=0,e=0;for(e=s.indexOf('"',e);e>=0;)n++,e=s.indexOf('"',e+1);return n}var L=o(56554),te=o(75327);function re(s){if(!s.length)return"string";const n=/[^+-.,0-9]/;return s.map(e=>{let t=!1;if(""!==e){if(n.test(e))t=!0;else{let i=M(e);if(!isNaN(i))return/[.,]/.test(e)||!Number.isInteger(i)||i>214783647||i<-214783648?"double":"integer";if(e.includes("E")){if(i=Number(e),!isNaN(i))return"double";if(e.includes(",")){if(e=e.replace(",","."),i=Number(e),!isNaN(i))return"double";t=!0}else t=!0}else t=!0}return t?/^[-]?\d*[.,]?\d*$/.test(e)?"string":B(new Date(e),e)?"date":"string":"string"}}).reduce((e,t)=>void 0===e||e===t?t:"string"===e||"string"===t?"string":"double"===e||"double"===t?"double":void 0)}function B(s,n){if(!s||"[object Date]"!==Object.prototype.toString.call(s)||isNaN(s.getTime()))return!1;let e=!0;if(!oe&&/\d+\W*$/.test(n)){const t=n.match(/[a-zA-Z]{2,}/);if(t){let i=!1,r=0;for(;!i&&r<=t.length;)i=!se.test(t[r]),r++;e=!i}}return e}const M=function(){const s=(0,te.lt)(),n=new RegExp("^"+s.regexp+"$"),e=new RegExp("["+s.group+"\\s\\xa0]","g"),t=s.factor;return i=>{const r=n.exec(i);if(s.factor=t,!r)return NaN;let d=r[1];if(!r[1]){if(!r[2])return NaN;d=r[2],s.factor*=-1}return d=d.replace(e,"").replace(s.decimal,"."),+d*s.factor}}(),se=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,oe=Number.isNaN(new Date("technology 10").getTime()),le=["lat","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point-y"],ae=["lon","lng","long","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point-x"];var ue=o(60466),de=o(36630),ce=o(65234);const pe=(0,L.bU)("esriGeometryPoint"),fe=["csv"],ye=[0,0];class me{constructor(n,e){this.x=n,this.y=e}}class ge{constructor(){var n=this;this._queryEngine=null,this._snapshotFeatures=function(){var e=(0,m.Z)(function*(t){const i=yield n._fetch(t);return n._createFeatures(i)});return function(t){return e.apply(this,arguments)}}()}destroy(){var n;null==(n=this._queryEngine)||n.destroy(),this._queryEngine=null}load(n,e={}){var t=this;return(0,m.Z)(function*(){var u;t.loadOptions=n;const[i]=yield Promise.all([t._fetch(e.signal),t._checkProjection(null==(u=null==n?void 0:n.parsingOptions)?void 0:u.spatialReference)]),r=function he(s,n){const e=n.parsingOptions||{},t={delimiter:e.delimiter,layerDefinition:null,locationInfo:{latitudeFieldName:e.latitudeField,longitudeFieldName:e.longitudeField}},i=Q(s);let r=i.next().value;if(!r)throw new F.Z("csv-layer:empty-csv","CSV is empty",{csv:s});if(r=r.trim(),!e.delimiter){const l=function X(s){const n=s.trim();let e=0,t="";for(const i of Y){const r=n.split(i).length;r>e&&(e=r,t=i)}return""===t?null:t}(r);if(!l)throw new F.Z("csv-layer:invalid-delimiter","Unable to detect the delimiter from CSV");t.delimiter=l}const d=r.split(t.delimiter).filter(l=>!!l),u=t.layerDefinition={name:(0,Z.vt)(n.url,fe)||"csv",drawingInfo:pe,geometryType:"esriGeometryPoint",objectIdField:null,fields:[],timeInfo:e.timeInfo,extent:{xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:e.spatialReference||{wkid:102100}}};if(!e.latitudeField||!e.longitudeField){const l=function ne(s){const n=s.map(e=>e.toLowerCase());return{longitudeFieldName:s[n.indexOf(ae.find(e=>n.includes(e)))],latitudeFieldName:s[n.indexOf(le.find(e=>n.includes(e)))]}}(d);if(!e.longitudeField&&!l.longitudeFieldName||!e.latitudeField&&!l.latitudeFieldName)throw new F.Z("csv-layer:location-fields-not-found","Unable to identify latitude and longitude fields from the CSV file");t.locationInfo={longitudeFieldName:e.longitudeField||l.longitudeFieldName,latitudeFieldName:e.latitudeField||l.latitudeFieldName}}const p=function ie(s,n,e,t){const i=[],r=V(s,e,n),d=[];for(const u of r){if(10===d.length)break;d.push(u)}for(const u of e)if(u===t.longitudeFieldName||u===t.latitudeFieldName)i.push({name:u,type:"esriFieldTypeDouble",alias:u});else{const p=re(d.map(c=>c[u])),l={name:u,type:null,alias:u};switch(p){case"integer":l.type="esriFieldTypeInteger";break;case"double":l.type="esriFieldTypeDouble";break;case"date":l.type="esriFieldTypeDate",l.length=36;break;default:l.type="esriFieldTypeString",l.length=255}i.push(l)}return i}(i,t.delimiter,d,t.locationInfo);if(e.fields&&e.fields.length){const l=new Map;for(const c of e.fields)l.set(c.name.toLowerCase(),c);for(const c of p){const f=l.get(c.name.toLowerCase());if(f){const N=c.name;Object.assign(c,f),c.name=N}}}if(u.fields=p,!u.fields.some(l=>"esriFieldTypeOID"===l.type&&(u.objectIdField=l.name,!0))){const l={name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,nullable:!1};u.objectIdField=l.name,u.fields.unshift(l)}if(u.timeInfo){const l=new ue.Z(u.fields),c=u.timeInfo;if(c.startTimeField){const f=l.get(c.startTimeField);f?(c.startTimeField=f.name,f.type="esriFieldTypeDate"):c.startTimeField=null}if(c.endTimeField){const f=l.get(c.endTimeField);f?(c.endTimeField=f.name,f.type="esriFieldTypeDate"):c.endTimeField=null}if(c.trackIdField){const f=l.get(c.trackIdField);c.trackIdField=f?f.name:null}c.startTimeField||c.endTimeField||(u.timeInfo=null)}return t}(i,n);t.locationInfo=r.locationInfo,t.delimiter=r.delimiter,t._queryEngine=t._createQueryEngine(r);const d=yield t._createFeatures(i);if(t._queryEngine.featureStore.addMany(d),r.layerDefinition.extent=t._queryEngine.fullExtent,r.layerDefinition.timeInfo){const{start:p,end:l}=t._queryEngine.timeExtent;r.layerDefinition.timeInfo.timeExtent=[p,l]}return r})()}applyEdits(){return(0,m.Z)(function*(){throw new F.Z("csv-layer:editing-not-supported","applyEdits() is not supported on CSVLayer")})()}queryFeatures(n={},e={}){var t=this;return(0,m.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQuery(n,e.signal)})()}queryFeatureCount(n={},e={}){var t=this;return(0,m.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQueryForCount(n,e.signal)})()}queryObjectIds(n={},e={}){var t=this;return(0,m.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQueryForIds(n,e.signal)})()}queryExtent(n={},e={}){var t=this;return(0,m.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQueryForExtent(n,e.signal)})()}querySnapping(n,e={}){var t=this;return(0,m.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQueryForSnapping(n,e.signal)})()}refresh(n){var e=this;return(0,m.Z)(function*(){var t;return e.loadOptions.customParameters=n,null==(t=e._snapshotTask)||t.abort(),e._snapshotTask=(0,b.vr)(e._snapshotFeatures),e._snapshotTask.promise.then(i=>{e._queryEngine.featureStore.clear(),i&&e._queryEngine.featureStore.addMany(i)},i=>{e._queryEngine.featureStore.clear(),(0,b.D_)(i)||w.Z.getLogger("esri.layers.CSVLayer").error(new F.Z("csv-layer:refresh","An error occurred during refresh",{error:i}))}),yield e._waitSnapshotComplete(),{extent:e._queryEngine.fullExtent,timeExtent:e._queryEngine.timeExtent}})()}_waitSnapshotComplete(){var n=this;return(0,m.Z)(function*(){if(n._snapshotTask&&!n._snapshotTask.finished){try{yield n._snapshotTask.promise}catch(e){}return n._waitSnapshotComplete()}})()}_fetch(n){var e=this;return(0,m.Z)(function*(){const{url:t,customParameters:i}=e.loadOptions;if(!t)throw new F.Z("csv-layer:invalid-source","url not defined");const r=(0,Z.mN)(t);return(yield(0,j.default)(r.path,{query:C(C({},r.query),i),responseType:"text",signal:n})).data})()}_createQueryEngine(n){const{objectIdField:e,fields:t,extent:i,timeInfo:r}=n.layerDefinition,d=new A.Z({geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1});return new H.q({fields:t,geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1,timeInfo:r,objectIdField:e,spatialReference:i.spatialReference||{wkid:4326},cacheSpatialQueries:!0,featureStore:d})}_createFeatures(n){var e=this;return(0,m.Z)(function*(){const{latitudeFieldName:t,longitudeFieldName:i}=e.locationInfo,{objectIdField:r,fieldsIndex:d,spatialReference:u}=e._queryEngine;let p=[];const l=[],c=d.fields.filter(a=>a.name!==r).map(a=>a.name);let f=0;const N=Q(n);N.next();const W={};for(const a of d.fields)if("esriFieldTypeOID"!==a.type&&"esriFieldTypeGlobalID"!==a.type){const E=(0,de.os)(a);void 0!==E&&(W[a.name]=E)}const Fe=V(N,c,e.delimiter,(0,L.Dm)(W,r));for(const a of Fe){const E=e._parseCoordinateValue(a[t]),x=e._parseCoordinateValue(a[i]);if(null!=x&&null!=E&&!isNaN(E)&&!isNaN(x)){a[t]=E,a[i]=x;for(const h in a)if(h!==t&&h!==i)if(d.isDateField(h)){const O=new Date(a[h]);a[h]=B(O,a[h])?O.getTime():null}else if(d.isNumericField(h)){const O=M(a[h]);a[h]=isNaN(O)?null:O}a[r]=f,f++,p.push(new me(x,E)),l.push(a)}}if(!(0,S.fS)({wkid:4326},u))if((0,S.sS)(u))for(const a of p)[a.x,a.y]=(0,g.hG)(a.x,a.y,ye);else p=(0,P.oj)(U.N,p,ce.Z.WGS84,u,null,null);const _=[];for(let a=0;a<p.length;a++){const{x:E,y:x}=p[a],h=l[a];h[r]=a+1,_.push(new I.u_(new D.Z([],[E,x]),h,null,h[r]))}return _})()}_parseCoordinateValue(n){if(null==n||""===n)return null;let e=M(n);return(isNaN(e)||Math.abs(e)>181)&&(e=parseFloat(n)),e}_checkProjection(n){return(0,m.Z)(function*(){try{yield(0,T._W)(S.Zn,n)}catch(e){throw new F.Z("csv-layer:projection-not-supported","Projection not supported")}})()}}},56554:(v,y,o)=>{o.d(y,{Dm:()=>P,Hq:()=>U,MS:()=>S,bU:()=>w});var m=o(8314),R=o(58817),j=o(87757),F=o(24837);function w(g){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===g||"esriGeometryMultipoint"===g?F.I4:"esriGeometryPolyline"===g?F.ET:F.lF}}}const b=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let Z=1;function P(g,I){if((0,m.Z)("esri-csp-restrictions"))return()=>C({[I]:null},g);try{let D=`this.${I} = null;`;for(const T in g)D+=`this${b.test(T)?`.${T}`:`["${T}"]`} = ${JSON.stringify(g[T])};`;const A=new Function(`\n      return class AttributesClass$${Z++} {\n        constructor() {\n          ${D};\n        }\n      }\n    `)();return()=>new A}catch(D){return()=>C({[I]:null},g)}}function U(g={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,R.d9)(g)}}]}function S(g,I){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:g},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:I,supportsDelete:I,supportsEditing:I,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:I,supportsExceedsLimitStatistics:!0},query:j.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:I,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}}}]);