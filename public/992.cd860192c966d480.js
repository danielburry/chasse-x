"use strict";(self.webpackChunkchasse_pwa_front=self.webpackChunkchasse_pwa_front||[]).push([[992],{14658:(ae,X,e)=>{function l(){return new Float32Array(3)}function N(d,g,x){const G=new Float32Array(3);return G[0]=d,G[1]=g,G[2]=x,G}function R(){return l()}function c(){return N(1,1,1)}function P(){return N(1,0,0)}function Q(){return N(0,1,0)}function O(){return N(0,0,1)}e.d(X,{c:()=>l,f:()=>N});const I=R(),ee=c(),_=P(),te=Q(),E=O();Object.freeze(Object.defineProperty({__proto__:null,create:l,clone:function j(d){const g=new Float32Array(3);return g[0]=d[0],g[1]=d[1],g[2]=d[2],g},fromValues:N,createView:function H(d,g){return new Float32Array(d,g,3)},zeros:R,ones:c,unitX:P,unitY:Q,unitZ:O,ZEROS:I,ONES:ee,UNIT_X:_,UNIT_Y:te,UNIT_Z:E},Symbol.toStringTag,{value:"Module"}))},65629:(ae,X,e)=>{e.d(X,{SR:()=>O,Ui:()=>Q});var l=e(62208),j=e(65401),N=e(32442),H=e(25748),R=e(91179),c=e(74618),P=e(37053);function Q(i){return I(i,!0)}function O(i){return I(i,!1)}function I(i,t){if((0,l.Wi)(i))return null;const n=i.spatialReference,s=(0,P.C5)(n),r="toJSON"in i?i.toJSON():i;if(!s)return r;const p=(0,P.sS)(n)?102100:4326,m=c.UZ[p].maxX,V=c.UZ[p].minX;if((0,R.wp)(r))return _(r,m,V);if((0,R.aW)(r))return r.points=r.points.map(C=>_(C,m,V)),r;if((0,R.YX)(r))return function ee(i,t){if(!t)return i;const n=function te(i,t){const n=[],{ymin:s,ymax:r,xmin:p,xmax:m}=i,V=i.xmax-i.xmin,[C,W]=t.valid,{x:T,frameId:M}=E(i.xmin,t),{x:Y,frameId:U}=E(i.xmax,t),f=T===Y&&V>0;if(V>2*W){const b={xmin:p<m?T:Y,ymin:s,xmax:W,ymax:r},K={xmin:C,ymin:s,xmax:p<m?Y:T,ymax:r},B={xmin:0,ymin:s,xmax:W,ymax:r},q={xmin:C,ymin:s,xmax:0,ymax:r},J=[],w=[];Z(b,B)&&J.push(M),Z(b,q)&&w.push(M),Z(K,B)&&J.push(U),Z(K,q)&&w.push(U);for(let $=M+1;$<U;$++)J.push($),w.push($);n.push(new x(b,[M]),new x(K,[U]),new x(B,J),new x(q,w))}else T>Y||f?n.push(new x({xmin:T,ymin:s,xmax:W,ymax:r},[M]),new x({xmin:C,ymin:s,xmax:Y,ymax:r},[U])):n.push(new x({xmin:T,ymin:s,xmax:Y,ymax:r},[M]));return n}(i,t).map(s=>s.extent);return n.length<2?n[0]||i:n.length>2?(i.xmin=t.valid[0],i.xmax=t.valid[1],i):{rings:n.map(s=>[[s.xmin,s.ymin],[s.xmin,s.ymax],[s.xmax,s.ymax],[s.xmax,s.ymin],[s.xmin,s.ymin]])}}(r,s);if((0,R.oU)(r)||(0,R.l9)(r)){const C=(0,N.$P)(G,r),W={xmin:C[0],ymin:C[1],xmax:C[2],ymax:C[3]},T=(0,c.XZ)(W.xmin,V)*(2*m),M=0===T?r:(0,c.Sy)(r,T);return W.xmin+=T,W.xmax+=T,W.xmax>m?g(M,m,t):W.xmin<V?g(M,V,t):M}return r}function _(i,t,n){if(Array.isArray(i)){const s=i[0];if(s>t){const r=(0,c.XZ)(s,t);i[0]=s+r*(-2*t)}else if(s<n){const r=(0,c.XZ)(s,n);i[0]=s+r*(-2*n)}}else{const s=i.x;if(s>t){const r=(0,c.XZ)(s,t);i.x+=r*(-2*t)}else if(s<n){const r=(0,c.XZ)(s,n);i.x+=r*(-2*n)}}return i}function E(i,t){const[n,s]=t.valid,r=2*s;let p,m=0;return i>s?(p=Math.ceil(Math.abs(i-s)/r),i-=p*r,m=p):i<n&&(p=Math.ceil(Math.abs(i-n)/r),i+=p*r,m=-p),{x:i,frameId:m}}function Z(i,t){const{xmin:n,ymin:s,xmax:r,ymax:p}=t;return d(i,n,s)&&d(i,n,p)&&d(i,r,p)&&d(i,r,s)}function d(i,t,n){return t>=i.xmin&&t<=i.xmax&&n>=i.ymin&&n<=i.ymax}function g(i,t,n=!0){const s=!(0,R.l9)(i);if(s&&(0,H.Zy)(i),n)return(new le).cut(i,t);const r=s?i.rings:i.paths,p=s?4:2,m=r.length,V=-2*t;for(let C=0;C<m;C++){const W=r[C];if(W&&W.length>=p){const T=[];for(const M of W)T.push([M[0]+V,M[1]]);r.push(T)}}return s?i.rings=r:i.paths=r,i}class x{constructor(t,n){this.extent=t,this.frameIds=n}}const G=(0,j.Ue)();class le{constructor(){this.linesIn=[],this.linesOut=[]}cut(t,n){let s;if(this.xCut=n,t.rings)this.closed=!0,s=t.rings,this.minPts=4;else{if(!t.paths)return null;this.closed=!1,s=t.paths,this.minPts=2}for(const p of s){if(!p||p.length<this.minPts)continue;let m=!0;for(const V of p)m?(this.moveTo(V),m=!1):this.lineTo(V);this.closed&&this.close()}this._pushLineIn(),this._pushLineOut(),s=[];for(const p of this.linesIn)p&&p.length>=this.minPts&&s.push(p);const r=-2*this.xCut;for(const p of this.linesOut)if(p&&p.length>=this.minPts){for(const m of p)m[0]+=r;s.push(p)}return this.closed?t.rings=s:t.paths=s,t}moveTo(t){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(t[0]),this._moveTo(t[0],t[1],this._prevSide),this._prevPt=t,this._firstPt=t}lineTo(t){const n=this._side(t[0]);if(n*this._prevSide==-1){const s=this._intersect(this._prevPt,t);this._lineTo(this.xCut,s,0),this._prevSide=0,this._lineTo(t[0],t[1],n)}else this._lineTo(t[0],t[1],n);this._prevSide=n,this._prevPt=t}close(){const t=this._firstPt,n=this._prevPt;t[0]===n[0]&&t[1]===n[1]||this.lineTo(t),this._checkClosingPt(this.lineIn),this._checkClosingPt(this.lineOut)}_moveTo(t,n,s){this.closed?(this.lineIn.push([s<=0?t:this.xCut,n]),this.lineOut.push([s>=0?t:this.xCut,n])):(s<=0&&this.lineIn.push([t,n]),s>=0&&this.lineOut.push([t,n]))}_lineTo(t,n,s){this.closed?(this._addPolyVertex(this.lineIn,s<=0?t:this.xCut,n),this._addPolyVertex(this.lineOut,s>=0?t:this.xCut,n)):s<0?(0===this._prevSide&&this._pushLineOut(),this.lineIn.push([t,n])):s>0?(0===this._prevSide&&this._pushLineIn(),this.lineOut.push([t,n])):this._prevSide<0?(this.lineIn.push([t,n]),this.lineOut.push([t,n])):this._prevSide>0&&(this.lineOut.push([t,n]),this.lineIn.push([t,n]))}_addPolyVertex(t,n,s){const r=t.length;r>1&&t[r-1][0]===n&&t[r-2][0]===n?t[r-1][1]=s:t.push([n,s])}_checkClosingPt(t){const n=t.length;n>3&&t[0][0]===this.xCut&&t[n-2][0]===this.xCut&&t[1][0]===this.xCut&&(t[0][1]=t[n-2][1],t.pop())}_side(t){return t<this.xCut?-1:t>this.xCut?1:0}_intersect(t,n){return t[1]+(this.xCut-t[0])/(n[0]-t[0])*(n[1]-t[1])}_pushLineIn(){this.lineIn&&this.lineIn.length>=this.minPts&&this.linesIn.push(this.lineIn),this.lineIn=[]}_pushLineOut(){this.lineOut&&this.lineOut.length>=this.minPts&&this.linesOut.push(this.lineOut),this.lineOut=[]}}},37384:(ae,X,e)=>{e.d(X,{y:()=>M});var l=e(17626),j=e(74333),N=e(89726),H=e(26584),R=e(32917),c=e(77712),I=(e(85931),e(8314),e(90912),e(76898)),ee=e(1011),_=e(86810);e(63290),e(82255);let Z=class extends _.wq{};Z=(0,l._)([(0,I.j)("esri.views.layers.support.ClipArea")],Z);const d=Z;var g;let x=g=class extends d{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new g({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};(0,l._)([(0,c.Cb)({type:[Number,String],json:{write:!0}})],x.prototype,"left",void 0),(0,l._)([(0,c.Cb)({type:[Number,String],json:{write:!0}})],x.prototype,"right",void 0),(0,l._)([(0,c.Cb)({type:[Number,String],json:{write:!0}})],x.prototype,"top",void 0),(0,l._)([(0,c.Cb)({type:[Number,String],json:{write:!0}})],x.prototype,"bottom",void 0),(0,l._)([(0,c.Cb)({readOnly:!0})],x.prototype,"version",null),x=g=(0,l._)([(0,I.j)("esri.views.layers.support.ClipRect")],x);const G=x;e(29132);var r,i=e(21674),t=e(91179),n=e(2004),s=e(37118);const p={base:i.Z,key:"type",typeMap:{extent:n.Z,polygon:s.Z}};let m=r=class extends d{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new r({geometry:this.geometry.clone()})}};(0,l._)([(0,c.Cb)({types:p,json:{read:t.im,write:!0}})],m.prototype,"geometry",void 0),(0,l._)([(0,c.Cb)({readOnly:!0})],m.prototype,"version",null),m=r=(0,l._)([(0,I.j)("esri.views.layers.support.Geometry")],m);const V=m;let C=class extends d{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};(0,l._)([(0,c.Cb)({type:[[[Number]]],json:{write:!0}})],C.prototype,"path",void 0),(0,l._)([(0,c.Cb)({readOnly:!0})],C.prototype,"version",null),C=(0,l._)([(0,I.j)("esri.views.layers.support.Path")],C);const T=j.Z.ofType({key:"type",base:d,typeMap:{rect:G,path:C,geometry:V}}),M=Y=>{let U=class extends Y{constructor(){super(...arguments),this.attached=!1,this.clips=new T,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1}initialize(){var K,B,q,J;const f=null==(B=null==(K=this.view)?void 0:K.spatialReferenceLocked)||B;(null==(q=this.view)?void 0:q.spatialReference)&&f&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new H.Z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new ee.W),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([(0,R.YP)(()=>this.suspended,w=>{this.container&&(this.container.visible=!w),this.view&&!w&&this.updateRequested&&this.view.requestUpdate()},R.tX),(0,R.YP)(()=>{var w,$;return null!=($=null==(w=this.layer)?void 0:w.opacity)?$:1},w=>{this.container&&(this.container.opacity=w)},R.tX),(0,R.YP)(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",w=>{this.container&&(this.container.blendMode=w)},R.tX),(0,R.YP)(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,w=>{this.container&&(this.container.effect=w)},R.tX),(0,R.on)(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)})]),(null==(J=this.view)?void 0:J.whenLayerView)?this.view.whenLayerView(this.layer).then(w=>{w===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach(),this.updateRequested=!1}get spatialReferenceSupported(){var b;const f=null==(b=this.view)?void 0:b.spatialReference;return null==f||this.supportsSpatialReference(f)}get updating(){var f;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!(null==(f=this.updatingHandles)?void 0:f.updating))}get visibleAtCurrentScale(){return this.isVisibleAtScale(this.view.scale)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.detach(),this.updateRequested=!1)}isVisibleAtScale(f){const b=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!b)return!0;const{minScale:K,maxScale:B}=b;return(0===K||f<=K)&&(0===B||f>=B)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(f){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",f),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(f))):this.updateRequested=!1}hitTest(f,b){return Promise.resolve(null)}supportsSpatialReference(f){return!0}canResume(){return!!this.spatialReferenceSupported&&!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const f=super.getSuspendInfo(),b=!this.spatialReferenceSupported,K=this.visibleAtCurrentScale;return b&&(f.spatialReferenceNotSupported=b),K&&(f.outsideScaleRange=K),f}};return(0,l._)([(0,c.Cb)()],U.prototype,"attached",void 0),(0,l._)([(0,c.Cb)({type:T,set(f){const b=(0,N.Z)(f,this._get("clips"),T);this._set("clips",b)}})],U.prototype,"clips",void 0),(0,l._)([(0,c.Cb)()],U.prototype,"container",void 0),(0,l._)([(0,c.Cb)()],U.prototype,"moving",void 0),(0,l._)([(0,c.Cb)({readOnly:!0})],U.prototype,"spatialReferenceSupported",null),(0,l._)([(0,c.Cb)({readOnly:!0})],U.prototype,"updateParameters",void 0),(0,l._)([(0,c.Cb)()],U.prototype,"updateRequested",void 0),(0,l._)([(0,c.Cb)()],U.prototype,"updating",null),(0,l._)([(0,c.Cb)()],U.prototype,"view",void 0),(0,l._)([(0,c.Cb)({readOnly:!0})],U.prototype,"visibleAtCurrentScale",null),U=(0,l._)([(0,I.j)("esri.views.2d.layers.LayerView2D")],U),U}},992:(ae,X,e)=>{e.r(X),e.d(X,{default:()=>Le});var l=e(15861),j=e(17626),H=(e(29132),e(74333)),R=e(63290),c=e(88159),P=e(62208),Q=e(10699),O=e(32917),I=e(77712),E=(e(85931),e(8314),e(90912),e(76898)),Z=e(65401),d=e(33190),g=e(14517),x=e(37118),G=e(55915),le=e(65629);let i=class extends g.Z{constructor(u){super(u)}get bounds(){const u=this.coords;return(0,P.Wi)(u)?null:(0,Z.oJ)(u.extent)}get coords(){var o;const u=null==(o=(0,P.Wg)(this.element.georeference))?void 0:o.coords;return(0,G.dz)(u,this.spatialReference).geometry}get normalizedCoords(){return x.Z.fromJSON((0,le.Ui)(this.coords))}get normalizedBounds(){return(0,P.pC)(this.normalizedCoords)?(0,Z.oJ)(this.normalizedCoords.extent):null}};(0,j._)([(0,I.Cb)()],i.prototype,"spatialReference",void 0),(0,j._)([(0,I.Cb)()],i.prototype,"element",void 0),(0,j._)([(0,I.Cb)()],i.prototype,"bounds",null),(0,j._)([(0,I.Cb)()],i.prototype,"coords",null),(0,j._)([(0,I.Cb)()],i.prototype,"normalizedCoords",null),(0,j._)([(0,I.Cb)()],i.prototype,"normalizedBounds",null),i=(0,j._)([(0,E.j)("esri.layers.support.media.MediaElementView")],i),e(17083),e(9598),e(58098);var r=e(8480),p=e(79527),m=e(26584),V=e(17770),C=e(21286),W=e(57477),T=e(83994),M=e(67969),Y=e(55086),U=e(49353),f=e(38210);class b extends W.s{constructor(o){super(),this.elementView=o,this.isWrapAround=!1,this._vertices=new Float32Array(20),this._handles=[],this._handles.push((0,O.YP)(()=>this.elementView.element.opacity,a=>this.opacity=a,O.nn),(0,O.YP)(()=>[this.elementView.coords],()=>{this.requestRender()},O.nn),(0,O.gx)(()=>this.elementView.element.loaded,()=>{const a=this.elementView.element;this.ready(),"video"===a.type&&(0,P.pC)(a.content)&&this._handles.push((0,V.on)(a.content,"play",()=>this.requestRender()))},O.nn)),o.element.load().catch(a=>{R.Z.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new m.Z("element-load-error","Element cannot be displayed",{element:o,error:a}))})}destroy(){var o;this._handles.forEach(a=>a.remove()),null==(o=this.texture)||o.dispose(),this.texture=null}get dvsMat3(){return this.parent.dvsMat3}beforeRender(o){const{context:a}=o,h=this.elementView.element.content;if((0,P.pC)(h)){const y=h instanceof HTMLImageElement,v=h instanceof HTMLVideoElement,S=y?h.naturalWidth:v?h.videoWidth:h.width,L=y?h.naturalHeight:v?h.videoHeight:h.height;this.texture?v&&!h.paused&&(this.texture.setData(h),this.requestRender(),((0,f.Z)(a.gl)||(0,C.wt)(S)&&(0,C.wt)(L))&&this.texture.generateMipmap()):(this.texture=new Y.x(a,{pixelFormat:M.VI.RGBA,dataType:M.Br.UNSIGNED_BYTE,samplingMode:M.cw.LINEAR,wrapMode:M.e8.CLAMP_TO_EDGE,width:S,height:L},h),((0,f.Z)(a.gl)||(0,C.wt)(S)&&(0,C.wt)(L))&&this.texture.generateMipmap(),v&&!h.paused&&this.requestRender())}super.beforeRender(o)}_createTransforms(){return null}updateDrawCoords(o,a){const h=this.elementView.coords;if((0,P.Wi)(h))return;const[y,v,S,L]=h.rings[0],ie=this._vertices,{x:D,y:A}=o,F=0!==a;ie.set(F?[v[0]-D,v[1]-A,y[0]-D,y[1]-A,S[0]-D,S[1]-A,L[0]-D,L[1]-A,L[0]-D,L[1]-A,v[0]+a-D,v[1]-A,v[0]+a-D,v[1]-A,y[0]+a-D,y[1]-A,S[0]+a-D,S[1]-A,L[0]+a-D,L[1]-A]:[v[0]-D,v[1]-A,y[0]-D,y[1]-A,S[0]-D,S[1]-A,L[0]-D,L[1]-A]),this.isWrapAround=F}getVAO(o,a,h){if((0,P.Wi)(this.elementView.coords))return null;const y=this._vertices;if(this._vao)this._geometryVbo.setData(y);else{this._geometryVbo=T.f.createVertex(o,M.l1.DYNAMIC_DRAW,y);const v=T.f.createVertex(o,M.l1.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1]));this._vao=new U.U(o,h,a,{geometry:this._geometryVbo,tex:v})}return this._vao}}var K=e(23841),B=e(30217),q=e(49966),J=e(9545),w=e(14658),$=e(13924),Pe=e(37053),Ee=e(24926),Me=e(51434),Se=e(39406),Ie=e(44589);class Te extends Ie.Z{constructor(){super(...arguments),this._localOrigin=(0,K.vW)(0,0),this._viewStateId=-1,this._dvsMat3=(0,q.c)(),this.requiresDedicatedFBO=!1}get dvsMat3(){return this._dvsMat3}beforeRender(o){this._updateMatrices(o),this._updateOverlays(o,this.children);for(const a of this.children)a.beforeRender(o)}prepareRenderPasses(o){const a=o.registerRenderPass({name:"overlay",brushes:[Me.U.overlay],target:()=>this.children,drawPhase:Se.jx.MAP});return[...super.prepareRenderPasses(o),a]}_updateMatrices(o){const{state:a}=o,{id:h,size:y,pixelRatio:v,resolution:S,rotation:L,viewpoint:ie,displayMat3:D}=a;if(this._viewStateId===h)return;const A=Math.PI/180*L,F=v*y[0],re=v*y[1],{x:he,y:pe}=ie.targetGeometry,ye=(0,$.or)(he,a.spatialReference);this._localOrigin.x=ye,this._localOrigin.y=pe;const de=S*F,oe=S*re,z=(0,B.b)(this._dvsMat3);(0,B.m)(z,z,D),(0,B.c)(z,z,(0,J.f)(F/2,re/2)),(0,B.d)(z,z,(0,w.f)(F/de,-re/oe,1)),(0,B.r)(z,z,-A),this._viewStateId=h}_updateOverlays(o,a){const{state:h}=o,{rotation:y,spatialReference:v,worldScreenWidth:S,size:L,viewpoint:ie}=h,D=this._localOrigin;let A=0;if(v.isWrappable){const F=L[0],re=L[1],he=180/Math.PI*y,pe=Math.abs(Math.cos(he)),ye=Math.abs(Math.sin(he)),de=Math.round(F*pe+re*ye),[oe,z]=(0,Pe.C5)(v).valid,k=(0,Ee.ut)(v),{x:ge,y:je}=ie.targetGeometry,ve=[0,0];h.toScreen(ve,[ge,je]);const ue=[0,0];let me;me=de>S?.5*S:.5*de;const xe=Math.floor((ge+.5*k)/k),be=oe+xe*k,Ve=z+xe*k,fe=[ve[0]+me,0];h.toMap(ue,fe),ue[0]>Ve&&(A=k),fe[0]=ve[0]-me,h.toMap(ue,fe),ue[0]<be&&(A=-k);for(const ce of a){const Ce=ce.elementView.bounds;if((0,P.Wi)(Ce))continue;const[Re,,Oe]=Ce;ce.updateDrawCoords(D,Re<oe&&Oe>oe?k:Oe>z&&Re<z?-k:A)}}else for(const F of a)F.updateDrawCoords(D,A)}}var Ue=e(37384),De=e(45611),Ae=e(2004);let se=class extends((0,Ue.y)(De.Z)){constructor(){super(...arguments),this._overlayContainer=null,this._fetchQueue=null,this._tileStrategy=null,this._elementReferences=new Map,this.layer=null,this.elements=new H.Z}attach(){this.handles.add((0,O.on)(()=>this.layer.source,"refresh",()=>{for(const u of this._tileStrategy.tiles)this._updateTile(u);this.requestUpdate()})),this._overlayContainer=new Te,this.container.addChild(this._overlayContainer),this._fetchQueue=new r.Z({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:(u,o)=>this._queryElements(u,o)}),this._tileStrategy=new p.Z({cachePolicy:"purge",resampling:!0,acquireTile:u=>this._acquireTile(u),releaseTile:u=>this._releaseTile(u),tileInfoView:this.view.featuresTilingScheme}),this.requestUpdate()}detach(){this.handles.removeAll(),this.elements.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.destroy(),this._overlayContainer.removeAllChildren(),this.container.removeAllChildren(),this._elementReferences.clear()}supportsSpatialReference(u){return!0}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}update(u){this._tileStrategy.update(u)}hitTest(u,o){var a=this;return(0,l.Z)(function*(){var v;const h=[],y=[u.x,u.y];for(const S of a.elements){const L=null==(v=(0,P.Wg)(S.georeference))?void 0:v.coords;(0,P.pC)(L)&&(0,d.wP)(L.rings,y)&&h.push({type:"media",element:S,layer:a.layer,mapPoint:u})}return h.reverse()})()}canResume(){return null!=this.layer.source&&super.canResume()}doRefresh(){return(0,l.Z)(function*(){})()}_acquireTile(u){const o=new we(u.clone());return this._updateTile(o),o}_updateTile(u){this.updatingHandles.addPromise(this._fetchQueue.push(u.key).then(o=>{const[a,h]=u.setElements(o);this._acquireElements(u,a),this._releaseElements(u,h),this.requestUpdate()},o=>{(0,Q.D_)(o)||R.Z.getLogger(this.declaredClass).error(o)}))}_releaseTile(u){this._fetchQueue.abort(u.key.id),u.elements&&this._releaseElements(u,u.elements),this.requestUpdate()}_queryElements(u,o){var a=this;return(0,l.Z)(function*(){const h=a.layer.source;if((0,P.Wi)(h))return[];a.view.featuresTilingScheme.getTileBounds(ne,u,!0);const y=new Ae.Z({xmin:ne[0],ymin:ne[1],xmax:ne[2],ymax:ne[3],spatialReference:a.view.spatialReference});return h.queryElements(y,o)})()}_acquireElements(u,o){const h=this.view.spatialReference;if(!(0,P.Wi)(this.layer.source))for(const y of o)(0,c.s1)(this._elementReferences,y.uid,()=>{const v=new i({element:y,spatialReference:h}),S=new b(v);return this._overlayContainer.addChild(S),this.elements.add(y),{tiles:new Set,projectedElement:v,overlay:S}}).tiles.add(u)}_releaseElements(u,o){for(const a of o){const h=this._elementReferences.get(a.uid);h.tiles.delete(u),h.tiles.size||(this._overlayContainer.removeChild(h.overlay),h.overlay.destroy(),h.projectedElement.destroy(),this._elementReferences.delete(a.uid),this.elements.remove(a))}}};(0,j._)([(0,I.Cb)()],se.prototype,"_fetchQueue",void 0),(0,j._)([(0,I.Cb)()],se.prototype,"layer",void 0),(0,j._)([(0,I.Cb)({readOnly:!0})],se.prototype,"elements",void 0),se=(0,j._)([(0,E.j)("esri.views.2d.layers.MediaLayerView2D")],se);const ne=(0,Z.Ue)();class we{constructor(o){this.key=o,this.elements=null,this.isReady=!1,this.visible=!0}setElements(o){const a=[],h=new Set(this.elements);this.elements=o;for(const y of o)h.has(y)?h.delete(y):a.push(y);return this.isReady=!0,[a,Array.from(h)]}}const Le=se},45611:(ae,X,e)=>{e.d(X,{Z:()=>Z});var l=e(17626),j=e(14517),N=e(61885),H=e(80542),R=e(61996),c=e(63290),P=e(62208),Q=e(60330),O=e(77712),te=(e(85931),e(8314),e(90912),e(76898));let E=class extends((0,H.p)((0,R.IG)((0,Q.v)(N.Z.EventedMixin(j.Z))))){constructor(d){super(d),this.layer=null,this.parent=null}initialize(){this.when().catch(d=>{if("layerview:create-error"!==d.name){const g=this.layer&&this.layer.id||"no id",x=this.layer&&this.layer.title||"no title";c.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${x}', id: '${g}')`,d)}})}get fullOpacity(){return(0,P.Pt)(this.get("layer.opacity"),1)*(0,P.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var d;return!this.suspended&&!0===(null==(d=this.layer)?void 0:d.legendEnabled)}get updating(){var d;return!(!(null==(d=this.updatingHandles)?void 0:d.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var d;return!0===(null==(d=this.layer)?void 0:d.visible)}set visible(d){void 0!==d?this._override("visible",d):this._clearOverride("visible")}canResume(){var d,g,x;return this.visible&&(null==(d=this.layer)?void 0:d.loaded)&&!(null==(g=this.parent)?void 0:g.suspended)&&(null==(x=this.view)?void 0:x.ready)||!1}getSuspendInfo(){const d=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(d.viewNotReady=!0),this.layer&&this.layer.loaded||(d.layerNotLoaded=!0),this.visible||(d.layerInvisible=!0),d}isUpdating(){return!1}};(0,l._)([(0,O.Cb)()],E.prototype,"fullOpacity",null),(0,l._)([(0,O.Cb)()],E.prototype,"layer",void 0),(0,l._)([(0,O.Cb)()],E.prototype,"parent",void 0),(0,l._)([(0,O.Cb)({readOnly:!0})],E.prototype,"suspended",null),(0,l._)([(0,O.Cb)({readOnly:!0})],E.prototype,"suspendInfo",null),(0,l._)([(0,O.Cb)({readOnly:!0})],E.prototype,"legendEnabled",null),(0,l._)([(0,O.Cb)({type:Boolean,readOnly:!0})],E.prototype,"updating",null),(0,l._)([(0,O.Cb)({readOnly:!0})],E.prototype,"updatingProgress",null),(0,l._)([(0,O.Cb)()],E.prototype,"visible",null),(0,l._)([(0,O.Cb)()],E.prototype,"view",void 0),E=(0,l._)([(0,te.j)("esri.views.layers.LayerView")],E);const Z=E}}]);